<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>webpacké€†å‘</title>
      <link href="/2024/12/27/webpack-ni-xiang/"/>
      <url>/2024/12/27/webpack-ni-xiang/</url>
      
        <content type="html"><![CDATA[<h1 id="webpackæ‰£ä»£ç "><a href="#webpackæ‰£ä»£ç " class="headerlink" title="webpackæ‰£ä»£ç "></a>webpackæ‰£ä»£ç </h1><p>å‚è€ƒï¼š<a href="https://app.yinxiang.com/fx/970ae39c-9964-4aae-aa96-7e81fee4ef8f" target="_blank" rel="noopener">https://app.yinxiang.com/fx/970ae39c-9964-4aae-aa96-7e81fee4ef8f</a></p><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><p>ç½‘å€ï¼šaHR0cHM6Ly93d3cuY29pbmdsYXNzLmNvbS8=</p><p>æ¥å£ï¼šaHR0cHM6Ly9jYXBpLmNvaW5nbGFzcy5jb20vYXBpL2V0Zi9mbG93</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/39a24ad3-34f2-4ba9-9cb0-7a1c48106f96.png" alt="image.png"></p><ol><li>å…ˆå®šä½æ¥å£ä»¥åŠè¿”å›çš„æ•°æ®</li></ol><p>æ¥å£ä¸Šé¢å·²ç»™å‡ºï¼Œå“åº”æ•°æ®ä¸€çœ‹å°±æœ‰åŠ å¯†ã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/052f6ff1-eece-4679-9d19-f09eaa2197c8.png" alt="image.png"></p><ol start="2"><li>ä½¿ç”¨XHRæ–­ç‚¹è¿›è¡Œdebugger</li></ol><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/71d5c3eb-2d51-42c5-a76f-97c1afd95ee6.png" alt="image.png"></p><p>ä¸€æ­¥ä¸€æ­¥è°ƒè¯•ï¼Œæ‰¾åˆ°è§£å¯†çš„å…³é”®ä»£ç </p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/6460a5f6-c7fd-4e57-8864-eb1dd47bc7ce.png" alt="image.png"></p><ol start="3"><li>webpackæ‰“åŒ…</li></ol><p>é€šè¿‡debuggerè°ƒè¯•ï¼ŒæŠŠè¿™ä¸ªè§£å¯†çš„jsæ‹‰åˆ°å¼€å¤´ï¼Œå¯ä»¥çœ‹å‡ºå…¸å‹çš„webpackæ‰“åŒ…</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/ca78e79f-e7f9-4c80-94ff-1628641ffa8f.png" alt="image.png"></p><p>è·Ÿè¿›åˆ°eZé‡Œé¢å»</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/b57d05ba-45ba-43fb-abbf-152cf8c0c88a.png" alt="image.png"></p><ol start="4"><li>æ‰¾åˆ°webpackåŠ è½½å™¨</li></ol><p>è¿™é‡Œéœ€è¦è·Ÿè¿›åˆ°åŠ è½½å™¨ï¼Œå°†åŠ è½½å™¨æ‰£å‡ºæ¥ã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/32c2a803-147b-453d-9f44-5bd96d36f136.png" alt="image.png"></p><p>æ ¹æ®å †æ ˆä¿¡æ¯ï¼Œå¯ä»¥æ‰¾åˆ°åŠ è½½å™¨çš„å…¥å£</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/58e32640-051b-49d3-848e-37da1fa54e86.png" alt="image.png"></p><p>å°†åŠ è½½å™¨å¤åˆ¶å‡ºæ¥ï¼Œä¿å­˜ä¸ºæœ¬åœ°js</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/11b01226-b678-4297-8944-0a4352e2d012.png" alt="image.png"></p><ol start="5"><li>è°ƒè¯•webpackï¼Œæ‰£å¯¹åº”ä½¿ç”¨çš„jsæ–‡ä»¶ï¼Œè¡¥ç¯å¢ƒã€‚</li></ol><p>æ–°å»ºload.js, å°†åŠ è½½å™¨å…¨éƒ¨å¤åˆ¶å‡ºæ¥</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/673b5c8e-cbd8-4b19-89a6-6052a750720e.png" alt="image.png"></p><p>é€šè¿‡åŠ è½½å™¨ä»£ç å¯å‘ç°hä¸ºåŠ è½½å™¨å‡½æ•°ï¼Œä½¿ç”¨å…¨å±€å˜é‡å¯¼å‡º åŠ è½½å™¨å‡½æ•°ã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/ca8f4045-fce1-4d39-bd1a-2ce881131a63.png" alt="image.png"></p><p>è°ƒè¯•, å‘ç°æŠ¥é”™</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/485128a9-dc2a-4f80-b3be-f156a7e1b6f6.png" alt="image.png"></p><p>æ‰“æ–­ç‚¹åˆ°selfè¿™é‡Œï¼Œçœ‹ä¸‹æ˜¯ä»€ä¹ˆã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/3e3eb1f1-5305-4c71-88f1-6eb5db894952.png" alt="image.png"></p><p>è¿™é‡Œå¯å‘ç°selfå°±æ˜¯windowã€‚</p><p>ç›´æ¥è¡¥ç¯å¢ƒå³å¯ã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/bd2791bf-53d7-496b-ba8e-81e41af6ae2b.png" alt="image.png"></p><p>ç»§ç»­æ‰§è¡Œï¼Œå‘è¡Œæ­£å¸¸è¿è¡Œã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/89960f16-4e75-42ad-868d-86a0f93d7aa4.png" alt="image.png"></p><p>æ¥ä¸‹æ¥å®šä½åˆ°è§£å¯†çš„jsï¼Œçœ‹åˆ°ä¸Šé¢çš„ è§£å¯†çš„å…³é”®ä»£ç  é‚£å—çš„å›¾ï¼›æ‰¾åˆ°å¯¹åº”çš„jsæ–‡ä»¶å’Œæ‰§è¡Œè§£å¯†çš„ä»£ç å—ï¼Œçœ‹æ˜¯ä½¿ç”¨çš„é‚£ä¸ªæ¨¡å—ã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/094e0ce1-01be-4b64-b23e-690fcecd3f1b.png" alt="image.png"></p><p>å®šä½åˆ°è§£å¯†çš„å…³é”®ä»£ç å—ï¼Œå¾€ä¸Šæ‰¾åŠ è½½äº†ä»€ä¹ˆæ¨¡å—ã€‚</p><p>æˆ‘è¿™é‡Œå°†è¿™ä¸ªjså…¨éƒ¨å¤åˆ¶åˆ°vscodeé‡Œé¢ï¼Œé€šè¿‡å…³é”®å­—æœç´¢ï¼Œå®šä½åˆ°äº†è§£å¯†ä»£ç å—ï¼Œvscodeä¹Ÿæœ‰æç¤ºè¿™ä¸ªä»£ç å—æ˜¯å±äºé‚£ä¸ªæ¨¡å—çš„ã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/dd9c3803-58c6-4599-9236-66141a96b642.png" alt="image.png"></p><p>å¯ä»¥çœ‹å‡ºæ¥æ˜¯2214æ¨¡å—</p><p>å†ä½¿ç”¨åŠ è½½å™¨ï¼Œè°ƒè¯•ä¸‹è¿™ä¸ªæ¨¡å—ã€‚</p><p>window.my_load(2214)</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/03009470-e513-4c32-8752-bc40aea0311f.png" alt="image.png"></p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/c7da9e71-c08b-4aba-a352-8c1f723f389e.png" alt="image.png"></p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/4c947fc2-51cd-4de2-928b-cd94b737faeb.png" alt="image.png"></p><p>é€šè¿‡è¾“å‡ºç»“æœï¼Œå‘ç°2214è¿™ä¸ªæ¨¡å—æ²¡æœ‰åŠ è½½è¿›æ¥ã€‚</p><p>å¥½ï¼Œåˆšæ‰æˆ‘ä»¬å·²ç»å®šä½åˆ°è¿™ä¸ªjsäº†ï¼Œç›´æ¥å…¨æ‰£å‡ºæ¥ã€‚</p><p>æ–°å»ºä¸ªæ–‡ä»¶ wp_model.js, å°†é‚£ä¸ªjså…¨éƒ¨å¤åˆ¶åˆ°æ–‡ä»¶ä¸­<img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/70ff3b1c-c591-4ac7-8266-512f853f7beb.png" alt="image.png"></p><p>å†å°†è¯¥jså¯¼å…¥åˆ°load.jsé‡Œé¢ï¼Œå†æ¬¡æ‰§è¡Œã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/4a746d69-e5bb-48a9-8882-33032ddb048e.png" alt="image.png"></p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/f0192eff-86e3-43c7-99d0-4b2d8b41c107.png" alt="image.png"></p><p>å¥½ï¼Œå‘ç°è¿˜ç¼ºå°‘å¦ä¸€ä¸ªæ¨¡å— 67294ã€‚</p><p>ç›´æ¥é€šè¿‡å¼€å‘è€…å·¥å…·æœç´¢ï¼Œ67294:ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ¨¡å—åŠ è½½jsï¼Œå°†å…¶æ‰£å…¥wp_model.jsä¸­ï¼Œå†æ¬¡æ‰§è¡Œload.jsç›´åˆ°æŠŠæ‰€æœ‰ä½¿ç”¨åˆ°çš„æ¨¡å—è¡¥å…¨ã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/bdc5d5d8-2fa3-4094-80a9-e70aad16f8ec.png" alt="image.png"></p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/1115e733-d6df-4d48-9297-eca1a14bee3b.png" alt="image.png"></p><p>è¿™ä¸ªæ¡ˆä¾‹ç”¨åˆ°äº†è¿™ä¸¤ä¸ªæ¨¡å—ï¼ˆå…¶å®æˆ‘ä»¬æ‰£å¤šäº†ï¼Œæœ‰æ›´ç®€åŒ–çš„æ–¹æ¡ˆï¼Œè¿™é‡Œä¸èµ˜è¿°ï¼‰ï¼›</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/eaf72524-c0f8-4a0e-a8b9-bb7d879a7a7a.png" alt="image.png"></p><p>ç›´åˆ°è¾“å‡ºæ²¡æœ‰æŠ¥é”™ï¼Œè¡¨ç¤ºå·²ç»å®ŒæˆğŸ‰ã€‚</p><ol start="6"><li>ä½¿ç”¨å…¨å±€å˜é‡å¯¼å‡ºè§£å¯†å‡½æ•°<br>å‰é¢æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†è§£å¯†å…³é”®ä»£ç å—å¯¹åº”çš„functionï¼Œè¿™é‡Œç›´æ¥ç”¨å…¨å±€å˜é‡ç»™ä»–å¯¼å‡ºã€‚</li></ol><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/49e00760-5ba4-44ff-88eb-202939d42c9b.png" alt="image.png"></p><p>ä¹Ÿå°±æ˜¯è¿™ä¸ªfunctionã€‚</p><p>æ‰¾åˆ°æˆ‘ä»¬wp_model.jsä¸­å¯¹åº”çš„ä½ç½®ï¼Œä½¿ç”¨windowå…¨å±€å˜é‡æŒ‚åˆ°è‡ªå®šä¹‰ä¸€ä¸ªå˜é‡ä¸Šå»ã€‚å³å¯ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚window.my_decrypt = function(t) â€¦.</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/be7a7203-a0c3-41bc-9c4d-d8d750c0177e.png" alt="image.png"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°éœ€è¦ä¼ å…¥tå‚æ•°ï¼Œtå‚æ•°æ€ä¹ˆæ¥å‘¢ï¼Ÿç›´æ¥åœ¨æµè§ˆå™¨ä¸Šdebuggeråˆ°è¿™é‡Œï¼Œå¤åˆ¶t è¿™ä¸ªobjå°±è¡Œã€‚</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/70ea8b29-bbe2-417a-ae99-67d74e7e035a.png" alt="image.png"></p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/8K4nyR1P5pWYqLbj/img/6ffe602d-1d5b-4c45-aeac-4c4ffe8b6761.png" alt="image.png"></p><p>è‡³æ­¤æ­å–œä½ å®Œæˆè§£å¯†ã€‚ğŸ‰</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çˆ¬è™« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡OOM</title>
      <link href="/2023/03/13/ji-yi-ci-oom/"/>
      <url>/2023/03/13/ji-yi-ci-oom/</url>
      
        <content type="html"><![CDATA[<h3 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h3><p>æœ€è¿‘æŠ¥è¡¨è§£æå‘Šè­¦ç¾¤ï¼Œé¢‘ç¹å‡ºç°kafkaå †ç§¯å‘Šè­¦ã€‚<br>topicæŸä¸ªpartitionæ¶ˆè´¹ä¸åŠ¨ï¼Œå…¶ä»–partitionæ¶ˆè´¹æ­£å¸¸ï¼Œå¼‚å¸¸å¥‡æ€ªï¼›åŒæ—¶æ¶ˆè´¹è€…æœåŠ¡å…¶ä¸­ä¸€ä¸ªpodå…ˆæŒ‚æ‰ï¼Œå¼•å‘rebalanceï¼Œå¯¼è‡´å…¶ä»–podä¹Ÿrebalanceï¼ŒåŒæ—¶æŒ‚æ‰ï¼›é‡å¯æ¬¡æ•°è¾ƒå¤šã€‚</p><h3 id="æ’æŸ¥è¿‡ç¨‹"><a href="#æ’æŸ¥è¿‡ç¨‹" class="headerlink" title="æ’æŸ¥è¿‡ç¨‹"></a>æ’æŸ¥è¿‡ç¨‹</h3><ol><li>æœ¬åœ°è§£æè¯¥æŠ¥è¡¨å¹¶æ²¡æœ‰å¤ç°è¯¥é—®é¢˜</li><li>æ‹¿åˆ°partitionä¸­æäº¤çš„æœ€è¿‘çš„offsetï¼Œè·å–å…¶æ¶ˆæ¯å†…å®¹ï¼›å‘ç°è¯¥æ¶ˆæ¯å†…å®¹ä¸­çš„æŠ¥è¡¨æ•°æ®æ¯”å…¶ä»–æŠ¥è¡¨æ•°æ®å¤§åå‡ å€ï¼›ä»è€Œè®©è¿ç»´åŒäº‹å¢åŠ podçš„å†…å­˜èµ„æºã€‚512m -&gt; 2Gï¼Œç„¶å¹¶è½¯ã€‚ï¼ˆç”±äºè…¾è®¯äº‘ä¸Špodé‡å¯åªèƒ½çœ‹åˆ°äº‹ä»¶ï¼Œæ— æ³•å®æ–½è§‚å¯Ÿåˆ°å¯¹åº”çš„è¾“å‡ºæ—¥å¿—ï¼›ELKåªæ”¶é›†jsonæ ¼å¼æ—¥å¿—ï¼‰</li><li>è”ç³»è¿ç»´åŒäº‹ï¼Œå°†deploymentä¸­å¯è¿è¡Œå‘½ä»¤æ”¹ä¸º tial -f æŸä¸ªæ–‡ä»¶ï¼Œå…ˆè®©deploymentæŒ‚èµ·ã€‚å†è¿›å…¥åˆ°å¯¹åº”çš„podï¼Œå¯åŠ¨æ¶ˆè´¹è€…ï¼›ç¨‹åºè¿è¡Œå‡ åˆ†é’Ÿä¹‹åå°±è¢«killæ‰</li></ol><h3 id="å¤„ç†æ–¹æ¡ˆ"><a href="#å¤„ç†æ–¹æ¡ˆ" class="headerlink" title="å¤„ç†æ–¹æ¡ˆ"></a>å¤„ç†æ–¹æ¡ˆ</h3><h4 id="æ’æŸ¥è¢«killçš„æºå¤´ã€‚"><a href="#æ’æŸ¥è¢«killçš„æºå¤´ã€‚" class="headerlink" title="æ’æŸ¥è¢«killçš„æºå¤´ã€‚"></a>æ’æŸ¥è¢«killçš„æºå¤´ã€‚</h4><p>ç”±äºä½¿ç”¨çš„pythonçš„dockeråŸºç¡€é•œåƒï¼Œdebianç³»ç»Ÿ /var/log/messageï¼ˆæ—¥å¿—ï¼‰å¹¶æ²¡æœ‰è¯¥æ–‡ä»¶ã€‚<br>ä½¿ç”¨ <code>strace</code> å·¥å…·ï¼šç”¨äºè·Ÿè¸ªè¿›ç¨‹æ‰§è¡Œæ—¶çš„ç³»ç»Ÿè°ƒç”¨å’Œæ‰€æ¥æ”¶çš„ä¿¡å·ï¼Œç”¨æˆ·ç©ºé—´è¿›ç¨‹å’Œå†…æ ¸çš„äº¤äº’ï¼Œæ¯”å¦‚ç³»ç»Ÿè°ƒç”¨ã€ä¿¡å·ä¼ é€’ã€è¿›ç¨‹çŠ¶æ€å˜æ›´ç­‰ã€‚</p><h4 id="å®‰è£…-strace"><a href="#å®‰è£…-strace" class="headerlink" title="å®‰è£… strace"></a>å®‰è£… strace</h4><pre class="line-numbers language-sh"><code class="language-sh">apt update -yapt install strace -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œ <code>strace -p PID</code> å‘½ä»¤ï¼Œæ¥è¿½è¸ªè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨è››ä¸é©¬è¿¹ã€‚<br>æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">16:02:19.192409 mprotect(0x7f4aa886b000, 552960, PROT_READ|PROT_WRITE) = 0 <0.000014>16:02:19.744000 mmap(NULL, 552960, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory) <0.000108>16:02:19.755545 mprotect(0x7f4aa88f2000, 552960, PROT_READ|PROT_WRITE) = 0 <0.000019>16:02:23.404805 mmap(NULL, 552960, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0 <ptrace(SYSCALL):No such process>16:02:25.325272 +++ killed by SIGKILL +++[1]+ Killed python will_be_killed.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="KILLEDä¿¡å·å¯¹ç…§è¡¨"><a href="#KILLEDä¿¡å·å¯¹ç…§è¡¨" class="headerlink" title="KILLEDä¿¡å·å¯¹ç…§è¡¨"></a>KILLEDä¿¡å·å¯¹ç…§è¡¨</h4><pre><code>ä¿¡å· ã€€ã€€ã€€å€¼ å¤„ç†åŠ¨ä½œ å‘å‡ºä¿¡å·çš„åŸå›  ---------------------------------------------------------------------- SIGHUPã€€ã€€1 ã€€ã€€Aã€€ã€€ ç»ˆç«¯æŒ‚èµ·æˆ–è€…æ§åˆ¶è¿›ç¨‹ç»ˆæ­¢ SIGINT ã€€ã€€2 ã€€ã€€A ã€€ã€€é”®ç›˜ä¸­æ–­ï¼ˆå¦‚breaké”®è¢«æŒ‰ä¸‹ï¼‰ SIGQUIT ã€€ 3 ã€€ã€€C ã€€ã€€é”®ç›˜çš„é€€å‡ºé”®è¢«æŒ‰ä¸‹ SIGILL ã€€ã€€ 4 ã€€ã€€C ã€€ã€€éæ³•æŒ‡ä»¤ SIGABRT ã€€6 ã€€ã€€C ã€€ã€€ç”±abort(3)å‘å‡ºçš„é€€å‡ºæŒ‡ä»¤ SIGFPE ã€€  8 ã€€ã€€C ã€€ã€€æµ®ç‚¹å¼‚å¸¸ SIGKILL ã€€9 ã€€ã€€AEFã€€ã€€Killä¿¡å· SIGSEGV   11 ã€€ã€€Cã€€ã€€æ— æ•ˆçš„å†…å­˜å¼•ç”¨ SIGPIPE ã€€13 ã€€ã€€Aã€€ã€€ç®¡é“ç ´è£‚: å†™ä¸€ä¸ªæ²¡æœ‰è¯»ç«¯å£çš„ç®¡é“ SIGALRM 14 ã€€ã€€ Aã€€ã€€ç”±alarm(2)å‘å‡ºçš„ä¿¡å· SIGTERM 15 ã€€ã€€ Aã€€ã€€ç»ˆæ­¢ä¿¡å· SIGUSR1  30,10,16 A ã€€ç”¨æˆ·è‡ªå®šä¹‰ä¿¡å·1 SIGUSR2  31,12,17 A ã€€ç”¨æˆ·è‡ªå®šä¹‰ä¿¡å·2 SIGCHLD  20,17,18 B    å­è¿›ç¨‹ç»“æŸä¿¡å· SIGCONT  19,18,25       è¿›ç¨‹ç»§ç»­ï¼ˆæ›¾è¢«åœæ­¢çš„è¿›ç¨‹ï¼‰ SIGSTOP  17,19,23 DEF ç»ˆæ­¢è¿›ç¨‹ SIGTSTP  18,20,24 D æ§åˆ¶ç»ˆç«¯ï¼ˆttyï¼‰ä¸ŠæŒ‰ä¸‹åœæ­¢é”® SIGTTIN   21,21,26 D åå°è¿›ç¨‹ä¼å›¾ä»æ§åˆ¶ç»ˆç«¯è¯» SIGTTOU 22,22,27 D åå°è¿›ç¨‹ä¼å›¾ä»æ§åˆ¶ç»ˆç«¯å†™ </code></pre><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºè¯¥ç¨‹åºæ˜¯è¢«å¼ºåˆ¶KILLäº†ã€‚</p><p>debianç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡dmesgæŸ¥çœ‹ï¼š<br><code>dmesg ï¼T | grep -E -i -B100 &#39;killed process&#39;</code></p><p>è¾“å‡ºç»“æœï¼š</p><pre><code>[æœˆ 12æ—¥ 24 16:02:24 2022] [ pid ] uid tgid total_vm rss nr_ptes swapents oom_score_adj name[æœˆ 12æ—¥ 24 16:02:24 2022] [ 172] 0 172 10553 722 23 1375 0 systemd-journal[æœˆ 12æ—¥ 24 16:02:24 2022] [ 181] 0 181 10201 398 22 134 -1000 systemd-udevd[æœˆ 12æ—¥ 24 16:02:24 2022] [ 518] 0 518 8738 361 21 70 0 cron[æœˆ 12æ—¥ 24 16:02:24 2022] [ 519] 0 519 4756 314 13 45 0 atd[æœˆ 12æ—¥ 24 16:02:24 2022] [ 520] 0 520 13795 412 31 143 -1000 sshd[æœˆ 12æ—¥ 24 16:02:24 2022] [ 525] 0 525 4964 161 14 65 0 systemd-logind[æœˆ 12æ—¥ 24 16:02:24 2022] [ 536] 105 536 10531 172 26 98 -900 dbus-daemon[æœˆ 12æ—¥ 24 16:02:24 2022] [ 580] 0 580 1064 362 8 34 0 acpid[æœˆ 12æ—¥ 24 16:02:24 2022] [ 602] 0 602 4926 373 13 37 0 agetty[æœˆ 12æ—¥ 24 16:02:24 2022] [ 605] 0 605 4881 373 14 37 0 agetty[æœˆ 12æ—¥ 24 16:02:24 2022] [ 643] 108 643 8346 283 22 134 0 ntpd[æœˆ 12æ—¥ 24 16:02:24 2022] [ 889] 104 889 12794 369 26 158 0 exim4[æœˆ 12æ—¥ 24 16:02:24 2022] [11640] 0 11640 4188 1118 15 0 0 atop[æœˆ 12æ—¥ 24 16:02:24 2022] [29370] 0 29370 14434 420 30 177 0 sshd[æœˆ 12æ—¥ 24 16:02:24 2022] [29372] 3010 29372 14434 189 29 147 0 sshd[æœˆ 12æ—¥ 24 16:02:24 2022] [29373] 3010 29373 7813 491 20 587 0 bash[æœˆ 12æ—¥ 24 16:02:24 2022] [30731] 0 30731 14434 429 30 177 0 sshd[æœˆ 12æ—¥ 24 16:02:24 2022] [30733] 3010 30733 14434 328 29 154 0 sshd[æœˆ 12æ—¥ 24 16:02:24 2022] [30734] 3010 30734 7810 432 19 606 0 bash[æœˆ 12æ—¥ 24 16:02:24 2022] [30746] 3010 30746 13967 408 30 102 0 su[æœˆ 12æ—¥ 24 16:02:24 2022] [30747] 0 30747 7389 422 19 194 0 bash[æœˆ 12æ—¥ 24 16:02:24 2022] [31688] 0 31688 13967 408 31 101 0 su[æœˆ 12æ—¥ 24 16:02:24 2022] [31689] 3010 31689 7808 482 19 566 0 bash[æœˆ 12æ—¥ 24 16:02:24 2022] [32128] 3010 32128 7761 445 19 32 0 top[æœˆ 12æ—¥ 24 16:02:24 2022] [32132] 3010 32132 2357921 1868878 4581 467803 0 python[æœˆ 12æ—¥ 24 16:02:24 2022] [32133] 3010 32133 1255 152 7 57 0 strace[æœˆ 12æ—¥ 24 16:02:24 2022] Out of memory: Kill process 32132 (python) score 957 or sacrifice child[æœˆ 12æ—¥ 24 16:02:24 2022] Killed process 32132 (python) total-vm:9431684kB, anon-rss:7473936kB, file-rss:1576kB</code></pre><p>ç»“æœå¾ˆæ˜æ˜¾OOMäº†ã€‚ç®€å•ç²—æš´ï¼šç›´æ¥åŠ å†…å­˜å³å¯ï¼›ä½†åç»­éœ€æ‰¾å‡ºå¥½å†…å­˜çš„ä»£ç æ®µï¼Œè¿›è¡Œä¼˜åŒ–ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BUG </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼šLRUã€TTL</title>
      <link href="/2022/07/14/chang-yong-huan-cun-tao-tai-suan-fa/"/>
      <url>/2022/07/14/chang-yong-huan-cun-tao-tai-suan-fa/</url>
      
        <content type="html"><![CDATA[<h3 id="LRU-Cache"><a href="#LRU-Cache" class="headerlink" title="LRU Cache"></a>LRU Cache</h3><p>LRU(Least recently used, æœ€è¿‘æœ€å°‘ä½¿ç”¨)ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå¦‚æœä¸€ä¸ªæ•°æ®æœ€è¿‘ä¸€æ®µæ—¶é—´è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆä»¥åè¢«è®¿é—®çš„å‡ ç‡è¶Šé«˜ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®æœ€è¿‘ä¸€æ®µæ—¶é—´æ²¡æœ‰è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡è¶Šå°ï¼›å½“å†…å­˜è¶…è¿‡é™åˆ¶æ—¶ï¼Œåº”å½“æŠŠæœ€ä¹…æ²¡æœ‰è®¿é—®çš„æ•°æ®æ·˜æ±°ã€‚</p><blockquote><p>å®ç°LRU</p></blockquote><ol><li><p>ç”¨ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—æ¥è®°å½•ç¼“å­˜çš„keyï¼Œæ¯å½“æŸä¸ªkeyè¢«è®¿é—®ï¼Œå°±å°†è¯¥keyå…¥é˜Ÿï¼›å¦‚æœè¯¥keyåœ¨è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢ï¼Œåˆ™å°†è¯¥keyç§»è‡³é˜Ÿå°¾ï¼›è‹¥é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™æ·˜æ±°é˜Ÿé¦–çš„keyã€‚</p></li><li><p>åˆ©ç”¨dictæ¥å­˜å‚¨keyå¯¹åº”çš„æ•°æ®é¡¹ï¼›å½“æœ‰æ–°keyå…¥é˜Ÿï¼Œåˆ™è¯¥dictéœ€è¦æ’å…¥æ–°æ•°æ®é¡¹ï¼›è‹¥é˜Ÿåˆ—å·²æ»¡ï¼ŒåŒæ—¶è¦å°†é˜Ÿé¦–çš„keyæ‰€å­˜å‚¨çš„æ•°æ®é¡¹æ·˜æ±°</p></li></ol><p>ä»£ç ï¼š</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">LRUCache</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_size<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        self<span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>max_size <span class="token operator">=</span> max_size    <span class="token keyword">def</span> <span class="token function">visit_key</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> key <span class="token keyword">in</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>append<span class="token punctuation">(</span>key<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">full</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        key <span class="token operator">=</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>keys <span class="token operator">=</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        <span class="token keyword">del</span> self<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> key <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>        value <span class="token operator">=</span> self<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        self<span class="token punctuation">.</span>visit_key<span class="token punctuation">(</span>key<span class="token punctuation">)</span>        <span class="token keyword">return</span> value    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> key <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">:</span>            <span class="token keyword">if</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>max_size<span class="token punctuation">:</span>                self<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>visit_key<span class="token punctuation">(</span>key<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="TTL-Cache"><a href="#TTL-Cache" class="headerlink" title="TTL Cache"></a>TTL Cache</h3><p>TTL ç®€å•æ¥è®²å°±æ˜¯å¯¹æ•°æ®ç¼“å­˜ä¸€å®šçš„æ—¶é—´<br>ä¸Šä»£ç ï¼š</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">ttl_cache</span><span class="token punctuation">(</span>ttl<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>        cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>            target <span class="token operator">=</span> object<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> kwargs<span class="token punctuation">:</span>                key <span class="token operator">=</span> args <span class="token operator">+</span> <span class="token punctuation">(</span>repr<span class="token punctuation">(</span>sorted<span class="token punctuation">(</span>kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                key <span class="token operator">=</span> args            result <span class="token operator">=</span> cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">,</span> target<span class="token punctuation">)</span>            <span class="token keyword">if</span> result <span class="token keyword">is</span> <span class="token operator">not</span> target<span class="token punctuation">:</span>                exp<span class="token punctuation">,</span> value <span class="token operator">=</span> result                <span class="token keyword">if</span> exp <span class="token operator">></span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hit cache: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>exp<span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span> value            value <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"miss cache"</span><span class="token punctuation">)</span>            cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> ttl<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">return</span> value        <span class="token keyword">return</span> inner    <span class="token keyword">return</span> wrapper<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FastApiå­¦ä¹ æ€»ç»“</title>
      <link href="/2021/11/26/fastapi-xue-xi-zong-jie/"/>
      <url>/2021/11/26/fastapi-xue-xi-zong-jie/</url>
      
        <content type="html"><![CDATA[<p> <code>å®˜ç½‘å­¦ä¹ æ•™ç¨‹ï¼š</code><a href="https://fastapi.tiangolo.com/zh/" target="_blank" rel="noopener"><code>https://fastapi.tiangolo.com/zh/</code></a></p><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-FastAPI-FastAPIæœ‰å“ªäº›ç‰¹ç‚¹"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-FastAPI-FastAPIæœ‰å“ªäº›ç‰¹ç‚¹" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ FastAPI; FastAPIæœ‰å“ªäº›ç‰¹ç‚¹?"></a>ä¸€ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ FastAPI; FastAPIæœ‰å“ªäº›ç‰¹ç‚¹?</h2><h3 id="1-å¿«é€Ÿï¼š"><a href="#1-å¿«é€Ÿï¼š" class="headerlink" title="1.å¿«é€Ÿï¼š"></a>1.å¿«é€Ÿï¼š</h3><p>æ‹¥æœ‰éå¸¸é«˜çš„æ€§èƒ½ï¼Œå½’åŠŸäº Starlette å’Œ Pydanticï¼›Starlette ç”¨äºè·¯ç”±åŒ¹é…ï¼ŒPydantic ç”¨äºæ•°æ®éªŒè¯</p><p> Starlette</p><pre><code>       1.å®˜ç½‘ä½¿ç”¨ä»‹ç»: https://www.starlette.io/       2.ä»€ä¹ˆæ˜¯ Starlette?        Starlette æ˜¯ä¸€ç§è½»é‡çº§çš„ ASGI æ¡†æ¶/å·¥å…·åŒ…ï¼Œæ˜¯æ„å»ºé«˜æ€§èƒ½ asyncio æœåŠ¡çš„ç†æƒ³é€‰æ‹©ã€‚       3.ä¸ºä»€ä¹ˆä½¿ç”¨ Starlette?        Starlette æ˜¯ç›®å‰æµ‹è¯•æœ€å¿«çš„ Python æ¡†æ¶ã€‚åªæœ‰ Uvicorn è¶…è¶Šäº†å®ƒï¼ŒUvicorn ä¸æ˜¯æ¡†æ¶ï¼Œè€Œæ˜¯æœåŠ¡å™¨ã€‚       4.å…¶ä»–        Starlette æä¾›äº†æ‰€æœ‰åŸºæœ¬çš„ Web å¾®æ¡†æ¶åŠŸèƒ½ã€‚ä½†æ˜¯å®ƒä¸æä¾›è‡ªåŠ¨æ•°æ®éªŒè¯ï¼Œåºåˆ—åŒ–æˆ–API æ–‡æ¡£ã€‚        è‡ªåŠ¨æ•°æ®éªŒè¯ç”± Pydanticè´Ÿè´£, APIæ–‡æ¡£åˆ™æ˜¯ OpenAPI          FastAPI ä½¿ç”¨å®ƒæ¥å¤„ç†æ‰€æœ‰æ ¸å¿ƒ Web éƒ¨ä»¶, ç±» FastAPI æœ¬èº«ç›´æ¥ç»§æ‰¿Starletteã€‚</code></pre><p>å› æ­¤ï¼Œä½¿ç”¨ Starlette å¯ä»¥æ‰§è¡Œçš„ä»»ä½•æ“ä½œï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ FastAPI è¿›è¡Œã€‚</p><pre><code>        å³è·¯ç”±åŒ¹é…è§„åˆ™ä¹‹å†…çš„ å…·ä½“å®ç°éƒ½è¦çœ‹ Starletteæºç </code></pre><p>  Pydantic</p><pre><code>       1.å®˜ç½‘ä½¿ç”¨ä»‹ç»:</code></pre><p><a href="https://pydantic-docs.helpmanual.io/" target="_blank" rel="noopener">https://pydantic-docs.helpmanual.io/</a></p><pre><code>       2.ä»€ä¹ˆæ˜¯Pydantic?            Pydantic æ˜¯ä¸€ä¸ªåº“ï¼ŒåŸºäºPythonç±»å‹æç¤ºæ¥å®šä¹‰æ•°æ®éªŒè¯ï¼Œåºåˆ—åŒ–å’Œæ–‡æ¡£ï¼ˆä½¿ç”¨JSONæ¨¡å¼ï¼‰ã€‚       3.ä¸ºä»€ä¹ˆä½¿ç”¨ Pydantic?            FastAPIä½¿ç”¨å®ƒæ¥å¤„ç†æ‰€æœ‰æ•°æ®éªŒè¯, é™¤äº†pydanticåº“ä¹‹å¤–ï¼Œåƒæ˜¯valideeråº“ã€marshmallowåº“ã€trafaretåº“ä»¥åŠcerberusåº“ç­‰éƒ½å¯ä»¥å®Œæˆç›¸ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç›¸è¾ƒä¹‹ä¸‹ï¼Œpydanticåº“çš„æ‰§è¡Œæ•ˆç‡ä¼šæ›´åŠ ä¼˜ç§€ä¸€äº›ã€‚</code></pre><p>Uvicorn</p><p>   1.å®˜ç½‘ä½¿ç”¨ä»‹ç»</p><pre><code>    [https://www.uvicorn.org/](https://www.uvicorn.org/)</code></pre><p>   2.ä»€ä¹ˆæ˜¯ Uvicornï¼Ÿ</p><pre><code>Uvicorn æ˜¯åŸºäº uvloop å’Œ httptools æ„å»ºçš„å¦‚é—ªç”µèˆ¬å¿«é€Ÿçš„ ASGI æœåŠ¡å™¨ã€‚å®ƒä¸æ˜¯Webæ¡†æ¶ï¼Œè€Œæ˜¯æœåŠ¡å™¨</code></pre><h3 id="2-å¼€å‘æ•ˆç‡ï¼š"><a href="#2-å¼€å‘æ•ˆç‡ï¼š" class="headerlink" title="2.å¼€å‘æ•ˆç‡ï¼š"></a>2.å¼€å‘æ•ˆç‡ï¼š</h3><p>åŠŸèƒ½å¼€å‘æ•ˆç‡æå‡ 200% åˆ° 300%</p><pre><code>  2.1 è·¯å¾„å‚æ•°/æŸ¥è¯¢å‚æ•°/Bodyå‚æ•° çš„æå–ä¸æ ¡éªŒéƒ½è¢«æœ€å¤§ç¨‹åº¦çš„æ”¯æŒ  2.2 ä¾èµ–æ³¨å…¥èƒ½è¾ƒå¤§ç¨‹åº¦çš„å¤ç”¨å…¬å…±é€»è¾‘</code></pre><h3 id="3-å‡å°‘-bugï¼š"><a href="#3-å‡å°‘-bugï¼š" class="headerlink" title="3.å‡å°‘ bugï¼š"></a>3.å‡å°‘ bugï¼š</h3><p>å‡å°‘ 40% çš„å› ä¸ºå¼€å‘è€…ç²—å¿ƒå¯¼è‡´çš„é”™è¯¯</p><p>  Pydanticæä¾›çš„ æ•°æ®éªŒè¯åŠŸèƒ½ä¸ ç±»å‹æ³¨é‡Šçš„ç»“åˆèƒ½æœ‰æ•ˆçš„å‡å°‘BUG</p><h3 id="4-æ™ºèƒ½ï¼š"><a href="#4-æ™ºèƒ½ï¼š" class="headerlink" title="4.æ™ºèƒ½ï¼š"></a>4.æ™ºèƒ½ï¼š</h3><p>å†…éƒ¨çš„ç±»å‹æ³¨è§£éå¸¸å®Œå–„ï¼Œç¼–è¾‘å™¨å¯å¤„å¤„è‡ªåŠ¨è¡¥å…¨</p><p>  æ”¯æŒPydanticçš„IDE(ç¼–è¾‘å™¨)éƒ½èƒ½å¾ˆå¥½çš„æ”¯æŒè¡¥å…¨ç­‰æ“ä½œ</p><h3 id="5-ç®€å•ï¼š"><a href="#5-ç®€å•ï¼š" class="headerlink" title="5.ç®€å•ï¼š"></a>5.ç®€å•ï¼š</h3><p>æ¡†æ¶æ˜“äºä½¿ç”¨ï¼Œæ–‡æ¡£æ˜“äºé˜…è¯»</p><h3 id="6-ç®€çŸ­ï¼š"><a href="#6-ç®€çŸ­ï¼š" class="headerlink" title="6.ç®€çŸ­ï¼š"></a>6.ç®€çŸ­ï¼š</h3><p>ä½¿ä»£ç é‡å¤æœ€å°åŒ–ï¼Œé€šè¿‡ä¸åŒçš„å‚æ•°å£°æ˜å®ç°ä¸°å¯Œçš„åŠŸèƒ½</p><pre><code>  ä¾èµ–æ³¨å…¥</code></pre><h3 id="7-å¥å£®ï¼š"><a href="#7-å¥å£®ï¼š" class="headerlink" title="7.å¥å£®ï¼š"></a>7.å¥å£®ï¼š</h3><p>å¯ä»¥ç¼–å†™å‡ºçº¿ä¸Šä½¿ç”¨çš„ä»£ç ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼æ–‡æ¡£</p><h3 id="8-æ ‡å‡†åŒ–ï¼š"><a href="#8-æ ‡å‡†åŒ–ï¼š" class="headerlink" title="8.æ ‡å‡†åŒ–ï¼š"></a>8.æ ‡å‡†åŒ–ï¼š</h3><p>å…¼å®¹ API ç›¸å…³å¼€æ”¾æ ‡å‡†</p><h2 id="äºŒã€FastAPIå¼€å‘çš„ç›¸å…³ä¾èµ–"><a href="#äºŒã€FastAPIå¼€å‘çš„ç›¸å…³ä¾èµ–" class="headerlink" title="äºŒã€FastAPIå¼€å‘çš„ç›¸å…³ä¾èµ–"></a>äºŒã€FastAPIå¼€å‘çš„ç›¸å…³ä¾èµ–</h2><h3 id="1-Python"><a href="#1-Python" class="headerlink" title="1. Python"></a>1. Python</h3><p>  Pythonçš„ç‰ˆæœ¬è¦å¤§äºç­‰äº 3.6</p><h3 id="2-å…¶ä»–æ¨¡å—ä¾èµ–"><a href="#2-å…¶ä»–æ¨¡å—ä¾èµ–" class="headerlink" title="2. å…¶ä»–æ¨¡å—ä¾èµ–"></a>2. å…¶ä»–æ¨¡å—ä¾èµ–</h3><p>  pip install fastapi; è¯¥æ“ä½œä¼šè‡ªåŠ¨å®‰è£… Starlette å’Œ Pydantic</p><p>  pip install uvicorn;  uvicorn æ˜¯è¿è¡Œç›¸å…³åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨</p><p>  pip install fastapi[all]; ä¸€æ­¥åˆ°ä½, æ‰€æœ‰ä¾èµ–å…¨éƒ¨å®‰è£…</p><h2 id="ä¸‰ã€äº¤äº’å¼æ–‡æ¡£"><a href="#ä¸‰ã€äº¤äº’å¼æ–‡æ¡£" class="headerlink" title="ä¸‰ã€äº¤äº’å¼æ–‡æ¡£"></a>ä¸‰ã€äº¤äº’å¼æ–‡æ¡£</h2><p> FastAPI ä¼šè‡ªåŠ¨æä¾›ä¸€ä¸ªç±»ä¼¼äº Swagger çš„äº¤äº’å¼æ–‡æ¡£ï¼Œæˆ‘ä»¬è¾“å…¥ â€œlocalhost:port/docsâ€ å³å¯è¿›å…¥ã€‚</p><p> äº¤äº’å¼æ–‡æ¡£ä¼šæ˜¾ç¤º æ¥å£APIçš„ç›¸å…³å†…å®¹, å¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰æ¥å£ä¿¡æ¯, å…·ä½“å¦‚ä½•æ“ä½œ, åç»­å†æ›´æ–°</p><h2 id="å››ã€è·¯ç”±ç›¸å…³"><a href="#å››ã€è·¯ç”±ç›¸å…³" class="headerlink" title="å››ã€è·¯ç”±ç›¸å…³"></a>å››ã€è·¯ç”±ç›¸å…³</h2><h3 id="1-è·¯ç”±åŒ¹é…è§„åˆ™"><a href="#1-è·¯ç”±åŒ¹é…è§„åˆ™" class="headerlink" title="1.è·¯ç”±åŒ¹é…è§„åˆ™"></a>1.è·¯ç”±åŒ¹é…è§„åˆ™</h3><p>1.1 æ™®é€šè·¯ç”±åŒ¹é…</p><p>  åœ¨ä¸€ä¸ª è·¯ç”±å®šä¹‰æ¨¡å—ä¸­, è‹¥ä¸€ä¸ªURLå¯ä»¥åŒ¹é…ä¸Šå¤šä¸ª è‡ªå®šä¹‰è·¯ç”±çš„æƒ…å†µä¸‹</p><p>  ä¼šä¼˜å…ˆåŒ¹é…åˆ° å…ˆå®šä¹‰çš„é‚£ä¸€ä¸ªã€‚</p><p>ä¸¾ä¸ªä¾‹å­:</p><pre><code># coding: utf-8from fastapi import FastAPIimport uvicornapp = FastAPI()@app.get(&quot;/users/me&quot;)async def read_user_me():    return {&quot;user_id&quot;: &quot;the current user&quot;}@app.get(&quot;/users/{user_id}&quot;)async def read_user(user_id: int):    return {&quot;user_id&quot;: user_id}if __name__ == &quot;__main__&quot;:    uvicorn.run(&quot;main:app&quot;, host=&quot;0.0.0.0&quot;, port=8080)</code></pre><p><strong>å› ä¸ºè·¯å¾„æ“ä½œæ˜¯æŒ‰ç…§é¡ºåºè¿›è¡Œçš„ï¼Œæ‰€ä»¥è¿™é‡Œè¦ä¿è¯</strong> <code>/users/me</code> <strong>åœ¨</strong> <code>/users/{user\_id}</code> <strong>çš„å‰é¢ï¼Œå¦åˆ™çš„è¯åªä¼šåŒ¹é…åˆ°</strong> <code>/users/{user\_id}</code><strong>ï¼Œæ­¤æ—¶å¦‚æœè®¿é—®</strong> <code>/users/me</code><strong>ï¼Œé‚£ä¹ˆä¼šè¿”å›ä¸€ä¸ªè§£æé”™è¯¯ï¼Œå› ä¸ºå­—ç¬¦ä¸² â€œmeâ€ æ— æ³•è§£ææˆæ•´å‹ã€‚</strong></p><h3 id="2-APIRouterè·¯ç”±ç»„"><a href="#2-APIRouterè·¯ç”±ç»„" class="headerlink" title="2.APIRouterè·¯ç”±ç»„"></a>2.APIRouterè·¯ç”±ç»„</h3><p>APIRouterä¸»è¦æ˜¯ç»™è·¯ç”±åŠ å‰ç¼€, æ–¹ä¾¿äºåœ¨é¡¹ç›®ä¸­ å¯¹äºä¸åŒæ¨¡å—æˆ–è€…ä¸åŒç±»åˆ«çš„æ¥å£ åŠ ä¸€ä¸ªç»Ÿä¸€çš„å‰ç¼€è¿›è¡Œç»‘å®š, æœ‰ç‚¹ç±»ä¼¼åˆ†ç»„/æ–‡ä»¶å¤¹çš„æ„æ€</p><p>APIRouter: æœ‰ç‚¹ç±»ä¼¼äºGOä¸­ginæ¡†æ¶ä¸­çš„è·¯ç”±ç»„çš„æ¦‚å¿µ, æ‰€ä»¥è¿™é‡Œå†™çš„æ˜¯è·¯ç”±ç»„</p><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p><p>1.åœ¨appå…·ä½“çš„æ¨¡å—ä¸­</p><pre><code># app/user/user_login.pyfrom fastapi import APIRouteruser_router = APIRouter(prefix=&quot;/v1/users&quot;)# ä»¥åè®¿é—®çš„æ—¶å€™è¦é€šè¿‡ /v1/users/login     æ¥è®¿é—®@router.get(&quot;/login&quot;)async def v1():    return {&quot;message&quot;: &quot;hello world&quot;}</code></pre><p>2.åœ¨é¡¹ç›®å¯åŠ¨åŠ è½½çš„ main.pyä¸­:</p><pre><code># main.pyfrom fastapi import FastAPIfrom app.user.user_login import user_routerimport uvicornapp = FastAPI()# å°† user_router æ³¨å†Œåˆ° app ä¸­ï¼Œç›¸å½“äº Flask ä¸­çš„ register_blueprintapp.include_router(router)if __name__ == &quot;__main__&quot;:    uvicorn.run(&quot;main:app&quot;, host=&quot;0.0.0.0&quot;, port=8080)</code></pre><h3 id="3-ç¦ç”¨ä¸€ä¸ªè·¯ç”±"><a href="#3-ç¦ç”¨ä¸€ä¸ªè·¯ç”±" class="headerlink" title="3.ç¦ç”¨ä¸€ä¸ªè·¯ç”±:"></a>3.ç¦ç”¨ä¸€ä¸ªè·¯ç”±:</h3><p>å‚æ•° include_in_schema è®¾ç½®ä¸º False</p><p> @app.get(â€œ/items/â€œ, include_in_schema=False)</p><p>ä½†æ˜¯è¿™ä¸ª ç¦ç”¨è·¯ç”±ä»…ä»…åªæ˜¯åœ¨ docsé¡µé¢éšè—è¯¥ æ¥å£ ä¸æ˜¾ç¤º, å®é™…ä¸Šå¹¶ä¸å½±å“å…¶è°ƒç”¨å’ŒçœŸæ­£ä½¿ç”¨ã€‚åªæ˜¯æ¥å£æ–‡æ¡£å¤„å¯¹å¤–ç•Œä¸å¯çŸ¥~</p><h2 id="äº”ã€è¯·æ±‚å‚æ•°è·å–"><a href="#äº”ã€è¯·æ±‚å‚æ•°è·å–" class="headerlink" title="äº”ã€è¯·æ±‚å‚æ•°è·å–"></a>äº”ã€è¯·æ±‚å‚æ•°è·å–</h2><p>PSï¼š è¿™é‡Œåªä»‹ç»å‚æ•°è·å–, å¯¹äºå‚æ•°æ ¡éªŒçš„å†™æ³•ï¼Œ è¯¦è§ç¬¬å…­ç« </p><h3 id="5-1-è·å–è·¯å¾„å‚æ•°"><a href="#5-1-è·å–è·¯å¾„å‚æ•°" class="headerlink" title="5.1 è·å–è·¯å¾„å‚æ•°"></a>5.1 è·å–è·¯å¾„å‚æ•°</h3><p>è·¯å¾„å‚æ•°çš„å£°æ˜:</p><p>è·¯å¾„å‚æ•°å£°æ˜åœ¨urlä¸­, å¹¶ä¸”ç”¨ä¸€å¯¹èŠ±æ‹¬å·<code>{user\_id}</code>åŒ…è£¹ï¼› eg. <code>@app.get(&quot;/user/{user\_id}&quot;)</code></p><p>å¯¹äºå¤šä¸ª è·¯å¾„å‚æ•°æ¥è¯´, ç”¨å¤šä¸ª <code>{}</code> åŒ…è£¹å³å¯ï¼›eg. <code>@app.get(&quot;/user/{part\_id}/{user\_name}&quot;)</code></p><p>è·¯å¾„å‚æ•°çš„è·å–:</p><pre><code>@app.get(&quot;/user/{part_id}/{user_name}&quot;)async def get_user(part_id: str, user_name: str):    &quot;&quot;&quot;åœ¨è·¯ç”±å‡½æ•°ä¸­å®šä¹‰çš„ä¸¤ä¸ªè·¯å¾„å‚æ•° part_id/user_name        åªè¦è·¯ç”±å‡½æ•°ä¸­çš„ å‚æ•°åèƒ½ä¸ä¹‹å¯¹åº”(ä¸€æ¨¡ä¸€æ ·),         é‚£ä¹ˆåœ¨è¿™é‡Œè·¯ç”±å‡½æ•°è·å–çš„ part_id/user_nameå°±æ˜¯è·¯å¾„å‚æ•°ä¸Šå¯¹åº”çš„ part_id/user_name       åœ¨è·¯ç”±å‡½æ•°ä¸­ è¿™ä¸¤ä¸ªå‚æ•°çš„é¡ºåºæ²¡æœ‰è¦æ±‚    &quot;&quot;&quot;    return {&quot;part_id&quot;: part_id, &quot;user_name&quot;: user_name}</code></pre><p>å¯¹äºç‰¹æ®Šè·¯å¾„å‚æ•°çš„è·å–, è¯¦è§ 5.4 è·å–pathç±»å‹å‚æ•°</p><h3 id="5-2-è·å–paramså‚æ•°"><a href="#5-2-è·å–paramså‚æ•°" class="headerlink" title="5.2 è·å–paramså‚æ•°"></a>5.2 è·å–paramså‚æ•°</h3><p>æŸ¥è¯¢å‚æ•°ä¸éœ€è¦å£°æ˜, å¦‚æœå‡½æ•°ä¸­å®šä¹‰äº†ä¸å±äºè·¯å¾„å‚æ•°çš„å‚æ•°æ—¶ï¼Œé‚£ä¹ˆå®ƒä»¬å°†ä¼šè¢«è‡ªåŠ¨è§£é‡Šä¼šæŸ¥è¯¢å‚æ•°ã€‚</p><p><strong>æ–¹å¼ä¸€: é»˜è®¤æ–¹å¼</strong></p><pre><code>@app.get(&quot;/user/{user_id}&quot;)async def get_user(user_id: str, name: str, age: int):    &quot;&quot;&quot;æˆ‘ä»¬åœ¨å‡½æ•°ä¸­å‚æ•°å®šä¹‰äº† user_idã€nameã€age ä¸‰ä¸ªå‚æ•°       æ˜¾ç„¶ user_id å’Œ è·¯å¾„å‚æ•°ä¸­çš„ user_id å¯¹åº”ï¼Œç„¶å name å’Œ age ä¼šè¢«è§£é‡ŠæˆæŸ¥è¯¢å‚æ•°       è¿™ä¸‰ä¸ªå‚æ•°çš„é¡ºåºæ²¡æœ‰è¦æ±‚ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½æ˜¯è·¯å¾„å‚æ•°åœ¨å‰ï¼ŒæŸ¥è¯¢å‚æ•°åœ¨å       PS: è¿™é‡Œåšäº† ç±»å‹æ³¨é‡Š, å› æ­¤ä¼ è¿›æ¥çš„ å‚æ•°ä¼šç»è¿‡ æ˜¯å¦å¿…è¦æ€§æ£€æµ‹å³å‚æ•°ç±»å‹æ£€æµ‹               è¿™é‡Œçš„å£°æ˜è¡¨ç¤º, paramså‚æ•° name/age æ˜¯å¿…å¡«å‚æ•°, æ²¡æœ‰ä¼ ä¼šæŠ›é”™            è™½ç„¶paramså‚æ•°çš„æ•°æ®æ¡†æ¶åœ¨æ¥æ”¶çš„æ—¶å€™, valueéƒ½æ˜¯ strç±»å‹çš„, ä½†æ˜¯è¿™é‡Œå£°æ˜ age: intæ—¶,             age: &#39;10&#39; ä¼šè¢«å¼ºè½¬ä¸º age: 10; ä½†æ˜¯å¯¹äº age: &#39;test&#39; è¿™ç±»çš„å‚æ•° åˆ™ä¼šæŠ¥ç±»å‹é”™è¯¯~    &quot;&quot;&quot;    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name, &quot;age&quot;: age}</code></pre><p>æ–¹å¼äºŒ: ä½¿ç”¨Query ç±»å‹æ³¨é‡Š</p><pre><code>@app.get(&quot;/user/{user_id}&quot;)async def get_user(user_id: str, name: str=Query(...), age: int=Query(...)):    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name, &quot;age&quot;: age}</code></pre><h3 id="5-3-è·å–bodyå‚æ•°"><a href="#5-3-è·å–bodyå‚æ•°" class="headerlink" title="5.3 è·å–bodyå‚æ•°"></a>5.3 è·å–bodyå‚æ•°</h3><h4 id="5-3-1-è·å–jsonç±»å‹-bodyå‚æ•°-å•ä¸ªè¯·æ±‚ä½“"><a href="#5-3-1-è·å–jsonç±»å‹-bodyå‚æ•°-å•ä¸ªè¯·æ±‚ä½“" class="headerlink" title="5.3.1 è·å–jsonç±»å‹ bodyå‚æ•°(å•ä¸ªè¯·æ±‚ä½“)"></a>5.3.1 è·å–jsonç±»å‹ bodyå‚æ•°(å•ä¸ªè¯·æ±‚ä½“)</h4><p><strong>æ–¹å¼ä¸€: ä½¿ç”¨Bodyç±»å‹</strong></p><pre><code>from datetime import datetime, time, timedeltafrom typing import Optionalfrom uuid import UUIDfrom fastapi import Body, FastAPIapp = FastAPI()</code></pre><p>â€‹<br>    @app.put(â€œ/items/{item_id}â€)<br>    async def read_items(<br>        item_id: UUID,<br>        start_datetime: Optional[datetime] = Body(None),        # è¿™é‡Œçš„ Bodyç±»å‹æ³¨é‡Š è¡¨æ˜äº†è·å–çš„æ˜¯ä¸€ä¸ª bodyå‚æ•°<br>        end_datetime: Optional[datetime] = Body(None),<br>        repeat_at: Optional[time] = Body(None),<br>        process_after: Optional[timedelta] = Body(None),<br>    ):<br>        start_process = start_datetime + process_after<br>        duration = end_datetime - start_process<br>        return {<br>            â€œitem_idâ€: item_id,<br>            â€œstart_datetimeâ€: start_datetime,<br>            â€œend_datetimeâ€: end_datetime,<br>            â€œrepeat_atâ€: repeat_at,<br>            â€œprocess_afterâ€: process_after,<br>            â€œstart_processâ€: start_process,<br>            â€œdurationâ€: duration,<br>        }</p><p><strong>æ–¹å¼äºŒ: ç»§æ‰¿BaseModel ï¼ˆPydanticæä¾›ï¼‰</strong></p><p>å¦‚æœå‚æ•°çš„ç±»å‹è¢«å£°æ˜ä¸ºä¸€ä¸ª Pydantic æ¨¡å‹ï¼Œå®ƒå°†è¢«è§£é‡Šä¸ºè¯·æ±‚ä½“ã€‚</p><pre><code>from typing import Optional, Listfrom fastapi import FastAPI, Request, Responsefrom pydantic import BaseModelimport uvicornapp = FastAPI()</code></pre><p>â€‹<br>    class Girl(BaseModel):<br>        â€œâ€â€æ•°æ®éªŒè¯æ˜¯é€šè¿‡ pydantic å®ç°çš„ï¼Œæˆ‘ä»¬éœ€è¦ä»ä¸­å¯¼å…¥ BaseModelï¼Œç„¶åç»§æ‰¿å®ƒâ€â€â€<br>        name: str<br>        age: Optional[str] = None<br>        length: float<br>        hobby: List[str]  # å¯¹äº Model ä¸­çš„ List[str] æˆ‘ä»¬ä¸éœ€è¦æŒ‡å®š Queryï¼ˆå‡†ç¡®çš„è¯´æ˜¯ Fieldï¼‰</p><p>â€‹<br>    @app.post(â€œ/girlâ€)<br>    async def read_girl(girl: Girl):<br>        # girl å°±æ˜¯æˆ‘ä»¬æ¥æ”¶çš„è¯·æ±‚ä½“ï¼Œå®ƒéœ€è¦é€šè¿‡ json æ¥ä¼ é€’ï¼Œå¹¶ä¸”è¿™ä¸ª json è¦æœ‰ä¸Šé¢çš„å››ä¸ªå­—æ®µï¼ˆage å¯ä»¥æ²¡æœ‰ï¼‰<br>        # é€šè¿‡ girl.xxx çš„æ–¹å¼æˆ‘ä»¬å¯ä»¥è·å–å’Œä¿®æ”¹å†…éƒ¨çš„æ‰€æœ‰å±æ€§<br>        return dict(girl)  # ç›´æ¥è¿”å› Model å¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥çš„</p><h4 id="5-3-2-è·å–jsonç±»å‹-bodyå‚æ•°-å¤šä¸ªè¯·æ±‚ä½“"><a href="#5-3-2-è·å–jsonç±»å‹-bodyå‚æ•°-å¤šä¸ªè¯·æ±‚ä½“" class="headerlink" title="5.3.2 è·å–jsonç±»å‹ bodyå‚æ•°(å¤šä¸ªè¯·æ±‚ä½“)"></a>5.3.2 è·å–jsonç±»å‹ bodyå‚æ•°(å¤šä¸ªè¯·æ±‚ä½“)</h4><p>ä¸Šé¢åªæ˜¯æ¥æ”¶ä¸€ä¸ªè¯·æ±‚ä½“çš„æƒ…å†µ, å¦‚æœæ˜¯æ¥æ”¶ä¸¤ä¸ªè¯·æ±‚ä½“å‘¢ï¼Ÿ</p><pre><code>class Girl(BaseModel):    name: str    age: Optional[str] = Noneclass Boy(BaseModel):    name: str    age: int@app.post(&quot;/boy_and_girl&quot;)async def read_boy_and_girl(girl: Girl,                            boy: Boy):    return {&quot;girl&quot;: dict(girl), &quot;boy&quot;: dict(boy)}</code></pre><p>å¯¹äºä¸Šè¿°è¿™ç§å†™æ³•, åœ¨ä¼ å…¥bodyæ•°æ®æ—¶, åœ¨jsonä¸²ä¸­ åº”è¯¥æœ‰ä¸¤ä¸ªå­jsonä¸²ï¼Œä¸”å…¶keyåˆ†åˆ«ä¸º girl/boy</p><p>å¦‚ä½•ç†è§£?</p><p>å®é™…ä¸Šå¯¹äº ç»§æ‰¿äº† BaseModelæˆ–è€… è·¯ç”±å‡½æ•°ä¸­ ç›´æ¥ä½¿ç”¨ Bodyç±»å‹è¿›è¡Œå£°æ˜çš„ å‚æ•°, æ¡†æ¶éƒ½ä¼šæ¥æ”¶ä¸º bodyå‚æ•°, è¿™äº›bodyå‚æ•°å¯ä»¥çœ‹åšæ˜¯å…³é”®å­—å‚æ•°, ä½†æ˜¯å½“ åªæœ‰ä¸€ä¸ª BaseModelç±»å‹æ—¶, å°±å¯ä»¥ä¸ä½¿ç”¨å…³é”®å­—è¿›è¡Œè¯†åˆ«</p><p>ä¸Šè¿°æ¡ˆä¾‹çš„è¯·æ±‚ä½“ç¤ºä¾‹å¦‚ä¸‹:</p><pre><code>{    &quot;girl&quot;: {&quot;name&quot;: &quot;æ–°å£ç»“è¡£&quot;, &quot;age&quot;: 18},    &quot;boy&quot;: {&quot;name&quot;: &quot;æ˜Ÿé‡æº&quot;, &quot;age&quot;: 18}}</code></pre><p>PS: å…¶å®ä¸Šè¿°å†™æ³•, ä¹Ÿå¯ä»¥åªæ˜¯ç”¨ä¸€ä¸ª è¯·æ±‚ä½“æ¥è¡¨ç¤º( å³è¿™ç§ BaseModelçš„å†™æ³•æ˜¯å¯ä»¥å¤šå±‚åµŒå¥—çš„~)</p><pre><code>class Girl(BaseModel):    name: str    age: Optional[str] = Noneclass Boy(BaseModel):    name: str    age: intclass BoyGirl(BaseModel):    girl: Girl    boy: Boy@app.post(&quot;/boy_and_girl&quot;)async def read_boy_and_girl(boy_girl: BoyGirl):    return dict(boy_girl)</code></pre><h4 id="5-3-3-è·å–fromè¡¨å•æ•°æ®"><a href="#5-3-3-è·å–fromè¡¨å•æ•°æ®" class="headerlink" title="5.3.3 è·å–fromè¡¨å•æ•°æ®"></a>5.3.3 è·å–fromè¡¨å•æ•°æ®</h4><p><strong>æ–¹å¼ä¸€: ä½¿ç”¨ Form ç±»å‹</strong></p><pre><code>from fastapi import FastAPI, Formapp = FastAPI()@app.post(&quot;/login&quot;)async def user_login(username: str = Form(...),        # è¿™é‡Œçš„Formç±»å‹ è¡¨æ˜æ¥æ”¶çš„æ˜¯ formè¡¨å•çš„æ•°æ®                   password: str = Form(...)):    return {&quot;username&quot;: username, &quot;password&quot;: password}</code></pre><p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨request</strong></p><pre><code>from fastapi import FastAPI, Requestapp = FastAPI()@app.post(&quot;/girl&quot;)async def girl(request: Request):    # æ­¤æ—¶ await request.json() æŠ¥é”™ï¼Œå› ä¸ºæ˜¯é€šè¿‡ data å‚æ•°ä¼ é€’çš„ï¼Œç›¸å½“äº form è¡¨å•æäº¤    # å¦‚æœæ˜¯é€šè¿‡ json å‚æ•°ä¼ é€’ï¼Œé‚£ä¹ˆ await request.form() ä¼šå¾—åˆ°ä¸€ä¸ªç©ºè¡¨å•    form = await request.form()    return [form.get(&quot;name&quot;), form.getlist(&quot;age&quot;)]</code></pre><p>PS: pythonå¦‚ä½•å‘é€ formè¡¨å•æ•°æ®ï¼ˆä½¿ç”¨ dataå‚æ•°ï¼‰</p><pre><code>requests.post(url, data={&quot;name&quot;: &quot;test1&quot;, &quot;password&quot;: &quot;test2&quot;})</code></pre><h4 id="5-3-4-è·å–æ–‡ä»¶ä¸Šä¼ æ•°æ®"><a href="#5-3-4-è·å–æ–‡ä»¶ä¸Šä¼ æ•°æ®" class="headerlink" title="5.3.4 è·å–æ–‡ä»¶ä¸Šä¼ æ•°æ®"></a>5.3.4 è·å–æ–‡ä»¶ä¸Šä¼ æ•°æ®</h4><p><strong>1.è·å–å•ä¸ªæ–‡ä»¶(ä½¿ç”¨ Fileç±»å‹)</strong></p><pre><code>from fastapi import FastAPI, File, UploadFileapp = FastAPI()@app.post(&quot;/file1&quot;)async def file1(file: bytes = File(...)):        # è¿™é‡Œä½¿ç”¨çš„æ˜¯ Fileç±»å‹ æ¥æ”¶çš„æ˜¯ä¸€ä¸ª bytes å­—èŠ‚æµ    return f&quot;æ–‡ä»¶é•¿åº¦: {len(file)}&quot;@app.post(&quot;/file2&quot;)async def file1(file: UploadFile = File(...)):        # è¿™é‡Œæ¥æ”¶çš„æ˜¯ ä¸€ä¸ªæ–‡ä»¶å¥æŸ„å¯¹è±¡, è¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥è·å–åˆ°ä¸Šä¼ çš„æ–‡ä»¶    return f&quot;æ–‡ä»¶å: {file.filename}, æ–‡ä»¶å¤§å°: {len(await file.read())}&quot;</code></pre><p><strong>2.è·å–å¤šä¸ªæ–‡ä»¶</strong></p><pre><code>@app.post(&quot;/file&quot;)async def file(files: List[UploadFile] = File(...)):    &quot;&quot;&quot;æŒ‡å®šç±»å‹ä¸ºåˆ—è¡¨å³å¯&quot;&quot;&quot;    for idx, f in enumerate(files):        files[idx] = f&quot;æ–‡ä»¶å: {f.filename}, æ–‡ä»¶å¤§å°: {len(await f.read())}&quot;    return f</code></pre><p>PSï¼š Pythonå¦‚ä½•ä¸Šä¼ æ–‡ä»¶?</p><p>é¦–å…ˆå¦‚æœæƒ³ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œé‚£ä¹ˆä½ å¿…é¡»è¦å®‰è£…ä¸€ä¸ªåŒ… python-multipartï¼Œç›´æ¥ pip install python-multipart å³å¯ã€‚</p><pre><code># ä¸Šä¼ å•ä¸ªæ–‡ä»¶requests.post(url, files={&quot;file&quot;: open(r&quot;/file_path/file_name&quot;, &quot;rb&quot;)})# ä¸Šä¼ å¤šä¸ªæ–‡ä»¶requests.post(url, files={&quot;file&quot;: [            (&quot;files&quot;, open(r&quot;/file_path1/file_name1&quot;),               (&quot;files&quot;, open(r&quot;/file_path2/file_name2&quot;),            (&quot;files&quot;, open(r&quot;/file_path3/file_name3&quot;)]})</code></pre><h3 id="5-4-è·å–pathç±»å‹å‚æ•°"><a href="#5-4-è·å–pathç±»å‹å‚æ•°" class="headerlink" title="5.4 è·å–pathç±»å‹å‚æ•°"></a>5.4 è·å–pathç±»å‹å‚æ•°</h3><p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªè·¯ç”±ï¼š<code>/files/{file\_path}</code>ï¼Œè€Œç”¨æˆ·ä¼ é€’çš„ file_path ä¸­æ˜¾ç„¶æ˜¯å¯ä»¥å¸¦ / çš„ï¼Œå‡è®¾ file_path æ˜¯ <code>/root/test.py</code>ï¼Œé‚£ä¹ˆè·¯ç”±å°±å˜æˆäº† <code>/files//root/test.py</code>ï¼Œæ˜¾ç„¶è¿™æ ·å­è¿›è¡Œè·¯ç”±åŒ¹é…å°±ä¼šå‡ºé—®é¢˜ã€‚</p><p>è¿™æ˜¯æˆ‘ä»¬éœ€è¦å£°æ˜ file_path çš„ç±»å‹ä¸º path, eg. @app.get(â€œ/files/{file_path:path}â€)</p><p><strong>æ–¹å¼ä¸€: å£°æ˜pathç±»å‹</strong></p><pre><code>from fastapi import FastAPIapp = FastAPI()</code></pre><p>â€‹<br>    # å£°æ˜ file_path çš„ç±»å‹ä¸º pathï¼Œè¿™æ ·å®ƒä¼šè¢«å½“æˆä¸€ä¸ªæ•´ä½“<br>    @app.get(â€œ/files/{file_path:path}â€)<br>    async def get_file(file_path: str):<br>        return {â€œfile_pathâ€: file_path}</p><p><strong>æ–¹å¼äºŒ: ä½¿ç”¨Path ç±»å‹æ³¨é‡Š</strong></p><pre><code>from fastapi import FastAPI, Path@app.get(&quot;/items/{item-id}&quot;)# è¿™é‡Œç”¨ Pathç±»å‹æ¥æ¥æ”¶, ä¹Ÿä¼šå°†åé¢çš„æ•´ä½“ä½œä¸ºä¸€ä¸ªpath.# è¿™é‡Œçš„ aliasè¡¨ç¤º é‡å‘½å, ä¹Ÿå°±æ˜¯å°† è·¯ç”±å‡½æ•°ä¸­çš„ å˜é‡ item_id ä¸ è·¯ç”±ä¸­çš„ item-id å¯¹åº”ä¸Š.async def read_items(item_id: int = Path(..., alias=&quot;item-id&quot;)):    return {&quot;item_id&quot;: item_id}</code></pre><p>PS: ä¹Ÿå°±æ˜¯è¯´, å½“è·¯å¾„å‚æ•°ä¸­ å£°æ˜äº† ä¸€ä¸ªå‚æ•°ä¸º Pathç±»å‹, é‚£ä¹ˆè¿™ä¸ªå‚æ•°åé¢ä¸èƒ½åœ¨æ¥å…¶ä»–çš„è·¯å¾„å‚æ•°ã€‚å³ <code>@app.get(&quot;/files/{file\_path:path}/{user\_id}&quot;)</code> è¿™æ ·çš„å†™æ³•ï¼Œ user_idå°±è·å–ä¸åˆ°~</p><h3 id="5-5-å¤šç§è¯·æ±‚å‚æ•°æ··åˆè·å–"><a href="#5-5-å¤šç§è¯·æ±‚å‚æ•°æ··åˆè·å–" class="headerlink" title="5.5 å¤šç§è¯·æ±‚å‚æ•°æ··åˆè·å–"></a>5.5 å¤šç§è¯·æ±‚å‚æ•°æ··åˆè·å–</h3><h4 id="5-5-1-è·¯ç”±å‡½æ•°ä¸­ä½¿ç”¨ç±»å‹åŒºåˆ«"><a href="#5-5-1-è·¯ç”±å‡½æ•°ä¸­ä½¿ç”¨ç±»å‹åŒºåˆ«" class="headerlink" title="5.5.1 è·¯ç”±å‡½æ•°ä¸­ä½¿ç”¨ç±»å‹åŒºåˆ«"></a>5.5.1 è·¯ç”±å‡½æ•°ä¸­ä½¿ç”¨ç±»å‹åŒºåˆ«</h4><p><strong>æ–¹å¼ä¸€: ç›´æ¥ä½¿ç”¨å†…ç½®æ–¹å¼è·å–</strong></p><p>1.å¦‚æœåœ¨è·¯å¾„ä¸­ä¹Ÿå£°æ˜äº†è¯¥å‚æ•°ï¼Œå®ƒå°†è¢«ç”¨ä½œè·¯å¾„å‚æ•°</p><p>2.å¦‚æœå‚æ•°å±äºå•ä¸€ç±»å‹ï¼ˆæ¯”å¦‚ intã€floatã€strã€bool ç­‰ï¼‰å®ƒå°†è¢«è§£é‡Šä¸ºæŸ¥è¯¢å‚æ•°ã€‚</p><p>   3.å¦‚æœå‚æ•°çš„ç±»å‹è¢«å£°æ˜ä¸ºä¸€ä¸ª Pydantic æ¨¡å‹ï¼Œå®ƒå°†è¢«è§£é‡Šä¸ºè¯·æ±‚ä½“ã€‚</p><pre><code>from fastapi import FastAPIfrom pydantic.main import BaseModelapp = FastAPI()class Girl(BaseModel):    name: str    age: int@app.get(&quot;/user/{user_id}&quot;)async def get_user(user_id: str, name: str, age: int, girl: Girl):    # user_id ä¸ºè·¯å¾„å‚æ•°    # name/age ä¸ºparamså‚æ•°    # girl ä¸ºbodyå‚æ•°    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name, &quot;age&quot;: age, &quot;girl&quot;: girl.dict()}</code></pre><p><strong>æ–¹å¼äºŒ: ä½¿ç”¨ ç±»å‹æ³¨é‡Šæ¥è·å–</strong></p><p>Path(è·¯å¾„å‚æ•°)/Query(paramså‚æ•°)/Body(jsonè¯·æ±‚ä½“)/Form(formè¡¨å•è¯·æ±‚ä½“)/File(æ–‡ä»¶)</p><p>Cookie(cookieå‚æ•°)/Header(è¯·æ±‚å¤´)</p><p>å…³äº Path(è·¯å¾„å‚æ•°)/Query(paramså‚æ•°)/Body(jsonè¯·æ±‚ä½“)/Form(formè¡¨å•è¯·æ±‚ä½“)/File(æ–‡ä»¶)çš„ä½¿ç”¨æ–¹å¼, ä¸Šé¢å·²ç»æœ‰è¿‡å±•ç¤ºï¼Œ è¿™é‡Œä¸å†èµ˜è¿°</p><p>Cookie:</p><p>1.å£°æ˜ï¼šads_id: Optional[str] = Cookie(None)</p><p>Headerï¼š</p><p>1.å£°æ˜ï¼š user_agent: Optional[str] = Header(None)</p><p>2.é»˜è®¤æƒ…å†µä¸‹, Header å°†æŠŠå‚æ•°åç§°çš„å­—ç¬¦ä»ä¸‹åˆ’çº¿ (_) è½¬æ¢ä¸ºè¿å­—ç¬¦ (-) æ¥æå–å¹¶è®°å½• headers.</p><p>3.è®¾ç½®Headerçš„å‚æ•° convert_underscores ä¸º False, å¯ä»¥å–æ¶ˆä¸Šè¿°çš„ ä¸‹åˆ’çº¿åˆ°è¿å­—ç¬¦çš„è‡ªåŠ¨è½¬æ¢</p><p>4.headers æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„</p><p>5.å£°æ˜å¤šä¸ªheader: x_token: Optional[List[str]] = Header(None) â€“&gt; ä¾‹: ä½¿ç”¨headerä¼ è¾“ cookieçš„æƒ…å†µ</p><p>PSï¼š</p><p>Cookie ã€Headerã€Path ã€Queryæ˜¯å…„å¼Ÿç±»ï¼Œå®ƒä»¬éƒ½ç»§æ‰¿è‡ªå…¬å…±çš„ Param ç±» â€“&gt; å¾ˆæ˜æ˜¾Body/File/Formä¸æ˜¯</p><h4 id="5-5-2-ä½¿ç”¨requestå¯¹è±¡è·å–"><a href="#5-5-2-ä½¿ç”¨requestå¯¹è±¡è·å–" class="headerlink" title="5.5.2 ä½¿ç”¨requestå¯¹è±¡è·å–"></a>5.5.2 ä½¿ç”¨requestå¯¹è±¡è·å–</h4><p>ä»»ä½•ä¸€ä¸ªè¯·æ±‚éƒ½å¯¹åº”ä¸€ä¸ª Request å¯¹è±¡ï¼Œè¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨è¿™ä¸ª Request å¯¹è±¡ä¸­</p><p>è·å–å‚æ•°æ–¹å¼å¦‚ä¸‹ï¼š</p><pre><code>@app.get(&quot;/girl/{user_id}&quot;)async def read_girl(user_id: str,                    request: Request):    &quot;&quot;&quot;è·¯å¾„å‚æ•°æ˜¯å¿…é¡»è¦ä½“ç°åœ¨å‚æ•°ä¸­ï¼Œä½†æ˜¯æŸ¥è¯¢å‚æ•°å¯ä»¥ä¸å†™äº†       å› ä¸ºæˆ‘ä»¬å®šä¹‰äº† request: Requestï¼Œé‚£ä¹ˆè¯·æ±‚ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šè¿›å…¥åˆ°è¿™ä¸ª Request å¯¹è±¡ä¸­&quot;&quot;&quot;    header = request.headers  # è¯·æ±‚å¤´    method = request.method  # è¯·æ±‚æ–¹æ³•    cookies = request.cookies  # cookies    query_params = request.query_params  # æŸ¥è¯¢å‚æ•°    body_data = await request.json()  # è·å–jsonè¯·æ±‚ä½“, è¯¥å‡½æ•°æœ¬è´¨ä¸Šæ­¥éª¤ä¸º: body = await self.body() + self._json = json.loads(body)    return {&quot;name&quot;: query_params.get(&quot;name&quot;), &quot;age&quot;: query_params.get(&quot;age&quot;), &quot;hobby&quot;: query_params.getlist(&quot;hobby&quot;)}</code></pre><h4 id="5-5-3-å‚æ•°é¡ºåº"><a href="#5-5-3-å‚æ•°é¡ºåº" class="headerlink" title="5.5.3 å‚æ•°é¡ºåº"></a>5.5.3 å‚æ•°é¡ºåº</h4><p>è·¯å¾„å‚æ•°åº”è¯¥åœ¨æŸ¥è¯¢å‚æ•°çš„å‰é¢ï¼Œå°½ç®¡ FastAPI æ²¡æœ‰è¿™ä¸ªè¦æ±‚ï¼Œä½†æ˜¯è¿™æ ·å†™æ˜æ˜¾æ›´èˆ’æœä¸€äº›ã€‚ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œå¦‚æœè·¯å¾„å‚æ•°éœ€è¦æŒ‡å®šåˆ«åï¼Œä½†æ˜¯æŸä¸€ä¸ªæŸ¥è¯¢å‚æ•°ä¸éœ€è¦ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜</p><pre><code>@app.get(&quot;/items/{item-id}&quot;)async def read_items(q: str,                     item_id: int = Path(..., alias=&quot;item-id&quot;)):    return {&quot;item_id&quot;: item_id, &quot;q&quot;: q}</code></pre><p>æ˜¾ç„¶æ­¤æ—¶ Python çš„è¯­æ³•å°±å†³å®šäº† item_id å°±å¿…é¡»æ”¾åœ¨ q çš„åé¢ï¼Œå½“ç„¶è¿™ä¹ˆåšæ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ï¼ŒFastAPI å¯¹å‚æ•°çš„å…ˆåé¡ºåºæ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œå› ä¸ºå®ƒæ˜¯é€šè¿‡å‚æ•°çš„åç§°ã€ç±»å‹å’Œé»˜è®¤å€¼å£°æ˜æ¥æ£€æµ‹å‚æ•°ï¼Œè€Œä¸åœ¨ä¹å‚æ•°çš„é¡ºåºã€‚ä½†æ­¤æ—¶æˆ‘ä»¬å°±è¦è®© item_id åœ¨ q çš„å‰é¢è¦æ€ä¹ˆåšå‘¢ï¼Ÿ</p><pre><code>@app.get(&quot;/items/{item-id}&quot;)async def read_items(*, item_id: int = Path(..., alias=&quot;item-id&quot;),                     q: str):    return {&quot;item_id&quot;: item_id, &quot;q&quot;: q}</code></pre><p>é€šè¿‡å°†ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º *ï¼Œä½¿å¾— item_id å’Œ q éƒ½å¿…é¡»é€šè¿‡å…³é”®å­—ä¼ é€’ï¼Œæ‰€ä»¥æ­¤æ—¶é»˜è®¤å‚æ•°åœ¨éé»˜è®¤å‚æ•°ä¹‹å‰ä¹Ÿæ˜¯å…è®¸çš„ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿä¸éœ€è¦æ‹…å¿ƒ FastAPI ä¼ å‚çš„é—®é¢˜ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒæ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯é€šè¿‡å…³é”®å­—å‚æ•°çš„æ–¹å¼ä¼ é€’çš„ã€‚</p><h2 id="å…­ã€æ•°æ®æ ¡éªŒ"><a href="#å…­ã€æ•°æ®æ ¡éªŒ" class="headerlink" title="å…­ã€æ•°æ®æ ¡éªŒ"></a>å…­ã€æ•°æ®æ ¡éªŒ</h2><h3 id="6-1-ç±»å‹æ³¨é‡Šçš„æ•°æ®æ ¡éªŒæ–¹å¼"><a href="#6-1-ç±»å‹æ³¨é‡Šçš„æ•°æ®æ ¡éªŒæ–¹å¼" class="headerlink" title="6.1 ç±»å‹æ³¨é‡Šçš„æ•°æ®æ ¡éªŒæ–¹å¼"></a>6.1 ç±»å‹æ³¨é‡Šçš„æ•°æ®æ ¡éªŒæ–¹å¼</h3><p>Path(è·¯å¾„å‚æ•°)/Query(paramså‚æ•°)/Body(jsonè¯·æ±‚ä½“)/Form(formè¡¨å•è¯·æ±‚ä½“)/File(æ–‡ä»¶)/Cookie(cookieå‚æ•°)/Header(è¯·æ±‚å¤´)</p><p>ä¸Šè¿°è¿™äº› ç±»åœ¨ç”¨äº ç±»å‹æ³¨é‡Šæ—¶, ä½¿ç”¨æ–¹å¼åŸºæœ¬éƒ½å·®ä¸å¤š, åªæ˜¯åœ¨æŸäº›æ–¹é¢æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«</p><p>6.1.1 å…¬å…±æ ¡éªŒéƒ¨åˆ†</p><p>è¿™é‡Œä»¥Queryä¸ºä¾‹</p><pre><code>Query(            None,            alias=&quot;item-query&quot;,            title=&quot;Query string&quot;,            description=&quot;Query string for the items to search in the database that have a good match&quot;,            min_length=3,            max_length=50,            regex=&quot;^fixedquery$&quot;,            deprecated=True,        )        1.ä¿®æ”¹é¢å¤–çš„åŸæ•°æ®:            alias - èµ·åˆ«å            title/description - æ–‡æ¡£æè¿°            deprecated - å‚æ•°å¼ƒç”¨æ ‡è¯†        2.ç”¨äºæ ¡éªŒçš„å‚æ•°ï¼š                min_length/max_length    é•¿åº¦åŒ¹é…            regex        æ­£åˆ™åŒ¹é…        3.æ•°å€¼æ ¡éªŒ:            gt/ge/lt/leï¼š å¤§äº/å¤§äºç­‰äº/å°äº/å°äºç­‰äº å®šä¹‰ä¸ºfloatç±»å‹        4.è®¾ç½®å¿…å¡«/éå¿…å¡«/é»˜è®¤å€¼        Query(...)    - è®¾ç½®ä¸ºå¿…å¡«         Query(None) - è®¾ç½®ä¸ºéå¿…å¡«      Query(&quot;test&quot;) - è®¾ç½®é»˜è®¤å€¼ test     5.æ¥æ”¶åˆ—è¡¨         q: Optional[List[str]] = Query(None) å®šä¹‰ queryå‚æ•°ä¸ºå¿…å¡«çš„list, å³èƒ½åŒ¹é… xxx_url?q=foo&amp;q=bar ---&gt; q=[&#39;foo&#39;, &#39;bar&#39;]     6.æŒ‡å®šæ•°æ®æ¥æ”¶ç±»å‹         q:  Optional[str] = Query(...)      q: str          è¿™é‡Œæ”¯æŒçš„æ•°æ®ç±»å‹:      int/float/str/bool/list/dict/set      UUID/datetime.datetime(2008-09-15T15:53:00+05:00)/datetime.date(2008-09-15)      datetime.time(14:23:55.003)/datetime.timedelta(æ—¶é—´æˆ³ç§’æ•°)/bytes/Decimal(æ¡†æ¶å†…å¯å½“åšfloatä½¿ç”¨)         æ”¯æŒæŒ‡å®šå¤šç§æ•°æ®ç±»å‹ï¼š          user_id: Union[int, str]</code></pre><p>ä¸¾ä¸ªä¾‹å­:</p><pre><code>@app.get(&quot;/user&quot;)async def check_length(        password: str = Query(&quot;satori&quot;, min_length=6, max_length=15, regex=r&quot;^satori&quot;)):    &quot;&quot;&quot;æ­¤æ—¶çš„ password é»˜è®¤å€¼ä¸º &#39;satori&#39;ï¼Œå¹¶ä¸”ä¼ é€’çš„æ—¶å€™å¿…é¡»è¦ä»¥ &#39;satori&#39; å¼€å¤´       ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯ password åé¢çš„æ˜¯ strï¼Œä¸å†æ˜¯ Optional[str]ï¼Œå› ä¸ºé»˜è®¤å€¼ä¸æ˜¯ None äº†       å½“ç„¶è¿™é‡Œå³ä½¿å†™æˆ Optional[str] ä¹Ÿæ˜¯æ²¡æœ‰ä»€ä¹ˆå½±å“çš„    &quot;&quot;&quot;    return {&quot;password&quot;: password}</code></pre><p>â€‹<br>    @app.get(â€œ/itemsâ€)<br>    async def read_items(<br>            a1: str = Query(â€¦),    # â€¦ è®¾ç½®ä¸ºå¿…å¡«å‚æ•°<br>            a2: List[str] = Query(â€¦), # æŸ¥è¯¢å‚æ•°å˜æˆä¸€ä¸ªåˆ—è¡¨; å¯¹åº”äº urlå a=1&amp;a=2çš„æƒ…å†µ<br>            b: List[str] = Query(â€¦)<br>    ):<br>        return {â€œa1â€: a1, â€œa2â€: a2, â€œbâ€: b}</p><pre><code>@app.get(&quot;/items&quot;)async def read_items(        # item1 å¿…é¡»å¤§äº 5        item1: int = Query(..., gt=5),        # æ•°å€¼æ£€æµ‹        # item2 å¿…é¡»å°äºç­‰äº 7        item2: int = Query(..., le=7),        # item3 å¿…é¡»å¿…é¡»ç­‰äº 10        item3: int = Query(..., ge=10, le=10)):    return {&quot;item1&quot;: item1, &quot;item2&quot;: item2, &quot;item3&quot;: item3}</code></pre><h4 id="6-1-2-å„ç±»å‹ç‰¹æ®Šéƒ¨åˆ†"><a href="#6-1-2-å„ç±»å‹ç‰¹æ®Šéƒ¨åˆ†" class="headerlink" title="6.1.2 å„ç±»å‹ç‰¹æ®Šéƒ¨åˆ†"></a>6.1.2 å„ç±»å‹ç‰¹æ®Šéƒ¨åˆ†</h4><p><strong>Path:</strong></p><p>1.è·¯å¾„å‚æ•°æ€»æ˜¯å¿…é¡»çš„, æ‰€ä»¥åº”è¡¨ç¤ºä¸ºPath(â€¦), å³ä½¿å†™ä¸ºäº† Path(None), ä¹Ÿè¿˜æ˜¯ä¸€ä¸ªå¿…é€‰å‚æ•°</p><p><strong>Headerï¼š</strong></p><p>1.é»˜è®¤æƒ…å†µä¸‹, Header å°†æŠŠå‚æ•°åç§°çš„å­—ç¬¦ä»ä¸‹åˆ’çº¿ (_) è½¬æ¢ä¸ºè¿å­—ç¬¦ (-) æ¥æå–å¹¶è®°å½• headers.</p><p>2.è®¾ç½®Headerçš„å‚æ•° convert_underscores ä¸º False, å¯ä»¥å–æ¶ˆä¸Šè¿°çš„ ä¸‹åˆ’çº¿åˆ°è¿å­—ç¬¦çš„è‡ªåŠ¨è½¬æ¢</p><p>3.headers æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„</p><h4 id="6-1-3-ç‰¹æ®Šæ£€éªŒç±»å‹-Filed"><a href="#6-1-3-ç‰¹æ®Šæ£€éªŒç±»å‹-Filed" class="headerlink" title="6.1.3 ç‰¹æ®Šæ£€éªŒç±»å‹ Filed"></a>6.1.3 ç‰¹æ®Šæ£€éªŒç±»å‹ Filed</h4><p>Filedä¸BaseModelä¸€æ ·, ç”±pydanticæ¨¡å—æä¾›</p><p>Filedç±»å‹çš„ç”¨æ³•ä¸ Queryä¸€è‡´, å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯Filedå¯ä»¥å¯¹æ‰€æœ‰ç±»å‹çš„ å‚æ•°è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œè€Œä¸åƒQuery/Bodyè¿™ç±»å‚æ•°, åœ¨æ ¡éªŒæ—¶, åªèƒ½è·å–å¯¹åº”çš„å‚æ•°ã€‚</p><p>å¦‚æœæœ‰ä¸ª usernameå‚æ•°å³åœ¨ paramså‚æ•°ä¸­ä¼šå‡ºç°ï¼Œ åœ¨bodyå‚æ•°ä¸­ä¹Ÿä¼šå‡ºç°, ç”šè‡³äºåœ¨ response ä¸­ä¹Ÿå¯èƒ½ä¼šå‡ºç°ï¼Œ æ­¤æ—¶ä½¿ç”¨ Filedè¿›è¡Œå‚æ•°éªŒè¯å°±æ¯”è¾ƒåˆé€‚</p><p>Filedçš„ä½¿ç”¨ ç¤ºä¾‹è§ 6.3</p><h3 id="6-2-å˜é‡ç±»å‹å£°æ˜çš„ç‰¹æ®Šæƒ…å†µ"><a href="#6-2-å˜é‡ç±»å‹å£°æ˜çš„ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="6.2 å˜é‡ç±»å‹å£°æ˜çš„ç‰¹æ®Šæƒ…å†µ"></a>6.2 å˜é‡ç±»å‹å£°æ˜çš„ç‰¹æ®Šæƒ…å†µ</h3><h4 id="6-2-1-é»˜è®¤å€¼ä¸å£°æ˜å€¼å¯ä¸åŒ"><a href="#6-2-1-é»˜è®¤å€¼ä¸å£°æ˜å€¼å¯ä¸åŒ" class="headerlink" title="6.2.1 é»˜è®¤å€¼ä¸å£°æ˜å€¼å¯ä¸åŒ"></a>6.2.1 é»˜è®¤å€¼ä¸å£°æ˜å€¼å¯ä¸åŒ</h4><pre><code>@app.get(&quot;/user/{user_id}&quot;)async def get_user(user_id: str, name: str = &quot;UNKNOWN&quot;, age: int = &quot;å“ˆå“ˆå“ˆ&quot;):    # è¿™é‡Œçš„ age éœ€è¦æ¥æ”¶ä¸€ä¸ªæ•´å‹ï¼Œä½†æ˜¯é»˜è®¤å€¼å´æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name, &quot;age&quot;: age}</code></pre><p>è¿™ç§æƒ…å†µä¸‹ä¼ é€’çš„ age ä¾æ—§éœ€è¦æ•´å‹ï¼Œåªä¸è¿‡åœ¨ä¸ä¼ çš„æ—¶å€™ä¼šä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹çš„é»˜è®¤å€¼ï¼Œæ‰€ä»¥ç±»å‹å’Œé»˜è®¤å€¼ç±»å‹ä¸åŒçš„æ—¶å€™ä¹Ÿæ˜¯å¯ä»¥çš„</p><h4 id="6-2-2-åŒä¸€ä¸ªå˜é‡æŒ‡å®šå¤šä¸ªç±»å‹"><a href="#6-2-2-åŒä¸€ä¸ªå˜é‡æŒ‡å®šå¤šä¸ªç±»å‹" class="headerlink" title="6.2.2 åŒä¸€ä¸ªå˜é‡æŒ‡å®šå¤šä¸ªç±»å‹"></a>6.2.2 åŒä¸€ä¸ªå˜é‡æŒ‡å®šå¤šä¸ªç±»å‹</h4><pre><code>from typing import Union, Optional@app.get(&quot;/user/{user_id}&quot;)async def get_user(user_id: Union[int, str], name: Optional[str] = None):    &quot;&quot;&quot;é€šè¿‡ Union æ¥å£°æ˜ä¸€ä¸ªæ··åˆç±»å‹ï¼Œint åœ¨å‰ã€str åœ¨åã€‚ä¼šå…ˆæŒ‰ç…§ int è§£æï¼Œè§£æå¤±è´¥å†å˜æˆ str       ç„¶åæ˜¯ nameï¼Œå®ƒè¡¨ç¤ºå­—ç¬¦ä¸²ç±»å‹ã€ä½†é»˜è®¤å€¼ä¸º Noneï¼ˆä¸æ˜¯å­—ç¬¦ä¸²ï¼‰ï¼Œé‚£ä¹ˆåº”è¯¥å£°æ˜ä¸º Optional[str]&quot;&quot;&quot;    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name}</code></pre><h4 id="6-2-3æŒ‡å®šæ•°æ®æ¥æ”¶ç±»å‹"><a href="#6-2-3æŒ‡å®šæ•°æ®æ¥æ”¶ç±»å‹" class="headerlink" title="6.2.3æŒ‡å®šæ•°æ®æ¥æ”¶ç±»å‹"></a>6.2.3æŒ‡å®šæ•°æ®æ¥æ”¶ç±»å‹</h4><p>q: Optional[str] = Query(â€¦)</p><p>q: str</p><p>è¿™é‡Œæ”¯æŒçš„æ•°æ®ç±»å‹:</p><p><code>int/float/str/bool/list/dict/set</code></p><p><code>UUID/datetime.datetime(2008-09-15T15:53:00+05:00)/datetime.date(2008-09-15)</code></p><p><code>datetime.time(14:23:55.003)/datetime.timedelta(æ—¶é—´æˆ³ç§’æ•°)/bytes/Decimal(æ¡†æ¶å†…å¯å½“åšfloatä½¿ç”¨)</code></p><p>æ”¯æŒæŒ‡å®šå¤šç§æ•°æ®ç±»å‹ï¼š</p><p>user_id: Union[int, str]</p><h3 id="6-3-BaseModelæ ¡éªŒæ–¹å¼"><a href="#6-3-BaseModelæ ¡éªŒæ–¹å¼" class="headerlink" title="6.3 BaseModelæ ¡éªŒæ–¹å¼"></a>6.3 BaseModelæ ¡éªŒæ–¹å¼</h3><p>è¿™é‡Œæ˜¯ç”¨äº† Filedåšç¤ºä¾‹, å¦‚æœæ˜¯ Bodyå‚æ•°, ä½¿ç”¨Bodyä¹Ÿå¯ï¼Œå…¶ä»–çš„ç±»æ¨~</p><p>ç¤ºä¾‹å¦‚ä¸‹:</p><pre><code>class UserIn(BaseModel):    &quot;&quot;&quot;ç”¨æˆ·ä¿¡æ¯ è¯·æ±‚æ ¼å¼&quot;&quot;&quot;    name: str = Field(..., min_length=1, max_length=64)    password: str = Field(..., min_length=1, max_length=32)    nickname: str = Field(None, max_length=64)    phone: str = Field(None, max_length=16, regex=r&#39;^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d{8}$&#39;)    # æ­£åˆ™åŒ¹é…    email: str = Field(None, max_length=32, regex=r&#39;^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$&#39;)class UserOut(BaseModel):    &quot;&quot;&quot;ç”¨æˆ·ä¿¡æ¯å“åº”æ ¼å¼&quot;&quot;&quot;    id: str = Field(..., max_length=32)    name: str = Field(..., min_length=1, max_length=64)    nickname: str = Field(None, max_length=64)    last_login_address: str = Field(None, max_length=32)    last_login_time: datetime.datetime = Field(None)    # æŒ‡å®šdatetimeç±»å‹    login_counts: int = Field(0)        # è®¾ç½®é»˜è®¤å€¼ 0    phone: str = Field(None, max_length=16)        # è®¾ç½®ä¸ºéå¿…é¡»å­—æ®µ    email: str = Field(None, max_length=32)    enabled: int = Field(1)    is_deleted: int = Field(0)</code></pre><h3 id="6-4-HTTPéªŒè¯-security"><a href="#6-4-HTTPéªŒè¯-security" class="headerlink" title="6.4 HTTPéªŒè¯ security"></a>6.4 HTTPéªŒè¯ security</h3><p>é€šè¿‡è¾“å…¥ç”¨æˆ·åå’Œå¯†ç æ¥ç¡®è®¤èº«ä»½</p><pre><code>from fastapi import FastAPI, Dependsfrom fastapi.security import HTTPBasic, HTTPBasicCredentialsimport uvicornapp = FastAPI()security = HTTPBasic()@app.get(&quot;/index&quot;)async def index(credentials: HTTPBasicCredentials = Depends(security)):    return {&quot;username&quot;: credentials.username, &quot;password&quot;: credentials.password}</code></pre><p>å½“ç”¨æˆ·è®¿é—® /index çš„æ—¶å€™ï¼Œä¼šæç¤ºè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼š</p><p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/a/dvlvakm1DFPw2BLV/3291b0841ffd47239b6543f1f0c3d3771684.png" alt="image"> </p><p>è¾“å…¥å®Œæ¯•ä¹‹åï¼Œä¿¡æ¯ä¼šä¿å­˜åœ¨ credentialsï¼Œæˆ‘ä»¬å¯ä»¥è·å–å‡ºæ¥è¿›è¡ŒéªŒè¯ã€‚</p><h3 id="6-5-å…¶ä»–"><a href="#6-5-å…¶ä»–" class="headerlink" title="6.5 å…¶ä»–"></a>6.5 å…¶ä»–</h3><h4 id="6-5-1-ä½¿ç”¨æšä¸¾"><a href="#6-5-1-ä½¿ç”¨æšä¸¾" class="headerlink" title="6.5.1 ä½¿ç”¨æšä¸¾"></a>6.5.1 ä½¿ç”¨æšä¸¾</h4><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå‚æ•°çš„å–å€¼èŒƒå›´åªèƒ½æ˜¯å›ºå®šçš„ å‡ ä¸ªå€¼, å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹</p><p>ç¤ºä¾‹å¦‚ä¸‹:</p><pre><code>from enum import Enumclass Gander(str, Enum):    type1 = &quot;boy&quot;        # è¿™é‡Œ type1 åªæ˜¯ä¸€ä¸ªéšæ„å˜é‡, æ²¡æœ‰ä»»ä½•å…¶ä»–å«ä¹‰    type2 = &quot;girl&quot;@app.get(&quot;/users/{gander_type}&quot;)async def get_user(gander_type: Gander):    return {&quot;gander_type&quot;: gander_type}    # è¿™é‡Œçš„ gander_type å°±åªèƒ½æ˜¯ boy/girl; å¦åˆ™å°±ä¼šæŠ›é”™</code></pre><h4 id="6-5-2-bool-ç±»å‹è‡ªåŠ¨è½¬æ¢"><a href="#6-5-2-bool-ç±»å‹è‡ªåŠ¨è½¬æ¢" class="headerlink" title="6.5.2 bool ç±»å‹è‡ªåŠ¨è½¬æ¢"></a>6.5.2 bool ç±»å‹è‡ªåŠ¨è½¬æ¢</h4><p>å¯¹äºå¸ƒå°”ç±»å‹ï¼ŒFastAPI æ”¯æŒè‡ªåŠ¨è½¬æ¢</p><pre><code>@app.get(&quot;/{flag}&quot;)async def get_flag(flag: bool):    return {&quot;flag&quot;: flag}        # è¿™é‡Œ flag ä¸º True/true/on/yes/1 å‡ä¼šè½¬æ¢ä¸º True; 0/False/false/off/no å‡ä¼šè½¬ä¸º False</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FastAPI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·</title>
      <link href="/2021/10/18/supervisor/"/>
      <url>/2021/10/18/supervisor/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€supervisorç®€ä»‹"><a href="#ä¸€ã€supervisorç®€ä»‹" class="headerlink" title="ä¸€ã€supervisorç®€ä»‹"></a>ä¸€ã€supervisorç®€ä»‹</h2><p>Supervisoræ˜¯ç”¨Pythonå¼€å‘çš„ä¸€å¥—é€šç”¨çš„è¿›ç¨‹ç®¡ç†ç¨‹åºï¼Œèƒ½å°†ä¸€ä¸ªæ™®é€šçš„å‘½ä»¤è¡Œè¿›ç¨‹å˜ä¸ºåå°daemonï¼Œå¹¶ç›‘æ§è¿›ç¨‹çŠ¶æ€ï¼Œå¼‚å¸¸é€€å‡ºæ—¶èƒ½è‡ªåŠ¨é‡å¯ã€‚å®ƒæ˜¯é€šè¿‡fork/execçš„æ–¹å¼æŠŠè¿™äº›è¢«ç®¡ç†çš„è¿›ç¨‹å½“ä½œsupervisorçš„å­è¿›ç¨‹æ¥å¯åŠ¨ï¼Œè¿™æ ·åªè¦åœ¨supervisorçš„é…ç½®æ–‡ä»¶ä¸­ï¼ŒæŠŠè¦ç®¡ç†çš„è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„å†™è¿›å»å³å¯ã€‚ä¹Ÿå®ç°å½“å­è¿›ç¨‹æŒ‚æ‰çš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥å‡†ç¡®è·å–å­è¿›ç¨‹æŒ‚æ‰çš„ä¿¡æ¯çš„ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦è‡ªå·±å¯åŠ¨å’ŒæŠ¥è­¦ã€‚supervisorè¿˜æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥ä¸ºsupervisordæˆ–è€…æ¯ä¸ªå­è¿›ç¨‹ï¼Œè®¾ç½®ä¸€ä¸ªérootçš„userï¼Œè¿™ä¸ªuserå°±å¯ä»¥ç®¡ç†å®ƒå¯¹åº”çš„è¿›ç¨‹ã€‚</p><h2 id="äºŒã€å®‰è£…supervisor"><a href="#äºŒã€å®‰è£…supervisor" class="headerlink" title="äºŒã€å®‰è£…supervisor"></a>äºŒã€å®‰è£…supervisor</h2><ol><li>ä½¿ç”¨yumå®‰è£…ï¼Œåœ¨é…å¥½yumæºä¹‹åï¼Œå¯ä»¥ç›´æ¥å®‰è£…<pre class="line-numbers language-shell"><code class="language-shell">yum install supervisor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>pip å®‰è£…<pre class="line-numbers language-shell"><code class="language-shell">pip install supervisor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h2 id="ä¸‰ã€ç”Ÿæˆsupervisoré…ç½®æ–‡ä»¶"><a href="#ä¸‰ã€ç”Ÿæˆsupervisoré…ç½®æ–‡ä»¶" class="headerlink" title="ä¸‰ã€ç”Ÿæˆsupervisoré…ç½®æ–‡ä»¶"></a>ä¸‰ã€ç”Ÿæˆsupervisoré…ç½®æ–‡ä»¶</h2><p><strong>supervisoré…ç½®æ–‡ä»¶</strong><br>è¿è¡Œå‘½ä»¤<code>echo_supervisord_conf</code>ç”Ÿæˆsupervisorçš„åˆå§‹é…ç½®æ–‡ä»¶:</p><pre class="line-numbers language-shell"><code class="language-shell">echo_supervisord_conf > /etc/supervisord.conf # ç”Ÿæˆåœ¨å“ªä¸ªåœ°æ–¹å¯ä»¥è‡ªå·±é€‰æ‹©<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><em>æ³¨ï¼šsupervisorçš„é…ç½®æ–‡ä»¶é»˜è®¤æ˜¯ä¸å…¨çš„ï¼Œä¸è¿‡åœ¨å¤§éƒ¨åˆ†é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œä¸Šé¢è¯´çš„åŸºæœ¬åŠŸèƒ½å·²ç»æ»¡è¶³ã€‚</em></p><p><strong>supervisorå­è¿›ç¨‹é…ç½®æ–‡ä»¶</strong><br>éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶<code>files</code>å­—æ®µçš„è·¯å¾„(å­è¿›ç¨‹é…ç½®æ–‡ä»¶è·¯å¾„)</p><pre class="line-numbers language-shell"><code class="language-shell">...;[include]files = /etc/supervisord.d/*.ini # å­è¿›ç¨‹é…ç½®æ–‡ä»¶è·¯å¾„, éœ€è¦æ‰‹åŠ¨åˆ›å»º<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><em>é»˜è®¤å­è¿›ç¨‹é…ç½®æ–‡ä»¶ä¸ºiniæ ¼å¼ï¼Œå¯åœ¨supervisorä¸»é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ã€‚</em></p><h2 id="å››ã€supervisoré…ç½®æ–‡ä»¶çš„è¯´æ˜"><a href="#å››ã€supervisoré…ç½®æ–‡ä»¶çš„è¯´æ˜" class="headerlink" title="å››ã€supervisoré…ç½®æ–‡ä»¶çš„è¯´æ˜"></a>å››ã€supervisoré…ç½®æ–‡ä»¶çš„è¯´æ˜</h2><h4 id="supervisor-confé…ç½®æ–‡ä»¶è¯´æ˜ï¼š"><a href="#supervisor-confé…ç½®æ–‡ä»¶è¯´æ˜ï¼š" class="headerlink" title="supervisor.confé…ç½®æ–‡ä»¶è¯´æ˜ï¼š"></a>supervisor.confé…ç½®æ–‡ä»¶è¯´æ˜ï¼š</h4><pre class="line-numbers language-shell"><code class="language-shell">[unix_http_server]file=/tmp/supervisor.sock   ;UNIX socket æ–‡ä»¶ï¼Œsupervisorctl ä¼šä½¿ç”¨;chmod=0700                 ;socketæ–‡ä»¶çš„modeï¼Œé»˜è®¤æ˜¯0700;chown=nobody:nogroup       ;socketæ–‡ä»¶çš„ownerï¼Œæ ¼å¼ï¼šuid:gid;[inet_http_server]         ;HTTPæœåŠ¡å™¨ï¼Œæä¾›webç®¡ç†ç•Œé¢;port=127.0.0.1:9001        ;Webç®¡ç†åå°è¿è¡Œçš„IPå’Œç«¯å£ï¼Œå¦‚æœå¼€æ”¾åˆ°å…¬ç½‘ï¼Œéœ€è¦æ³¨æ„å®‰å…¨æ€§;username=user              ;ç™»å½•ç®¡ç†åå°çš„ç”¨æˆ·å;password=123               ;ç™»å½•ç®¡ç†åå°çš„å¯†ç [supervisord]logfile=/tmp/supervisord.log ;æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ $CWD/supervisord.loglogfile_maxbytes=50MB        ;æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œè¶…å‡ºä¼šrotateï¼Œé»˜è®¤ 50MBï¼Œå¦‚æœè®¾æˆ0ï¼Œè¡¨ç¤ºä¸é™åˆ¶å¤§å°logfile_backups=10           ;æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤‡ä»½æ•°é‡é»˜è®¤10ï¼Œè®¾ä¸º0è¡¨ç¤ºä¸å¤‡ä»½loglevel=info                ;æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤infoï¼Œå…¶å®ƒ: debug,warn,tracepidfile=/tmp/supervisord.pid ;pid æ–‡ä»¶nodaemon=false               ;æ˜¯å¦åœ¨å‰å°å¯åŠ¨ï¼Œé»˜è®¤æ˜¯falseï¼Œå³ä»¥ daemon çš„æ–¹å¼å¯åŠ¨minfds=1024                  ;å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å°å€¼ï¼Œé»˜è®¤ 1024minprocs=200                 ;å¯ä»¥æ‰“å¼€çš„è¿›ç¨‹æ•°çš„æœ€å°å€¼ï¼Œé»˜è®¤ 200[supervisorctl]serverurl=unix:///tmp/supervisor.sock ;é€šè¿‡UNIX socketè¿æ¥supervisordï¼Œè·¯å¾„ä¸unix_http_serveréƒ¨åˆ†çš„fileä¸€è‡´;serverurl=http://127.0.0.1:9001 ; é€šè¿‡HTTPçš„æ–¹å¼è¿æ¥supervisord; [program:xx]æ˜¯è¢«ç®¡ç†çš„è¿›ç¨‹é…ç½®å‚æ•°ï¼Œxxæ˜¯è¿›ç¨‹çš„åç§°[program:xx]command=/opt/apache-tomcat-8.0.35/bin/catalina.sh run  ; ç¨‹åºå¯åŠ¨å‘½ä»¤autostart=true       ; åœ¨supervisordå¯åŠ¨çš„æ—¶å€™ä¹Ÿè‡ªåŠ¨å¯åŠ¨startsecs=10         ; å¯åŠ¨10ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±è¡¨ç¤ºè¿›ç¨‹æ­£å¸¸å¯åŠ¨äº†ï¼Œé»˜è®¤ä¸º1ç§’autorestart=true     ; ç¨‹åºé€€å‡ºåè‡ªåŠ¨é‡å¯,å¯é€‰å€¼ï¼š[unexpected,true,false]ï¼Œé»˜è®¤ä¸ºunexpectedï¼Œè¡¨ç¤ºè¿›ç¨‹æ„å¤–æ€æ­»åæ‰é‡å¯startretries=3       ; å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯3user=tomcat          ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨è¿›ç¨‹ï¼Œé»˜è®¤æ˜¯rootpriority=999         ; è¿›ç¨‹å¯åŠ¨ä¼˜å…ˆçº§ï¼Œé»˜è®¤999ï¼Œå€¼å°çš„ä¼˜å…ˆå¯åŠ¨redirect_stderr=true ; æŠŠstderré‡å®šå‘åˆ°stdoutï¼Œé»˜è®¤falsestdout_logfile_maxbytes=20MB  ; stdout æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤50MBstdout_logfile_backups = 20   ; stdout æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°ï¼Œé»˜è®¤æ˜¯10; stdout æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„å½“æŒ‡å®šç›®å½•ä¸å­˜åœ¨æ—¶æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼ˆsupervisord ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼‰stdout_logfile=/opt/apache-tomcat-8.0.35/logs/catalina.outstopasgroup=false     ;é»˜è®¤ä¸ºfalse,è¿›ç¨‹è¢«æ€æ­»æ—¶ï¼Œæ˜¯å¦å‘è¿™ä¸ªè¿›ç¨‹ç»„å‘é€stopä¿¡å·ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹killasgroup=false     ;é»˜è®¤ä¸ºfalseï¼Œå‘è¿›ç¨‹ç»„å‘é€killä¿¡å·ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹;åŒ…å«å…¶å®ƒé…ç½®æ–‡ä»¶[include]files = relative/directory/*.ini    ;å¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªä»¥.iniç»“æŸçš„é…ç½®æ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å­è¿›ç¨‹é…ç½®æ–‡ä»¶è¯´æ˜ï¼š"><a href="#å­è¿›ç¨‹é…ç½®æ–‡ä»¶è¯´æ˜ï¼š" class="headerlink" title="å­è¿›ç¨‹é…ç½®æ–‡ä»¶è¯´æ˜ï¼š"></a>å­è¿›ç¨‹é…ç½®æ–‡ä»¶è¯´æ˜ï¼š</h4><p>ç»™éœ€è¦ç®¡ç†çš„å­è¿›ç¨‹(ç¨‹åº)ç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ”¾åœ¨/etc/supervisor.d/ç›®å½•ä¸‹ï¼Œä»¥.iniä½œä¸ºæ‰©å±•åï¼ˆæ¯ä¸ªè¿›ç¨‹çš„é…ç½®æ–‡ä»¶éƒ½å¯ä»¥å•ç‹¬åˆ†æ‹†ä¹Ÿå¯ä»¥æŠŠç›¸å…³çš„è„šæœ¬æ”¾ä¸€èµ·ï¼‰ã€‚å¦‚ä»»æ„å®šä¹‰ä¸€ä¸ªå’Œè„šæœ¬ç›¸å…³çš„é¡¹ç›®åç§°çš„é€‰é¡¹ç»„ï¼ˆ/etc/supervisord.d/test.confï¼‰ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">#é¡¹ç›®å[program:blog]#è„šæœ¬ç›®å½•directory=/opt/bin#è„šæœ¬æ‰§è¡Œå‘½ä»¤command=/usr/bin/python /opt/bin/test.py#supervisorå¯åŠ¨çš„æ—¶å€™æ˜¯å¦éšç€åŒæ—¶å¯åŠ¨ï¼Œé»˜è®¤Trueautostart=true#å½“ç¨‹åºexitçš„æ—¶å€™ï¼Œè¿™ä¸ªprogramä¸ä¼šè‡ªåŠ¨é‡å¯,é»˜è®¤unexpectedï¼Œè®¾ç½®å­è¿›ç¨‹æŒ‚æ‰åè‡ªåŠ¨é‡å¯çš„æƒ…å†µï¼Œæœ‰ä¸‰ä¸ªé€‰é¡¹ï¼Œfalse,unexpectedå’Œtrueã€‚å¦‚æœä¸ºfalseçš„æ—¶å€™ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œéƒ½ä¸ä¼šè¢«é‡æ–°å¯åŠ¨ï¼Œå¦‚æœä¸ºunexpectedï¼Œåªæœ‰å½“è¿›ç¨‹çš„é€€å‡ºç ä¸åœ¨ä¸‹é¢çš„exitcodesé‡Œé¢å®šä¹‰çš„autorestart=false#è¿™ä¸ªé€‰é¡¹æ˜¯å­è¿›ç¨‹å¯åŠ¨å¤šå°‘ç§’ä¹‹åï¼Œæ­¤æ—¶çŠ¶æ€å¦‚æœæ˜¯runningï¼Œåˆ™æˆ‘ä»¬è®¤ä¸ºå¯åŠ¨æˆåŠŸäº†ã€‚é»˜è®¤å€¼ä¸º1startsecs=1#è„šæœ¬è¿è¡Œçš„ç”¨æˆ·èº«ä»½ user = test#æ—¥å¿—è¾“å‡º stderr_logfile=/tmp/blog_stderr.log stdout_logfile=/tmp/blog_stdout.log #æŠŠstderré‡å®šå‘åˆ°stdoutï¼Œé»˜è®¤ falseredirect_stderr = true#stdoutæ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ 50MBstdout_logfile_maxbytes = 20M#stdoutæ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°stdout_logfile_backups = 20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å­è¿›ç¨‹é…ç½®ç¤ºä¾‹"><a href="#å­è¿›ç¨‹é…ç½®ç¤ºä¾‹" class="headerlink" title="å­è¿›ç¨‹é…ç½®ç¤ºä¾‹"></a>å­è¿›ç¨‹é…ç½®ç¤ºä¾‹</h4><pre class="line-numbers language-shell"><code class="language-shell">#è¯´æ˜åŒä¸Š[program:test] directory=/opt/bin command=/opt/bin/testautostart=true autorestart=false stderr_logfile=/tmp/test_stderr.log stdout_logfile=/tmp/test_stdout.log #user = test  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº”ã€supervisorå‘½ä»¤è¯´æ˜"><a href="#äº”ã€supervisorå‘½ä»¤è¯´æ˜" class="headerlink" title="äº”ã€supervisorå‘½ä»¤è¯´æ˜"></a>äº”ã€supervisorå‘½ä»¤è¯´æ˜</h2><h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><pre class="line-numbers language-shell"><code class="language-shell">supervisorctl status        //æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„çŠ¶æ€supervisorctl stop es       //åœæ­¢essupervisorctl start es      //å¯åŠ¨essupervisorctl restart       //é‡å¯essupervisorctl update        //é…ç½®æ–‡ä»¶ä¿®æ”¹åä½¿ç”¨è¯¥å‘½ä»¤åŠ è½½æ–°çš„é…ç½®supervisorctl reload        //é‡æ–°å¯åŠ¨é…ç½®ä¸­çš„æ‰€æœ‰ç¨‹åº<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>æ³¨ï¼šæŠŠ<code>es</code>æ¢æˆ<code>all</code>å¯ä»¥ç®¡ç†é…ç½®ä¸­çš„æ‰€æœ‰è¿›ç¨‹ã€‚ç›´æ¥è¾“å…¥<code>supervisorctl</code>è¿›å…¥<code>supervisorctl</code>çš„shelläº¤äº’ç•Œé¢ï¼Œæ­¤æ—¶ä¸Šé¢çš„å‘½ä»¤ä¸å¸¦<code>supervisorctl</code>å¯ç›´æ¥ä½¿ç”¨ã€‚</em></p><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><p>ä½¿ç”¨<code>supervisor</code>è¿›ç¨‹ç®¡ç†å‘½ä»¤ä¹‹å‰å…ˆå¯åŠ¨<code>supervisord</code>ï¼Œå¦åˆ™ç¨‹åºæŠ¥é”™ã€‚<br>ä½¿ç”¨å‘½ä»¤<code>supervisord -c /etc/supervisord.conf</code>å¯åŠ¨ã€‚<br>è‹¥æ˜¯<code>centos7</code>ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">systemctl start supervisord.service     //å¯åŠ¨supervisorå¹¶åŠ è½½é»˜è®¤é…ç½®æ–‡ä»¶systemctl enable supervisord.service    //å°†supervisoråŠ å…¥å¼€æœºå¯åŠ¨é¡¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql å­˜å‚¨emoji è¡¨æƒ…</title>
      <link href="/2021/10/13/mysql-save-emoji/"/>
      <url>/2021/10/13/mysql-save-emoji/</url>
      
        <content type="html"><![CDATA[<h3 id="mysql-å­˜å‚¨emoji-è¡¨æƒ…"><a href="#mysql-å­˜å‚¨emoji-è¡¨æƒ…" class="headerlink" title="mysql å­˜å‚¨emoji è¡¨æƒ…"></a>mysql å­˜å‚¨emoji è¡¨æƒ…</h3><blockquote><p>è¿‘æœŸè®¢å•æ¨¡å—å‘ç°å¥‡æ€ªbugï¼ŒæŸä¸ªå®¢æˆ·çš„è®¢å•ä¸€ç›´æ›´æ–°ä¸åˆ°ç³»ç»Ÿä¸­; äºæ˜¯å‘ç°å®¢æˆ·çš„è®¢å•å·ç«Ÿç„¶æœ‰è¡¨æƒ…(ğŸ)â€¦..çœŸçš„å¥‡è‘©;<br>ç‰¹æ®Šè¡¨æƒ…å­—ç¬¦æ— æ³•å…¥åº“ï¼Œè€Œè®¢å•ç›¸å…³è¡¨è®¾è®¡çš„å­—ç¬¦é›†ä¸ºutf8ï¼Œä¸æ”¯æŒç‰¹æ®Šå­—ç¬¦ã€‚å­˜å‚¨emojiè¡¨æƒ…éœ€è¦unicodeå­—ç¬¦é›†, æ‰€ä»¥ä¿®æ”¹ç›¸å…³å­—ç¬¦é›†, å¾—ä»¥è§£å†³ã€‚</p></blockquote><p><img src="./mysql_emoji.png" alt="mysql_emoji"></p><ol><li><p>éœ€è¦å°†mysql è¿æ¥æŒ‡å®šå­—ç¬¦é›†utf8mb4<br> <code>mysql+mysqldb://user:pwd@localhost/database?charset=utf8mb4</code></p></li><li><p>æ•°æ®åº“å­—ç¬¦é›† é¦–å…ˆæŸ¥çœ‹å­—ç¬¦é›†è®¾ç½®å¦‚ä¸‹, character_set_systemä¸ºutf8, éœ€è¦å°†å…¶ä¿®æ”¹ä¸ºutf8mb4<br> æŸ¥çœ‹å‘½ä»¤ï¼š <code>SHOW VARIABLES WHERE Variable_name LIKE &#39;character\_set\_%&#39; OR Variable_name LIKE &#39;collation%&#39;;</code></p><pre><code> +--------------------------+--------------------+ | Variable_name            | Value              | +--------------------------+--------------------+ | character_set_client     | utf8mb4            | | character_set_connection | utf8mb4            | | character_set_database   | utf8mb4            | | character_set_filesystem | binary             | | character_set_results    | utf8mb4            | | character_set_server     | utf8mb4            | | character_set_system     | utf8               | | collation_connection     | utf8mb4_unicode_ci | | collation_database       | utf8mb4_unicode_ci | | collation_server         | utf8mb4_unicode_ci | +--------------------------+--------------------+</code></pre></li><li><p>æ”¹åº“ã€è¡¨ã€å­—æ®µçš„å­—ç¬¦é›†</p><pre class="line-numbers language-sql"><code class="language-sql"> <span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> database_name <span class="token keyword">CHARACTER SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci<span class="token punctuation">;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name <span class="token keyword">CONVERT</span> <span class="token keyword">TO</span> <span class="token keyword">CHARACTER SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci<span class="token punctuation">;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name CHANGE column_name column_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">191</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>podå‡æ­»</title>
      <link href="/2021/10/08/pod-jia-si/"/>
      <url>/2021/10/08/pod-jia-si/</url>
      
        <content type="html"><![CDATA[<h2 id="K8S-podå‡æ­»å¤„ç†æ–¹æ¡ˆ"><a href="#K8S-podå‡æ­»å¤„ç†æ–¹æ¡ˆ" class="headerlink" title="K8S podå‡æ­»å¤„ç†æ–¹æ¡ˆ"></a>K8S podå‡æ­»å¤„ç†æ–¹æ¡ˆ</h2><p>è¿‘æœŸåœ¨è°ƒç ”æ–°æŠ€æœ¯æ–¹æ¡ˆ, å¼€å‘å’Œç°åº¦è¿‡ç¨‹ä¸­é‡åˆ°podå‡æ­»é—®é¢˜; æ€»ç»“å‡ºä¸¤ä¸ªæ–¹æ¡ˆ, å¯ä¾›å‚è€ƒ.<br>è¯¦ç»†å†…å®¹: <a href="https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html" target="_blank" rel="noopener">https://jimmysong.io/kubernetes-handbook/guide/configure-liveness-readiness-probes.html</a></p><h3 id="æ¡ˆä¾‹1"><a href="#æ¡ˆä¾‹1" class="headerlink" title="æ¡ˆä¾‹1"></a>æ¡ˆä¾‹1</h3><p>podåœ¨è¿è¡Œä¸€æ®µæ—¶é—´, å‡ºç°podå‡æ­»; å‡æ­»ä¹‹åæµé‡è¿˜æ˜¯ä¼šæ­£å¸¸æ‰“å…¥åˆ°è¯¥pod, æ— æ³•å¤„ç†è¿™éƒ¨åˆ†è¯·æ±‚, ä½“ç°åœ¨APIæ¥å£ä¸Šå°±æ˜¯å¤§é‡504è¶…æ—¶.</p><h4 id="å¤„ç†æ–¹æ³•"><a href="#å¤„ç†æ–¹æ³•" class="headerlink" title="å¤„ç†æ–¹æ³•"></a>å¤„ç†æ–¹æ³•</h4><p>æ·»åŠ podå¥åº·æ£€æŸ¥, æ¢æµ‹æ–¹å¼ï¼šexecæ–¹å¼, httpæ¢æµ‹, tcpæ¢æµ‹; å¯è‡ªè¡Œæ ¹æ®æœåŠ¡æ·»åŠ åˆç†æ–¹å¼.<br>ç¤ºä¾‹httpæ¢æµ‹æ–¹å¼:</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>    <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>        <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthy        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>    <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5  </span><span class="token comment" spellcheck="true"># å®¹å™¨å¯åŠ¨ 5s ä¹‹åå¼€å§‹æ‰§è¡Œ Liveness æ¢æµ‹</span>    <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">5  </span><span class="token comment" spellcheck="true"># æ¯ 5s æ¢æµ‹ä¸€æ¬¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¡ˆä¾‹2"><a href="#æ¡ˆä¾‹2" class="headerlink" title="æ¡ˆä¾‹2"></a>æ¡ˆä¾‹2</h3><p>kafkaæ¶ˆè´¹å¼‚å¸¸, æŸä¸ªpodæ¶ˆè´¹èƒ½åŠ›ä¸è¶³(åŸå› æœ‰è®¸å¤š, æ¯”å¦‚ä»£ç éœ€ä¼˜åŒ–, æ¶ˆæ¯å†…å®¹å¤§, DBå‹åŠ›å¤§ç­‰â€¦), å¯¼è‡´rebalance, ä»è€ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…çš„å…¶ä»–podä¹Ÿrebalance, æ•°æ¬¡ä¹‹å, å‡ºç°podå‡æ­», è¡¨ç°ä¸ºæ¶ˆæ¯ä¸æ¶ˆè´¹, è§‚å¯Ÿpodæ— æ—¥å¿—è¾“å‡º.</p><h4 id="å¤„ç†æ–¹æ³•-1"><a href="#å¤„ç†æ–¹æ³•-1" class="headerlink" title="å¤„ç†æ–¹æ³•"></a>å¤„ç†æ–¹æ³•</h4><p>æ·»åŠ ç”Ÿå‘½æ¢æµ‹, ä¸ä¸Šé¢å·®ä¸å¤š.</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>    <span class="token key atrule">exec</span><span class="token punctuation">:</span>      <span class="token key atrule">command</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> /bin/bash    <span class="token punctuation">-</span> probe.sh    <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>    <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">6</span>    <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>    <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>probe.sh</p><pre class="line-numbers language-sh"><code class="language-sh">#!/bin/bashoutputfile=./health_checkecho "OK" > ${outputfile}result=$(cat ${outputfile})if [[ "${result}" == "OK" ]]then    # sleep 10s    sleep 1s    rm -rf ${outputfile}    exit 0else    exit 1fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSGIå’ŒAWSGI</title>
      <link href="/2021/09/27/wsgi-he-awsgi/"/>
      <url>/2021/09/27/wsgi-he-awsgi/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯WSGIï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯WSGIï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯WSGIï¼Ÿ"></a>ä»€ä¹ˆæ˜¯WSGIï¼Ÿ</h1><p>WSGIå…¨ç§°Web Server Gateway Interface(WebæœåŠ¡å™¨ç½‘å…³æ¥å£)ï¼Œè¿™æ˜¯ä¸€ä¸ªè§„èŒƒï¼ˆæ ‡å‡†ï¼‰ï¼›è§„å®šäº†web serverå¦‚ä½•ä¸web applicationäº¤äº’ï¼Œapplicationå¦‚ä½•å¤„ç†è¯·æ±‚ã€‚</p><h2 id="WSGIä¸è¶³"><a href="#WSGIä¸è¶³" class="headerlink" title="WSGIä¸è¶³"></a>WSGIä¸è¶³</h2><ol><li>WSGIåº”ç”¨æ˜¯å•ä¸€çš„ã€åŒæ­¥çš„å¯è°ƒç”¨å¯¹è±¡ï¼ˆå³è¾“å…¥ä¸€ä¸ªè¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªå“åº”ï¼‰ã€‚è¿™ä¸ªæ¨¡å¼æ— æ³•æ”¯æŒé•¿è¿æ¥æˆ–è€…Websocketè¿™æ ·çš„è¿æ¥ï¼ˆæœ‰äº›WSGI serverï¼Œæ¯”å¦‚Gunicorné‡Œæ˜¯èƒ½ä¿æŒé•¿è¿æ¥ï¼Œ1-5sï¼Œä½†ä¹Ÿä»…é™äºä»–ä»¬çš„å¼‚æ­¥æ¨¡å¼ï¼‰ã€‚</li><li>å³ä½¿æˆ‘ä»¬ä½¿åº”ç”¨ç¨‹åºå¯ä»¥å¼‚æ­¥è°ƒç”¨ï¼Œä½†ä»–ä¹Ÿåªèƒ½å¤„ç†å•è·¯å¾„ï¼Œå®ƒä¹Ÿæ— æ³•å¤„ç†ä¸€äº›åè®®çš„å¤šä¸ªæ•°æ®ä¼ å…¥äº‹ä»¶ï¼Œæ¯”å¦‚websocket framesï¼ˆè¯·æ±‚å¤šè·¯å¤ç”¨æŠŠä¸€ä¸ªæ¶ˆæ¯åˆ†æˆäº†å¤šä¸ªå—ï¼Œä¸€ä¸ªè¿æ¥ä¼šæœ‰ä¸åŒè·¯å¾„çš„æ¶ˆæ¯äº¤é”™ï¼Œç±»ä¼¼http2/3ï¼‰ã€‚</li></ol><h1 id="ASGI"><a href="#ASGI" class="headerlink" title="ASGI"></a>ASGI</h1><p>ASGIå…¨ç§°Asynchronous  Server Gateway Interface(å¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£)ï¼Œä»–æ˜¯æ„å»ºä¸WSGIè§„èŒƒä¹‹ä¸Šçš„ï¼Œæ˜¯WSGIçš„å»¶ä¼¸å’Œæ‰©å±•ã€‚<br>ASGIå°è¯•ä¿æŒåœ¨ä¸€ä¸ªç®€å•çš„åº”ç”¨æ¥å£çš„å‰æä¸‹ï¼Œæä¾›å…è®¸æ•°æ®èƒ½å¤Ÿåœ¨ä»»æ„æ—¶å€™ã€è¢«ä»»æ„åº”ç”¨è¿›ç¨‹å‘é€å’Œæ¥å—çš„æŠ½è±¡ã€‚è¿˜é‡‡ç”¨äº†å°†ASGIåè®®è½¬æ¢ä¸ºpythonå…¼å®¹ã€å¼‚æ­¥å‹å¥½çš„æ¶ˆæ¯é›†çš„åŸåˆ™ï¼Œå…·ä½“ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªç”¨äºé€šä¿¡çš„æ ‡å‡†åŒ–æ¥å£ï¼Œé€šè¿‡å®ç°å®ƒæ¥æ„å»ºæœåŠ¡å™¨ï¼Œä»¥åŠä¸€ç»„ç”¨äºæ¯ä¸ªwebåè®®çš„æ ‡å‡†æ¶ˆæ¯æ ¼å¼ã€‚</p><h1 id="ç®€å•æ€»ç»“"><a href="#ç®€å•æ€»ç»“" class="headerlink" title="ç®€å•æ€»ç»“"></a>ç®€å•æ€»ç»“</h1><ul><li>WSGIå’ŒASGIï¼Œéƒ½æ˜¯åŸºäºPythonè®¾è®¡çš„ç½‘å…³æ¥å£ï¼ˆGateway Interfaceï¼ŒGIï¼‰ã€‚</li><li>WSGIæ˜¯åŸºäºhttpåè®®æ¨¡å¼å¼€å‘çš„ï¼Œä¸ºåŒæ­¥åº”ç”¨ç¨‹åºæä¾›æ ‡å‡†ï¼Œä¸æ”¯æŒWebsocketã€‚</li><li>ASGIæ˜¯ä¸ºå¼‚æ­¥ã€åŒæ­¥åº”ç”¨ç¨‹åºæä¾›æ ‡å‡†ï¼Œæ”¯æŒWSGIä¸æ”¯æŒå½“å‰Webå¼€å‘ä¸­çš„ä¸€äº›æ–°çš„åè®®æ ‡å‡†ã€‚</li><li>ASGIæ”¯æŒåŸæœ‰æ¨¡å¼å’ŒWebsocketçš„æ‰©å±•ï¼Œå³ASGIæ˜¯WSGIçš„æ‰©å±•ã€‚</li></ul><p>WSGIæœåŠ¡å™¨: uWSGI<br>WSGIæ¡†æ¶: Flask1.0ã€Django3.0ä¹‹å‰</p><p>AWSGIæœåŠ¡å™¨: uvicorn<br>AWSGIæ¡†æ¶ï¼šFastAPIã€Django3.0ä¹‹åã€Flask2.0</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HomeBrew å®‰è£…</title>
      <link href="/2021/09/14/homebrew/"/>
      <url>/2021/09/14/homebrew/</url>
      
        <content type="html"><![CDATA[<h3 id="homebrew-å›½å†…é£é€Ÿå®‰è£…"><a href="#homebrew-å›½å†…é£é€Ÿå®‰è£…" class="headerlink" title="homebrew(å›½å†…é£é€Ÿå®‰è£…)"></a><code>homebrew</code>(å›½å†…é£é€Ÿå®‰è£…)</h3><p><code>homebrew</code>å®˜ç½‘æ¨èçš„å‘½ä»¤åœ¨å›½å†…å·¨æ…¢â€¦ï¼Œä¸ç®¡ä½ æ˜¯å¦FQï¼Œéƒ½æ²¡å•¥é€Ÿåº¦çš„æå‡</p><pre class="line-numbers language-sh"><code class="language-sh">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œæœ‰ä¸ªå›½å†…çš„æºï¼Œå¯ä»¥ä½¿ä½ ä¸‹è½½é€Ÿåº¦æå‡ç™¾å€ï½</p><pre class="line-numbers language-sh"><code class="language-sh">/usr/bin/ruby -e "$(curl -fsSL https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install)"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><em>è‹¥å‡ºç°ä¸€ä¸‹æƒ…å†µï¼š</em></p><p>å¦‚æœå‘½ä»¤æ‰§è¡Œä¸­å¡åœ¨ä¸‹é¢ä¿¡æ¯ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">==> Tapping homebrew/coreCloning into '/usr/local/Homebrew/Library/Taps/homebrew/homebrew-core'...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¯·<code>Command + C</code>ä¸­æ–­è„šæœ¬æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">cd "$(brew --repo)/Library/Taps/"mkdir homebrew && cd homebrewgit clone git://mirrors.ustc.edu.cn/homebrew-core.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æˆåŠŸæ‰§è¡Œä¹‹åç»§ç»­æ‰§è¡Œå‰æ–‡çš„å®‰è£…å‘½ä»¤ã€‚<br>æœ€åçœ‹åˆ°<code>==&gt; Installation successful!</code>å°±è¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚</p><p>æœ€æœ€åæ‰§è¡Œï¼š<code>brew update</code></p><p><code>cask</code>åŒæ ·ä¹Ÿæœ‰é¦–æ¬¡ä¸‹è½½ç¼“æ…¢çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•å¤§è‡´åŒä¸Šï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">cd "$(brew --repo)/Library/Taps/"cd homebrewgit clone https://mirrors.ustc.edu.cn/homebrew-cask.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h3><p>ä½¿ç”¨å®˜æ–¹è„šæœ¬åŒæ ·ä¼šé‡åˆ°uninstallåœ°å€æ— æ³•è®¿é—®é—®é¢˜ï¼Œå¯ä»¥æ›¿æ¢ä¸ºä¸‹é¢è„šæœ¬ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">/usr/bin/ruby -e "$(curl -fsSL https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/uninstall)"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="è®¾ç½®å›½å†…é•œåƒæº"><a href="#è®¾ç½®å›½å†…é•œåƒæº" class="headerlink" title="è®¾ç½®å›½å†…é•œåƒæº"></a>è®¾ç½®å›½å†…é•œåƒæº</h3><p><code>brewã€homebrew/core</code>æ˜¯å¿…å¤‡é¡¹ç›®ï¼Œ<code>homebrew/cask</code>ã€<code>homebrew/bottles</code>æŒ‰éœ€è®¾ç½®ã€‚<br>é€šè¿‡<code>brew config</code>å‘½ä»¤æŸ¥çœ‹é…ç½®ä¿¡æ¯ã€‚</p><p><em>ä¸­ç§‘å¤§æº</em></p><pre class="line-numbers language-sh"><code class="language-sh">git -C "$(brew --repo)" remote set-url origin https://mirrors.ustc.edu.cn/brew.gitgit -C "$(brew --repo homebrew/core)" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.gitgit -C "$(brew --repo homebrew/cask)" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.gitbrew update<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¢å¤å®˜æ–¹é•œåƒæº"><a href="#æ¢å¤å®˜æ–¹é•œåƒæº" class="headerlink" title="æ¢å¤å®˜æ–¹é•œåƒæº"></a>æ¢å¤å®˜æ–¹é•œåƒæº</h3><pre class="line-numbers language-sh"><code class="language-sh">git -C "$(brew --repo)" remote set-url origin https://github.com/Homebrew/brew.gitgit -C "$(brew --repo homebrew/core)" remote set-url origin https://github.com/Homebrew/homebrew-core.gitgit -C "$(brew --repo homebrew/cask)" remote set-url origin https://github.com/Homebrew/homebrew-cask.gitbrew update<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>homebrew-bottles</code>é…ç½®åªèƒ½æ‰‹åŠ¨åˆ é™¤ï¼Œå°†<code>~/.bash_profile</code>æ–‡ä»¶ä¸­çš„ <code>HOMEBREW_BOTTLE_DOMAIN=https://mirrors.xxx.com</code>å†…å®¹åˆ é™¤ï¼Œå¹¶æ‰§è¡Œ<code>source ~/.bash_profile</code></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>04.k8sèµ„æºç®¡ç†</title>
      <link href="/2021/09/07/04k8s/"/>
      <url>/2021/09/07/04k8s/</url>
      
        <content type="html"><![CDATA[<h1 id="k8sèµ„æºç®¡ç†"><a href="#k8sèµ„æºç®¡ç†" class="headerlink" title="k8sèµ„æºç®¡ç†"></a>k8sèµ„æºç®¡ç†</h1><h2 id="èµ„æºç®¡ç†ä»‹ç»"><a href="#èµ„æºç®¡ç†ä»‹ç»" class="headerlink" title="èµ„æºç®¡ç†ä»‹ç»"></a>èµ„æºç®¡ç†ä»‹ç»</h2><p>åœ¨kubernetesä¸­ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œç”¨æˆ·éœ€è¦é€šè¿‡æ“ä½œèµ„æºæ¥ç®¡ç†kubernetesã€‚</p><blockquote><p>â€‹    kubernetesçš„æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé›†ç¾¤ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥åœ¨é›†ç¾¤ä¸­éƒ¨ç½²å„ç§æœåŠ¡ï¼Œæ‰€è°“çš„éƒ¨ç½²æœåŠ¡ï¼Œå…¶å®å°±æ˜¯åœ¨kubernetesé›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªä¸ªçš„å®¹å™¨ï¼Œå¹¶å°†æŒ‡å®šçš„ç¨‹åºè·‘åœ¨å®¹å™¨ä¸­ã€‚</p><p>â€‹    kubernetesçš„æœ€å°ç®¡ç†å•å…ƒæ˜¯podè€Œä¸æ˜¯å®¹å™¨ï¼Œæ‰€ä»¥åªèƒ½å°†å®¹å™¨æ”¾åœ¨<code>Pod</code>ä¸­ï¼Œè€Œkubernetesä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥ç®¡ç†Podï¼Œè€Œæ˜¯é€šè¿‡<code>Podæ§åˆ¶å™¨</code>æ¥ç®¡ç†Podçš„ã€‚</p><p>â€‹    Podå¯ä»¥æä¾›æœåŠ¡ä¹‹åï¼Œå°±è¦è€ƒè™‘å¦‚ä½•è®¿é—®Podä¸­æœåŠ¡ï¼Œkubernetesæä¾›äº†<code>Service</code>èµ„æºå®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>â€‹    å½“ç„¶ï¼Œå¦‚æœPodä¸­ç¨‹åºçš„æ•°æ®éœ€è¦æŒä¹…åŒ–ï¼Œkubernetesè¿˜æä¾›äº†å„ç§<code>å­˜å‚¨</code>ç³»ç»Ÿã€‚</p></blockquote><p><img src="./image-20200406225334627.png" alt="èµ„æºç®¡ç†"></p><blockquote><p> å­¦ä¹ kubernetesçš„æ ¸å¿ƒï¼Œå°±æ˜¯å­¦ä¹ å¦‚ä½•å¯¹é›†ç¾¤ä¸Šçš„<code>Podã€Podæ§åˆ¶å™¨ã€Serviceã€å­˜å‚¨</code>ç­‰å„ç§èµ„æºè¿›è¡Œæ“ä½œ</p></blockquote><h2 id="èµ„æºç®¡ç†æ–¹å¼"><a href="#èµ„æºç®¡ç†æ–¹å¼" class="headerlink" title="èµ„æºç®¡ç†æ–¹å¼"></a>èµ„æºç®¡ç†æ–¹å¼</h2><ul><li><p>å‘½ä»¤å¼å¯¹è±¡ç®¡ç†ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤å»æ“ä½œkubernetesèµ„æº</p><p><code>kubectl run nginx-pod --image=nginx:1.17.1 --port=80</code></p></li><li><p>å‘½ä»¤å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡å‘½ä»¤é…ç½®å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº</p><p><code>kubectl create/patch -f nginx-pod.yaml</code></p></li><li><p>å£°æ˜å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡applyå‘½ä»¤å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº</p><p><code>kubectl apply -f nginx-pod.yaml</code></p></li></ul><table><thead><tr><th>ç±»å‹</th><th>æ“ä½œå¯¹è±¡</th><th>é€‚ç”¨ç¯å¢ƒ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>å‘½ä»¤å¼å¯¹è±¡ç®¡ç†</td><td>å¯¹è±¡</td><td>æµ‹è¯•</td><td>ç®€å•</td><td>åªèƒ½æ“ä½œæ´»åŠ¨å¯¹è±¡ï¼Œæ— æ³•å®¡è®¡ã€è·Ÿè¸ª</td></tr><tr><td>å‘½ä»¤å¼å¯¹è±¡é…ç½®</td><td>æ–‡ä»¶</td><td>å¼€å‘</td><td>å¯ä»¥å®¡è®¡ã€è·Ÿè¸ª</td><td>é¡¹ç›®å¤§æ—¶ï¼Œé…ç½®æ–‡ä»¶å¤šï¼Œæ“ä½œéº»çƒ¦</td></tr><tr><td>å£°æ˜å¼å¯¹è±¡é…ç½®</td><td>ç›®å½•</td><td>å¼€å‘</td><td>æ”¯æŒç›®å½•æ“ä½œ</td><td>æ„å¤–æƒ…å†µä¸‹éš¾ä»¥è°ƒè¯•</td></tr></tbody></table><h3 id="å‘½ä»¤å¼å¯¹è±¡ç®¡ç†"><a href="#å‘½ä»¤å¼å¯¹è±¡ç®¡ç†" class="headerlink" title="å‘½ä»¤å¼å¯¹è±¡ç®¡ç†"></a>å‘½ä»¤å¼å¯¹è±¡ç®¡ç†</h3><p><strong>kubectlå‘½ä»¤</strong></p><p>â€‹    kubectlæ˜¯kubernetesé›†ç¾¤çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿå¯¹é›†ç¾¤æœ¬èº«è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šè¿›è¡Œå®¹å™¨åŒ–åº”ç”¨çš„å®‰è£…éƒ¨ç½²ã€‚kubectlå‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-md"><code class="language-md">kubectl [command] [type] [name] [flags]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>comand</strong>ï¼šæŒ‡å®šè¦å¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚createã€getã€delete</p><p><strong>type</strong>ï¼šæŒ‡å®šèµ„æºç±»å‹ï¼Œæ¯”å¦‚deploymentã€podã€service</p><p><strong>name</strong>ï¼šæŒ‡å®šèµ„æºçš„åç§°ï¼Œåç§°å¤§å°å†™æ•æ„Ÿ</p><p><strong>flags</strong>ï¼šæŒ‡å®šé¢å¤–çš„å¯é€‰å‚æ•°</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># æŸ¥çœ‹æ‰€æœ‰pod</span>kubectl get pod <span class="token comment" spellcheck="true"># æŸ¥çœ‹æŸä¸ªpod</span>kubectl get pod pod_name<span class="token comment" spellcheck="true"># æŸ¥çœ‹æŸä¸ªpod,ä»¥yamlæ ¼å¼å±•ç¤ºç»“æœ</span>kubectl get pod pod_name <span class="token operator">-</span>o yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>èµ„æºç±»å‹</strong></p><p>kubernetesä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹:</p><pre class="line-numbers language-powershell"><code class="language-powershell">kubectl api<span class="token operator">-</span>resources<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»å¸¸ä½¿ç”¨çš„èµ„æºæœ‰ä¸‹é¢è¿™äº›ï¼š</p><table>    <tr>        <th>èµ„æºåˆ†ç±»</th>        <th>èµ„æºåç§°</th>        <th>ç¼©å†™</th>        <th>èµ„æºä½œç”¨</th>    </tr>    <tr>        <td rowspan="2">é›†ç¾¤çº§åˆ«èµ„æº</td>        <td>nodes</td>        <td>no</td>        <td>é›†ç¾¤ç»„æˆéƒ¨åˆ†</td>    </tr>    <tr>        <td>namespaces</td>        <td>ns</td>        <td>éš”ç¦»Pod</td>    </tr>    <tr>        <td>podèµ„æº</td>        <td>pods</td>        <td>po</td>        <td>è£…è½½å®¹å™¨</td>    </tr>    <tr>        <td rowspan="8">podèµ„æºæ§åˆ¶å™¨</td>        <td>replicationcontrollers</td>        <td>rc</td>        <td>æ§åˆ¶podèµ„æº</td>    </tr>    <tr>        <td>replicasets</td>        <td>rs</td>        <td>æ§åˆ¶podèµ„æº</td>    </tr>    <tr>        <td>deployments</td>        <td>deploy</td>        <td>æ§åˆ¶podèµ„æº</td>    </tr>    <tr>        <td>daemonsets</td>        <td>ds</td>        <td>æ§åˆ¶podèµ„æº</td>    </tr>    <tr>        <td>jobs</td>        <td></td>        <td>æ§åˆ¶podèµ„æº</td>    </tr>        <tr>        <td>cronjobs</td>        <td>cj</td>        <td>æ§åˆ¶podèµ„æº</td>    </tr>        <tr>        <td>horizontalpodautoscalers</td>        <td>hpa</td>        <td>æ§åˆ¶podèµ„æº</td>    </tr>        <tr>        <td>statefulsets</td>        <td>sts</td>        <td>æ§åˆ¶podèµ„æº</td>    </tr>    <tr>        <td rowspan="2">æœåŠ¡å‘ç°èµ„æº</td>        <td>services</td>        <td>svc</td>        <td>ç»Ÿä¸€podå¯¹å¤–æ¥å£</td>    </tr>    <tr>        <td>ingress</td>        <td>ing</td>        <td>ç»Ÿä¸€podå¯¹å¤–æ¥å£</td>    </tr>    <tr>        <td rowspan="3">å­˜å‚¨èµ„æº</td>        <td>volumeattachments</td>        <td></td>        <td>å­˜å‚¨</td>    </tr>    <tr>        <td>persistentvolumes</td>        <td>pv</td>        <td>å­˜å‚¨</td>    </tr>    <tr>        <td>persistentvolumeclaims</td>        <td>pvc</td>        <td>å­˜å‚¨</td>    </tr>    <tr>        <td rowspan="2">é…ç½®èµ„æº</td>        <td>configmaps</td>        <td>cm</td>        <td>é…ç½®</td>    </tr>    <tr>        <td>secrets</td>        <td></td>        <td>é…ç½®</td>    </tr></table><p><strong>æ“ä½œ</strong></p><p>kuberneteså…è®¸å¯¹èµ„æºè¿›è¡Œå¤šç§æ“ä½œï¼Œå¯ä»¥é€šè¿‡â€“helpæŸ¥çœ‹è¯¦ç»†çš„æ“ä½œå‘½ä»¤</p><pre class="line-numbers language-powershell"><code class="language-powershell">kubectl <span class="token operator">--</span>help<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç»å¸¸ä½¿ç”¨çš„æ“ä½œæœ‰ä¸‹é¢è¿™äº›ï¼š</p><table>    <tr>        <th>å‘½ä»¤åˆ†ç±»</th>        <th>å‘½ä»¤</th>        <th>ç¿»è¯‘</th>        <th>å‘½ä»¤ä½œç”¨</th>    </tr>    <tr>        <td rowspan="6">åŸºæœ¬å‘½ä»¤</td>        <td>create</td>        <td>åˆ›å»º</td>        <td>åˆ›å»ºä¸€ä¸ªèµ„æº</td>    </tr>    <tr>        <td>edit</td>        <td>ç¼–è¾‘</td>        <td>ç¼–è¾‘ä¸€ä¸ªèµ„æº</td>    </tr>    <tr>        <td>get</td>        <td>è·å–</td>        <td>è·å–ä¸€ä¸ªèµ„æº</td>    </tr>   <tr>        <td>patch</td>        <td>æ›´æ–°</td>        <td>æ›´æ–°ä¸€ä¸ªèµ„æº</td>    </tr>    <tr>        <td>delete</td>        <td>åˆ é™¤</td>        <td>åˆ é™¤ä¸€ä¸ªèµ„æº</td>    </tr>    <tr>        <td>explain</td>        <td>è§£é‡Š</td>        <td>å±•ç¤ºèµ„æºæ–‡æ¡£</td>    </tr>    <tr>        <td rowspan="10">è¿è¡Œå’Œè°ƒè¯•</td>        <td>run</td>        <td>è¿è¡Œ</td>        <td>åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ</td>    </tr>    <tr>        <td>expose</td>        <td>æš´éœ²</td>        <td>æš´éœ²èµ„æºä¸ºService</td>    </tr>    <tr>        <td>describe</td>        <td>æè¿°</td>        <td>æ˜¾ç¤ºèµ„æºå†…éƒ¨ä¿¡æ¯</td>    </tr>    <tr>        <td>logs</td>        <td>æ—¥å¿—</td>        <td>è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿—</td>    </tr>        <tr>        <td>attach</td>        <td>ç¼ ç»•</td>        <td>è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</td>    </tr>        <tr>        <td>exec</td>        <td>æ‰§è¡Œ</td>        <td>æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤</td>    </tr>        <tr>        <td>cp</td>        <td>å¤åˆ¶</td>        <td>åœ¨Podå†…å¤–å¤åˆ¶æ–‡ä»¶</td>    </tr>        <tr>        <td>rollout</td>        <td>é¦–æ¬¡å±•ç¤º</td>        <td>ç®¡ç†èµ„æºçš„å‘å¸ƒ</td>    </tr>    <tr>        <td>scale</td>        <td>è§„æ¨¡</td>        <td>æ‰©(ç¼©)å®¹Podçš„æ•°é‡</td>    </tr>    <tr>        <td>autoscale</td>        <td>è‡ªåŠ¨è°ƒæ•´</td>        <td>è‡ªåŠ¨è°ƒæ•´Podçš„æ•°é‡</td>    </tr>    <tr>        <td rowspan="2">é«˜çº§å‘½ä»¤</td>        <td>apply</td>        <td>rc</td>        <td>é€šè¿‡æ–‡ä»¶å¯¹èµ„æºè¿›è¡Œé…ç½®</td>    </tr>    <tr>        <td>label</td>        <td>æ ‡ç­¾</td>        <td>æ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾</td>    </tr>    <tr>        <td rowspan="2">å…¶ä»–å‘½ä»¤</td>        <td>cluster-info</td>        <td>é›†ç¾¤ä¿¡æ¯</td>        <td>æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯</td>    </tr>    <tr>        <td>version</td>        <td>ç‰ˆæœ¬</td>        <td>æ˜¾ç¤ºå½“å‰Serverå’ŒClientçš„ç‰ˆæœ¬</td>    </tr></table><p>ä¸‹é¢ä»¥ä¸€ä¸ªnamespace / podçš„åˆ›å»ºå’Œåˆ é™¤ç®€å•æ¼”ç¤ºä¸‹å‘½ä»¤çš„ä½¿ç”¨ï¼š</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># åˆ›å»ºä¸€ä¸ªnamespace</span><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true"># kubectl create namespace dev</span>namespace<span class="token operator">/</span>dev created<span class="token comment" spellcheck="true"># è·å–namespace</span><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true"># kubectl get ns</span>NAME              STATUS   AGEdefault           Active   21hdev               Active   21skube<span class="token operator">-</span>node<span class="token operator">-</span>lease   Active   21hkube<span class="token operator">-</span>public       Active   21hkube<span class="token operator">-</span>system       Active   21h<span class="token comment" spellcheck="true"># åœ¨æ­¤namespaceä¸‹åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªnginxçš„Pod</span><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true"># kubectl run pod --image=nginx -n dev</span>kubectl run <span class="token operator">--</span>generator=deployment<span class="token operator">/</span>apps<span class="token punctuation">.</span>v1 is DEPRECATED and will be removed in a future version<span class="token punctuation">.</span> Use kubectl run <span class="token operator">--</span>generator=run<span class="token operator">-</span>pod<span class="token operator">/</span>v1 or kubectl create instead<span class="token punctuation">.</span>deployment<span class="token punctuation">.</span>apps<span class="token operator">/</span>pod created<span class="token comment" spellcheck="true"># æŸ¥çœ‹æ–°åˆ›å»ºçš„pod</span><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true"># kubectl get pod -n dev</span>NAME                   READY   STATUS    RESTARTS   AGEpod<span class="token operator">-</span>864f9875b9<span class="token operator">-</span>pcw7x   1<span class="token operator">/</span>1     Running   0          21s<span class="token comment" spellcheck="true"># åˆ é™¤æŒ‡å®šçš„pod</span><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true"># kubectl delete pod pod-864f9875b9-pcw7x</span>pod <span class="token string">"pod-864f9875b9-pcw7x"</span> deleted<span class="token comment" spellcheck="true"># åˆ é™¤æŒ‡å®šçš„namespace</span><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true"># kubectl delete ns dev</span>namespace <span class="token string">"dev"</span> deleted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å‘½ä»¤å¼å¯¹è±¡é…ç½®"><a href="#å‘½ä»¤å¼å¯¹è±¡é…ç½®" class="headerlink" title="å‘½ä»¤å¼å¯¹è±¡é…ç½®"></a>å‘½ä»¤å¼å¯¹è±¡é…ç½®</h3><p>å‘½ä»¤å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨å‘½ä»¤é…åˆé…ç½®æ–‡ä»¶ä¸€èµ·æ¥æ“ä½œkubernetesèµ„æºã€‚</p><p>1ï¼‰ åˆ›å»ºä¸€ä¸ªnginxpod.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace<span class="token key atrule">metadata</span><span class="token punctuation">:</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">---</span><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod<span class="token key atrule">metadata</span><span class="token punctuation">:</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginxpod  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev<span class="token key atrule">spec</span><span class="token punctuation">:</span>  <span class="token key atrule">containers</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>containers    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2ï¼‰æ‰§è¡Œcreateå‘½ä»¤ï¼Œåˆ›å»ºèµ„æºï¼š</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true"># kubectl create -f nginxpod.yaml</span>namespace<span class="token operator">/</span>dev createdpod<span class="token operator">/</span>nginxpod created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶å‘ç°åˆ›å»ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯namespaceå’Œpod</p><p>3ï¼‰æ‰§è¡Œgetå‘½ä»¤ï¼ŒæŸ¥çœ‹èµ„æºï¼š</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true">#  kubectl get -f nginxpod.yaml</span>NAME            STATUS   AGEnamespace<span class="token operator">/</span>dev   Active   18sNAME            READY   STATUS    RESTARTS   AGEpod<span class="token operator">/</span>nginxpod    1<span class="token operator">/</span>1     Running   0          17s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±æ˜¾ç¤ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡çš„ä¿¡æ¯</p><p>4ï¼‰æ‰§è¡Œdeleteå‘½ä»¤ï¼Œåˆ é™¤èµ„æºï¼š</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true"># kubectl delete -f nginxpod.yaml</span>namespace <span class="token string">"dev"</span> deletedpod <span class="token string">"nginxpod"</span> deleted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶å‘ç°ä¸¤ä¸ªèµ„æºå¯¹è±¡è¢«åˆ é™¤äº†</p><pre class="line-numbers language-md"><code class="language-md">æ€»ç»“:    å‘½ä»¤å¼å¯¹è±¡é…ç½®çš„æ–¹å¼æ“ä½œèµ„æºï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºï¼šå‘½ä»¤  +  yamlé…ç½®æ–‡ä»¶ï¼ˆé‡Œé¢æ˜¯å‘½ä»¤éœ€è¦çš„å„ç§å‚æ•°ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å£°æ˜å¼å¯¹è±¡é…ç½®"><a href="#å£°æ˜å¼å¯¹è±¡é…ç½®" class="headerlink" title="å£°æ˜å¼å¯¹è±¡é…ç½®"></a>å£°æ˜å¼å¯¹è±¡é…ç½®</h3><p>å£°æ˜å¼å¯¹è±¡é…ç½®è·Ÿå‘½ä»¤å¼å¯¹è±¡é…ç½®å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤applyã€‚</p><pre class="line-numbers language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># é¦–å…ˆæ‰§è¡Œä¸€æ¬¡kubectl apply -f yamlæ–‡ä»¶ï¼Œå‘ç°åˆ›å»ºäº†èµ„æº</span><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true">#  kubectl apply -f nginxpod.yaml</span>namespace<span class="token operator">/</span>dev createdpod<span class="token operator">/</span>nginxpod created<span class="token comment" spellcheck="true"># å†æ¬¡æ‰§è¡Œä¸€æ¬¡kubectl apply -f yamlæ–‡ä»¶ï¼Œå‘ç°è¯´èµ„æºæ²¡æœ‰å˜åŠ¨</span><span class="token namespace">[root@master ~]</span><span class="token comment" spellcheck="true">#  kubectl apply -f nginxpod.yaml</span>namespace<span class="token operator">/</span>dev unchangedpod<span class="token operator">/</span>nginxpod unchanged<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-md"><code class="language-md">æ€»ç»“:    å…¶å®å£°æ˜å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨applyæè¿°ä¸€ä¸ªèµ„æºæœ€ç»ˆçš„çŠ¶æ€ï¼ˆåœ¨yamlä¸­å®šä¹‰çŠ¶æ€ï¼‰    ä½¿ç”¨applyæ“ä½œèµ„æºï¼š        å¦‚æœèµ„æºä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºï¼Œç›¸å½“äº kubectl create        å¦‚æœèµ„æºå·²å­˜åœ¨ï¼Œå°±æ›´æ–°ï¼Œç›¸å½“äº kubectl patch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ä½¿ç”¨æ¨è:  ä¸‰ç§æ–¹å¼åº”è¯¥æ€ä¹ˆç”¨ ?</p></blockquote><p> åˆ›å»º/æ›´æ–°èµ„æº      ä½¿ç”¨å£°æ˜å¼å¯¹è±¡é…ç½® kubectl apply -f  XXX.yaml</p><p> åˆ é™¤èµ„æº              ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡é…ç½® kubectl delete -f  XXX.yaml</p><p> æŸ¥è¯¢èµ„æº              ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡ç®¡ç† kubectl get(describe) èµ„æºåç§°</p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>03. å®‰è£…minikube</title>
      <link href="/2021/08/04/03k8s/"/>
      <url>/2021/08/04/03k8s/</url>
      
        <content type="html"><![CDATA[<p>å®‰è£…minikubeçš„å‰æéœ€è¦å®‰è£…kubectl</p><h3 id="å®‰è£…kubectl"><a href="#å®‰è£…kubectl" class="headerlink" title="å®‰è£…kubectl"></a>å®‰è£…kubectl</h3><h4 id="Centosã€Readhat"><a href="#Centosã€Readhat" class="headerlink" title="Centosã€Readhat"></a>Centosã€Readhat</h4><p>ç¼–è¾‘yum çš„kubenernetesæº<br><code>vim /etc/yum.repos.d/kubernetes.repo</code><br>å¹¶è¾“å…¥ä¸‹é¢çš„å†…å®¹</p><pre><code>[kubernetes]name=Kubernetesbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/enabled=1gpgcheck=1repo_gpgcheck=1gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</code></pre><p>å†ä½¿ç”¨å‘½ä»¤:</p><pre><code>yum install -y kubectl</code></pre><h4 id="Ubuntuã€Debian"><a href="#Ubuntuã€Debian" class="headerlink" title="Ubuntuã€Debian"></a>Ubuntuã€Debian</h4><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y apt-transport-httpscurl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="token operator">|</span> apt-key add - <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF <span class="token operator">></span>/etc/apt/sources.list.d/kubernetes.listdeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial mainEOF  <span class="token function">apt-get</span> update<span class="token function">apt-get</span> <span class="token function">install</span> -y kubelet kubeadm kubectl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="MacOs"><a href="#MacOs" class="headerlink" title="MacOs"></a>MacOs</h4><pre class="line-numbers language-bash"><code class="language-bash">brew <span class="token function">install</span> kubernetes-clikubectl version --client<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="å®‰è£…minikubeï¼ˆä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼‰"><a href="#å®‰è£…minikubeï¼ˆä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼‰" class="headerlink" title="å®‰è£…minikubeï¼ˆä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼‰"></a>å®‰è£…minikubeï¼ˆä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼‰</h3><h4 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h4><pre class="line-numbers language-bash"><code class="language-bash">curl -Lo minikube https://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v1.18.1/minikube-linux-amd64 <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x minikube <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">mv</span> minikube /usr/local/bin/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h4><pre class="line-numbers language-bash"><code class="language-bash">curl -Lo minikube https://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v1.18.1/minikube-linux-amd64 <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x minikube <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">mv</span> minikube /usr/local/bin/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯åŠ¨ï¼š<code>minikube start --registry-mirror=https://registry.docker-cn.com --image-mirror-country cn</code></p><p>å®Œæˆä»¥ä¸Šæ­¥éª¤å³å¯å®‰è£…æˆåŠŸï½</p><h4 id="æ‰©å±•ï¼š"><a href="#æ‰©å±•ï¼š" class="headerlink" title="æ‰©å±•ï¼š"></a>æ‰©å±•ï¼š</h4><p>ä¸ºäº†è®¿é—®æµ·å¤–çš„èµ„æºï¼Œé˜¿é‡Œäº‘æä¾›äº†ä¸€ç³»åˆ—åŸºç¡€è®¾æ–½ï¼Œè¯·æŒ‰ç…§å¦‚ä¸‹å‚æ•°è¿›è¡Œé…ç½®ã€‚å…¶ä¸­å¸¸è§å‚æ•°</p><blockquote><p>â€“driver=xxx ä»1.5.0ç‰ˆæœ¬å¼€å§‹ï¼ŒMinikubeç¼ºçœä½¿ç”¨æœ¬åœ°æœ€å¥½çš„é©±åŠ¨æ¥åˆ›å»ºKubernetesæœ¬åœ°ç¯å¢ƒï¼Œæµ‹è¯•è¿‡çš„ç‰ˆæœ¬ docker, kvm<br>â€“image-mirror-country cn å°†ç¼ºçœåˆ©ç”¨ registry.cn-hangzhou.aliyuncs.com/google_containers ä½œä¸ºå®‰è£…Kubernetesçš„å®¹å™¨é•œåƒä»“åº“ ï¼ˆé˜¿é‡Œäº‘ç‰ˆæœ¬å¯é€‰ï¼‰<br>â€“iso-url=xxx  åˆ©ç”¨é˜¿é‡Œäº‘çš„é•œåƒåœ°å€ä¸‹è½½ç›¸åº”çš„ .iso æ–‡ä»¶ ï¼ˆé˜¿é‡Œäº‘ç‰ˆæœ¬å¯é€‰ï¼‰<br>â€“registry-mirror=xxx ä¸ºäº†æ‹‰å–Docker Hubé•œåƒï¼Œéœ€è¦ä¸º Docker daemon é…ç½®é•œåƒåŠ é€Ÿï¼Œå‚è€ƒé˜¿é‡Œäº‘é•œåƒæœåŠ¡<br>â€“cpus=2: ä¸ºminikubeè™šæ‹Ÿæœºåˆ†é…CPUæ ¸æ•°<br>â€“memory=2048mb: ä¸ºminikubeè™šæ‹Ÿæœºåˆ†é…å†…å­˜æ•°<br>â€“kubernetes-version=xxx: minikube è™šæ‹Ÿæœºå°†ä½¿ç”¨çš„ kubernetes ç‰ˆæœ¬</p></blockquote><ul><li><p>å®‰è£…minikubeï¼Œç¼ºçœé©±åŠ¨</p><p><code>minikube start --cpus=4 --memory=4096mb</code></p></li><li><p>å®‰è£…minikubeï¼ŒDockeré©±åŠ¨</p><p><code>minikube start --driver=docker</code></p></li><li><p>å®‰è£…minikubeï¼ŒKVM2é©±åŠ¨</p><p><code>minikube start --driver=kvm2</code></p></li><li><p>æ‰“å¼€Kubernetesæ§åˆ¶å°</p><p><code>minikube dashboard</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>02. Kubernetes ç»„ä»¶</title>
      <link href="/2021/07/26/02k8s/"/>
      <url>/2021/07/26/02k8s/</url>
      
        <content type="html"><![CDATA[<h2 id="Kubernetes-ç»„ä»¶"><a href="#Kubernetes-ç»„ä»¶" class="headerlink" title="Kubernetes ç»„ä»¶"></a>Kubernetes ç»„ä»¶</h2><p>ä¸€ä¸ªKubernetesé›†ç¾¤ç”±ä¸€ç»„è¢«ç§°ä¸ºèŠ‚ç‚¹çš„æœºå™¨ç»„æˆã€‚è¿™äº›èŠ‚ç‚¹ä¸Šè¿è¡Œäº†Kubernetesæ‰€ç®¡ç†çš„å®¹å™¨åŒ–åº”ç”¨ã€‚kubernetesé›†ç¾¤ä¸»è¦æ˜¯ç”±<strong>æ§åˆ¶èŠ‚ç‚¹(master)</strong>ã€<strong>å·¥ä½œèŠ‚ç‚¹(node)</strong>æ„æˆã€‚</p><p><img src="./components-of-kubernetes.svg" alt="kubernetesç»„ä»¶"></p><p><strong>masterï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢(Control Plane Components)ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­–(ç®¡ç†)</strong></p><blockquote><p><strong>kube-apiserver</strong> : èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶<br><strong>kube-scheduler</strong> : è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„nodeèŠ‚ç‚¹ä¸Š<br><strong>kube-controller-manager</strong> : è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ã€æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰<br>*<em>etcd *</em>ï¼š etcd æ˜¯å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“, è´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯ </p></blockquote><p><strong>nodeï¼šé›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ(å¹²æ´»)</strong></p><blockquote><p><strong>kubelet</strong> : è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶dockerï¼Œæ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨<br><strong>kube-proxy</strong> : è´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡<br><strong>Docker</strong> : è´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ</p></blockquote><p><img src="./image-20200406184656917.png" alt="kubernetesç³»ç»Ÿå„ä¸ªç»„ä»¶è°ƒç”¨å…³ç³»"></p><p>ç®€å•ä»‹ç»ä¸€ä¸‹éƒ¨ç½²ä¸€ä¸ªnginxæœåŠ¡æ¥è¯´æ˜kubernetesç³»ç»Ÿå„ä¸ªç»„ä»¶è°ƒç”¨å…³ç³»ï¼š</p><ol><li>kubernetesé›†ç¾¤æ­å»ºå¥½ä¹‹åï¼Œmasterå’Œnodeéƒ½ä¼šå°†è‡ªèº«æ‰€æœ‰ç›¸å…³ä¿¡æ¯å­˜å‚¨åˆ°etcdæ•°æ®åº“ä¸­ã€‚</li><li>nginxæœåŠ¡çš„å®‰è£…è¯·æ±‚ä¼šé¦–å…ˆè¢«å‘é€åˆ°masterèŠ‚ç‚¹çš„apiserverç»„ä»¶ã€‚</li><li>apiserverç»„ä»¶è°ƒç”¨schedulerç»„ä»¶ï¼Œschedulerç»„ä»¶æ¥å†³å®šåˆ°åº•åº”è¯¥æŠŠè¿™ä¸ªæœåŠ¡å®‰è£…åˆ°å“ªä¸ªnodeèŠ‚ç‚¹ä¸Šã€‚æ­¤æ—¶ï¼Œå®ƒä¼šä»etcdä¸­è¯»å–å„ä¸ªnodeèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è¿›è¡Œé€‰æ‹©ï¼Œå¹¶å°†ç»“æœå‘ŠçŸ¥apiserverã€‚</li><li>apiserverè°ƒç”¨controller-managerå»è°ƒåº¦nodeèŠ‚ç‚¹å®‰è£…nginxæœåŠ¡ã€‚</li><li>kubeletæ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œä¼šé€šçŸ¥dockerï¼Œç„¶åç”±dockeræ¥å¯åŠ¨ä¸€ä¸ªnginxçš„podï¼Œpodæ˜¯kubernetesçš„æœ€å°æ“ä½œå•å…ƒï¼Œå®¹å™¨å¿…é¡»è·‘åœ¨podä¸­ã€‚</li><li>æ­¤æ—¶nginxæœåŠ¡å°±æˆåŠŸè¿è¡Œäº†ï¼Œå¦‚æœéœ€è¦åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®è¯¥æœåŠ¡ï¼Œå°±éœ€è¦é€šè¿‡kube-proxyæ¥å¯¹podç”Ÿæˆè®¿é—®ä»£ç†ï¼Œè¿™æ ·ï¼Œé›†ç¾¤å¤–éƒ¨çš„ç”¨æˆ·å°±èƒ½è®¿é—®é›†ç¾¤ä¸­çš„nginxæœåŠ¡äº†ã€‚</li></ol><p><a href="https://kubernetes.io/zh/docs/concepts/overview/components/" target="_blank" rel="noopener">å‚è€ƒè‡ª Kubernetes å®˜ç½‘</a></p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01. Kubernetesæ˜¯ä»€ä¹ˆ?</title>
      <link href="/2021/07/21/01k8s/"/>
      <url>/2021/07/21/01k8s/</url>
      
        <content type="html"><![CDATA[<h2 id="Kubernetesæ˜¯ä»€ä¹ˆ"><a href="#Kubernetesæ˜¯ä»€ä¹ˆ" class="headerlink" title="Kubernetesæ˜¯ä»€ä¹ˆ?"></a>Kubernetesæ˜¯ä»€ä¹ˆ?</h2><p>Kubernetes æ˜¯ä¸€ä¸ªå¯ç§»æ¤çš„ã€å¯æ‰©å±•çš„å¼€æºå¹³å°ï¼Œç”¨äºç®¡ç†å®¹å™¨åŒ–çš„å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡ï¼Œå¯ä¿ƒè¿›å£°æ˜å¼é…ç½®å’Œè‡ªåŠ¨åŒ–ã€‚ Kubernetes æ‹¥æœ‰ä¸€ä¸ªåºå¤§ä¸”å¿«é€Ÿå¢é•¿çš„ç”Ÿæ€ç³»ç»Ÿã€‚ <strong>Kubernetes</strong> è¿™ä¸ªåå­—æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸ºâ€œèˆµæ‰‹â€æˆ–â€œé£è¡Œå‘˜â€ã€‚k8s è¿™ä¸ªç¼©å†™æ˜¯å› ä¸º k å’Œ s ä¹‹é—´æœ‰å…«ä¸ªå­—ç¬¦çš„å…³ç³»ã€‚</p><h2 id="éƒ¨ç½²æ–¹å¼çš„æ¼”å˜"><a href="#éƒ¨ç½²æ–¹å¼çš„æ¼”å˜" class="headerlink" title="éƒ¨ç½²æ–¹å¼çš„æ¼”å˜"></a>éƒ¨ç½²æ–¹å¼çš„æ¼”å˜</h2><p><img src="./deploy_style.jpg" alt="deploy_style"></p><h4 id="ä¼ ç»Ÿéƒ¨ç½²"><a href="#ä¼ ç»Ÿéƒ¨ç½²" class="headerlink" title="ä¼ ç»Ÿéƒ¨ç½²"></a>ä¼ ç»Ÿéƒ¨ç½²</h4><blockquote><p>æ—©æœŸï¼Œç›´æ¥å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ç‰©ç†æœºä¸Šã€‚æ— æ³•ä¸ºç‰©ç†æœåŠ¡å™¨ä¸­çš„åº”ç”¨ç¨‹åºå®šä¹‰èµ„æºè¾¹ç•Œï¼Œè¿™ä¼šå¯¼è‡´èµ„æºåˆ†é…é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåº”ç”¨ç¨‹åºå ç”¨å¤§éƒ¨åˆ†èµ„æºçš„æƒ…å†µï¼Œ ç»“æœå¯èƒ½å¯¼è‡´å…¶ä»–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¸‹é™ã€‚ ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œæ¯ä¸ªåº”ç”¨ç¨‹åºï¼Œä½†æ˜¯ç”±äºèµ„æºåˆ©ç”¨ä¸è¶³è€Œæ— æ³•æ‰©å±•ï¼Œ å¹¶ä¸”ç»´æŠ¤è®¸å¤šç‰©ç†æœåŠ¡å™¨çš„æˆæœ¬å¾ˆé«˜ã€‚ </p></blockquote><h4 id="è™šæ‹ŸåŒ–éƒ¨ç½²"><a href="#è™šæ‹ŸåŒ–éƒ¨ç½²" class="headerlink" title="è™šæ‹ŸåŒ–éƒ¨ç½²"></a>è™šæ‹ŸåŒ–éƒ¨ç½²</h4><blockquote><p>å¯ä»¥åœ¨ä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªç¯å¢ƒ<br>ä¼˜ç‚¹ï¼šç¨‹åºç¯å¢ƒä¸ä¼šç›¸äº’äº§ç”Ÿå½±å“ï¼Œæä¾›äº†ä¸€å®šç¨‹åº¦çš„å®‰å…¨æ€§<br>ç¼ºç‚¹ï¼šå¢åŠ äº†æ“ä½œç³»ç»Ÿï¼Œæµªè´¹äº†éƒ¨åˆ†èµ„æº</p></blockquote><h3 id="å®¹å™¨åŒ–éƒ¨ç½²"><a href="#å®¹å™¨åŒ–éƒ¨ç½²" class="headerlink" title="å®¹å™¨åŒ–éƒ¨ç½²"></a>å®¹å™¨åŒ–éƒ¨ç½²</h3><blockquote><p>å®¹å™¨ç±»ä¼¼äº VMï¼Œä½†æ˜¯å®ƒä»¬å…·æœ‰è¢«æ”¾å®½çš„éš”ç¦»å±æ€§ï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ã€‚ å› æ­¤ï¼Œå®¹å™¨è¢«è®¤ä¸ºæ˜¯è½»é‡çº§çš„ã€‚å®¹å™¨ä¸ VM ç±»ä¼¼ï¼Œå…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰ã€‚ ç”±äºå®ƒä»¬ä¸åŸºç¡€æ¶æ„åˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥è·¨äº‘å’Œ OS å‘è¡Œç‰ˆæœ¬è¿›è¡Œç§»æ¤ã€‚</p><p>å®¹å™¨å› å…·æœ‰è®¸å¤šä¼˜åŠ¿è€Œå˜å¾—æµè¡Œèµ·æ¥ã€‚ä¸‹é¢åˆ—å‡ºçš„æ˜¯å®¹å™¨çš„ä¸€äº›å¥½å¤„ï¼š<br>â€‹    å¯ä»¥ä¿è¯æ¯ä¸ªå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰<br>â€‹    è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„èµ„æºéƒ½è¢«å®¹å™¨åŒ…è£…ï¼Œå¹¶å’Œåº•å±‚åŸºç¡€æ¶æ„è§£è€¦<br>â€‹    å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºå¯ä»¥è·¨äº‘æœåŠ¡å•†ã€è·¨Linuxæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆè¿›è¡Œéƒ¨ç½²</p></blockquote><h2 id="ä¸ºä»€ä¹ˆéœ€è¦-Kubernetesï¼Œå®ƒèƒ½åšä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Kubernetesï¼Œå®ƒèƒ½åšä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Kubernetesï¼Œå®ƒèƒ½åšä»€ä¹ˆ?"></a>ä¸ºä»€ä¹ˆéœ€è¦ Kubernetesï¼Œå®ƒèƒ½åšä»€ä¹ˆ?</h2><p>ç›®å‰ä¸»æµçš„æ–¹å¼æ˜¯å®¹å™¨éƒ¨ç½²ï¼Œåœ¨ç”Ÿäº§ç¯èŠ‚ä¸­å‡è®¾ä¸€ä¸ªå®¹å™¨å‘ç”Ÿæ•…éšœï¼Œåˆ™éœ€è¦å¯åŠ¨å¦ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶ç¡®ä¿è¯¥å®¹å™¨ä¸ä¼šåœæœºç­‰è¡Œä¸ºã€‚è¿™äº›é—®é¢˜å°±æ˜¯ç”±k8sæ¥è§£å†³ï¼ Kubernetes ä¸ºä½ æä¾›äº†ä¸€ä¸ªå¯å¼¹æ€§è¿è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¡†æ¶ã€‚ Kubernetes ä¼šæ»¡è¶³ä½ çš„æ‰©å±•è¦æ±‚ã€æ•…éšœè½¬ç§»ã€éƒ¨ç½²æ¨¡å¼ç­‰ã€‚ </p><p>kubernetesçš„æœ¬è´¨æ˜¯<strong>ä¸€ç»„æœåŠ¡å™¨é›†ç¾¤</strong>ï¼Œå®ƒå¯ä»¥åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç‰¹å®šçš„ç¨‹åºï¼Œæ¥å¯¹èŠ‚ç‚¹ä¸­çš„å®¹å™¨è¿›è¡Œç®¡ç†ã€‚ç›®çš„æ˜¯å®ç°èµ„æºç®¡ç†çš„è‡ªåŠ¨åŒ–ï¼</p><p><strong>Kubernetes ä¸ºä½ æä¾›ï¼š</strong></p><ul><li><p>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡<br>Kubernetes å¯ä»¥ä½¿ç”¨ DNS åç§°æˆ–è‡ªå·±çš„ IP åœ°å€å…¬å¼€å®¹å™¨ï¼Œå¦‚æœè¿›å…¥å®¹å™¨çš„æµé‡å¾ˆå¤§ï¼Œ Kubernetes å¯ä»¥è´Ÿè½½å‡è¡¡å¹¶åˆ†é…ç½‘ç»œæµé‡ï¼Œä»è€Œä½¿éƒ¨ç½²ç¨³å®šã€‚</p></li><li><p>å­˜å‚¨ç¼–æ’<br>Kubernetes å…è®¸ä½ è‡ªåŠ¨æŒ‚è½½ä½ é€‰æ‹©çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚æœ¬åœ°å­˜å‚¨ã€å…¬å…±äº‘æä¾›å•†ç­‰ã€‚</p></li><li><p>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</p><p>ä½ å¯ä»¥ä½¿ç”¨ Kubernetes æè¿°å·²éƒ¨ç½²å®¹å™¨çš„æ‰€éœ€çŠ¶æ€ï¼Œå®ƒå¯ä»¥ä»¥å—æ§çš„é€Ÿç‡å°†å®é™…çŠ¶æ€ æ›´æ”¹ä¸ºæœŸæœ›çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è‡ªåŠ¨åŒ– Kubernetes æ¥ä¸ºä½ çš„éƒ¨ç½²åˆ›å»ºæ–°å®¹å™¨ï¼Œ åˆ é™¤ç°æœ‰å®¹å™¨å¹¶å°†å®ƒä»¬çš„æ‰€æœ‰èµ„æºç”¨äºæ–°å®¹å™¨ã€‚</p></li><li><p>è‡ªåŠ¨å®Œæˆè£…ç®±è®¡ç®—</p><p>Kubernetes å…è®¸ä½ æŒ‡å®šæ¯ä¸ªå®¹å™¨æ‰€éœ€ CPU å’Œå†…å­˜ï¼ˆRAMï¼‰ã€‚ å½“å®¹å™¨æŒ‡å®šäº†èµ„æºè¯·æ±‚æ—¶ï¼ŒKubernetes å¯ä»¥åšå‡ºæ›´å¥½çš„å†³ç­–æ¥ç®¡ç†å®¹å™¨çš„èµ„æºã€‚</p></li><li><p>è‡ªæˆ‘ä¿®å¤<br>Kubernetes é‡æ–°å¯åŠ¨å¤±è´¥çš„å®¹å™¨ã€æ›¿æ¢å®¹å™¨ã€æ€æ­»ä¸å“åº”ç”¨æˆ·å®šä¹‰çš„ è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„å®¹å™¨ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡å¥½æœåŠ¡ä¹‹å‰ä¸å°†å…¶é€šå‘Šç»™å®¢æˆ·ç«¯ã€‚</p></li><li><p>å¯†é’¥ä¸é…ç½®ç®¡ç†</p><p>Kubernetes å…è®¸ä½ å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh å¯†é’¥ã€‚ ä½ å¯ä»¥åœ¨ä¸é‡å»ºå®¹å™¨é•œåƒçš„æƒ…å†µä¸‹éƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼Œä¹Ÿæ— éœ€åœ¨å †æ ˆé…ç½®ä¸­æš´éœ²å¯†é’¥ã€‚</p></li></ul><p><strong>ç®€å•çš„æ€»ç»“ï¼š</strong></p><ul><li><strong>è‡ªæˆ‘ä¿®å¤</strong>ï¼šä¸€æ—¦æŸä¸€ä¸ªå®¹å™¨å´©æºƒï¼Œèƒ½å¤Ÿåœ¨1ç§’ä¸­å·¦å³è¿…é€Ÿå¯åŠ¨æ–°çš„å®¹å™¨</li><li><strong>å¼¹æ€§ä¼¸ç¼©</strong>ï¼šå¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªåŠ¨å¯¹é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„å®¹å™¨æ•°é‡è¿›è¡Œè°ƒæ•´</li><li><strong>æœåŠ¡å‘ç°</strong>ï¼šæœåŠ¡å¯ä»¥é€šè¿‡è‡ªåŠ¨å‘ç°çš„å½¢å¼æ‰¾åˆ°å®ƒæ‰€ä¾èµ–çš„æœåŠ¡</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šå¦‚æœä¸€ä¸ªæœåŠ¡èµ·åŠ¨äº†å¤šä¸ªå®¹å™¨ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡</li><li><strong>ç‰ˆæœ¬å›é€€</strong>ï¼šå¦‚æœå‘ç°æ–°å‘å¸ƒçš„ç¨‹åºç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥ç«‹å³å›é€€åˆ°åŸæ¥çš„ç‰ˆæœ¬</li><li><strong>å­˜å‚¨ç¼–æ’</strong>ï¼šå¯ä»¥æ ¹æ®å®¹å™¨è‡ªèº«çš„éœ€æ±‚è‡ªåŠ¨åˆ›å»ºå­˜å‚¨å·</li></ul><p><a href="https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/" target="_blank" rel="noopener">å‚è€ƒè‡ª Kubernetes å®˜ç½‘</a></p>]]></content>
      
      
      <categories>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CeontOS å®‰è£…oh-my-zsh</title>
      <link href="/2021/06/30/centosinstallohmyzsh/"/>
      <url>/2021/06/30/centosinstallohmyzsh/</url>
      
        <content type="html"><![CDATA[<h3 id="CeontOS-å®‰è£…oh-my-zsh"><a href="#CeontOS-å®‰è£…oh-my-zsh" class="headerlink" title="CeontOS å®‰è£…oh-my-zsh"></a>CeontOS å®‰è£…oh-my-zsh</h3><p>åºŸè¯ä¸å¤šè¯´ï¼Œzshé…åˆoh-my-zshä½“éªŒç›¸å½“niceï¼Œç›´æ¥å¼€å¹²ã€‚</p><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><ol><li><p>å®‰è£…zshå¹¶åˆ‡æ¢zshä¸ºé»˜è®¤shell</p><pre class="line-numbers language-sh"><code class="language-sh">yum install zsh -ychsh -s /bin/zsh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å®‰è£…oh-my-zsh(ä½¿ç”¨è„šæœ¬å®‰è£…)</p><pre class="line-numbers language-sh"><code class="language-sh">sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p><strong>æ³¨æ„ï¼šå¦‚é‡åˆ°ç½‘ç»œé—®é¢˜å¯æ¢ä¸‹é¢è¿™ç§æ–¹å¼</strong></p><ol start="3"><li>ä¸‹è½½æºç å®‰è£…<pre class="line-numbers language-sh"><code class="language-sh">// ä¸‹è½½æºç git clone https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh// å¤åˆ¶é…ç½®cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>é‡æ–°ç™»å½•ç»ˆç«¯å³å¯</li></ol><h4 id="æ¨èæ’ä»¶"><a href="#æ¨èæ’ä»¶" class="headerlink" title="æ¨èæ’ä»¶"></a>æ¨èæ’ä»¶</h4><p>ç›´æ¥ä¸‹è½½åˆ°zshæ’ä»¶ç›®å½•ä¸‹</p><pre class="line-numbers language-sh"><code class="language-sh">// ä»£ç é«˜é‡git clone https://github.com/zsh-users/zsh-syntax-highlighting ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting// å‘½ä»¤è‡ªåŠ¨è¡¥å…¨git clone https://github.com/zsh-users/zsh-autosuggestions ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼–è¾‘zshé…ç½®ï¼š<code>vim ~/.zshrc</code> æœç´¢<code>plugins</code>ï¼Œæ·»åŠ è¿™ä¸¤ä¸ªæ’ä»¶å³å¯</p><pre class="line-numbers language-sh"><code class="language-sh">plugins=(        git        zsh-autosuggestions        zsh-syntax-highlighting)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€å<code>suorce ~/.zshrc</code></p><h4 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h4><p><a href="https://github.com/ohmyzsh/ohmyzsh/wiki/Themes" target="_blank" rel="noopener">https://github.com/ohmyzsh/ohmyzsh/wiki/Themes</a> è¿™é‡Œå¤§æŠŠçš„ä¸»é¢˜ï¼Œå¯ç›´æ¥çœ‹åˆ°æ•ˆæœï¼Œå¯ç›´æ¥ä»è¿™é‡Œé€‰<br>æ‰¾åˆ°æƒ³è¦çš„ä¸»é¢˜ç›´æ¥ç¼–è¾‘zshé…ç½®ï¼š<code>vim ~/.zshrc</code> æœç´¢<code>ZSH_THEME</code></p><pre class="line-numbers language-sh"><code class="language-sh">// å°†è¿™ä¸ªå€¼æ”¹æˆä¸»é¢˜åå³å¯ï¼Œæœ¬äººç›®å‰ä½¿ç”¨çš„ä¸»é¢˜å¦‚ä¸‹ZSH_THEME="risto"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>å®‰è£…å®Œä¹‹å<code>conda</code>å‘½ä»¤ä¸èƒ½ä½¿ç”¨ï¼Œåœ¨çŸ¥é“condaçš„è·¯å¾„æƒ…å†µä¸‹å¯ç›´æ¥ä½¿ç”¨å‘½ä»¤<code>/home/user/miniconda3/bin/conda init zsh</code>å³å¯</strong></p>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitlabä¿®æ”¹rootå¯†ç </title>
      <link href="/2021/06/30/gitlabupdatepwd/"/>
      <url>/2021/06/30/gitlabupdatepwd/</url>
      
        <content type="html"><![CDATA[<h3 id="gitlabä¿®æ”¹rootå¯†ç "><a href="#gitlabä¿®æ”¹rootå¯†ç " class="headerlink" title="gitlabä¿®æ”¹rootå¯†ç "></a>gitlabä¿®æ”¹rootå¯†ç </h3><pre class="line-numbers language-sh"><code class="language-sh">gitlab-rails console -e production// æŸ¥è¯¢rootç”¨æˆ·> user = User.where(username:"root").first=> #<User id:1 @root>// ä¿®æ”¹å¯†ç > user.password = "password"=> "password"// ä¿å­˜> user.save!Enqueued ActionMailer::MailDeliveryJob (Job ID: 1baf8589-c259-4287-bb21-345c862c1935) to Sidekiq(mailers) with arguments: "DeviseMailer", "password_change", "deliver_now", {:args=>[#<GlobalID:0x00007f821c58df68 @uri=#<URI::GID gid://gitlab/User/1>>]}=> trueexit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Gitlab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¸©å‘é›†åˆ</title>
      <link href="/2021/06/29/cai-keng-ji-he/"/>
      <url>/2021/06/29/cai-keng-ji-he/</url>
      
        <content type="html"><![CDATA[<h3 id="pythonæ–‡ä»¶æ“ä½œ"><a href="#pythonæ–‡ä»¶æ“ä½œ" class="headerlink" title="pythonæ–‡ä»¶æ“ä½œ"></a>pythonæ–‡ä»¶æ“ä½œ</h3><pre class="line-numbers language-python"><code class="language-python">os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># è¿”å›å½“å‰å·¥ä½œç›®å½•</span>os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># é€’å½’ç°å®pathè·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># æŠŠè·¯å¾„åˆ†å‰²æˆdirnameå’Œbasename</span>os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">"./path1/path2/path3...."</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># é€’å½’çš„åˆ›å»ºæ–‡ä»¶å¤¹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Pythonç›¸å…³"><a href="#Pythonç›¸å…³" class="headerlink" title="Pythonç›¸å…³"></a>Pythonç›¸å…³</h3><ul><li><p>MANIFEST.inæ–‡ä»¶<br>  å‚è€ƒ: <a href="https://docs.python.org/2/distutils/sourcedist.html" target="_blank" rel="noopener">https://docs.python.org/2/distutils/sourcedist.html</a></p></li><li><p>pythonæ–‡ä»¶æ“ä½œ</p><pre class="line-numbers language-python"><code class="language-python">  os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># è¿”å›å½“å‰å·¥ä½œç›®å½•</span>os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># é€’å½’ç°å®pathè·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># æŠŠè·¯å¾„åˆ†å‰²æˆdirnameå’Œbasename</span>os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">"./path1/path2/path3...."</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># é€’å½’çš„åˆ›å»ºæ–‡ä»¶å¤¹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>pip åªä¸‹è½½ä¸å®‰è£…<br>  <code>pip download -d \home\packs -r requirement.txt</code></p></li><li><p>pip å®‰è£…:</p><pre class="line-numbers language-sh"><code class="language-sh">  pip install package --no-cache   --index-url https://pypi.tuna.tsinghua.edu.cn/simple   --extra-index-url https://ricequant:RiceQuant77@pypi.ricequant.com:8080/simple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>df.shift å€¼å¾€åç§»åŠ¨:</p><pre class="line-numbers language-python"><code class="language-python">  df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"Col1"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                 <span class="token string">"Col2"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                 <span class="token string">"Col3"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                index<span class="token operator">=</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">"2020-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2020-01-05"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  df              Col1  Col2  Col3  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">10</span>    <span class="token number">13</span>    <span class="token number">17</span>  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>    <span class="token number">20</span>    <span class="token number">23</span>    <span class="token number">27</span>  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token number">15</span>    <span class="token number">18</span>    <span class="token number">22</span>  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">30</span>    <span class="token number">33</span>    <span class="token number">37</span>  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">45</span>    <span class="token number">48</span>    <span class="token number">52</span>  df<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>periods<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>              Col1  Col2  Col3  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>   NaN   NaN   NaN  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>   NaN   NaN   NaN  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>   NaN   NaN   NaN  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">10.0</span>  <span class="token number">13.0</span>  <span class="token number">17.0</span>  <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">20.0</span>  <span class="token number">23.0</span>  <span class="token number">27.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>DFæŒ‰ç…§æ¯åˆ†é’Ÿ/æ¯å°æ—¶åˆ†ç»„ï¼š</p><pre class="line-numbers language-python"><code class="language-python">  grp <span class="token operator">=</span> data<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token punctuation">[</span>data<span class="token punctuation">.</span>datetime_col<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span> x<span class="token punctuation">.</span>hour<span class="token punctuation">)</span><span class="token punctuation">,</span>                         data<span class="token punctuation">.</span>datetime_col<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span> x<span class="token punctuation">.</span>minute<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><h3 id="MySQLç›¸å…³"><a href="#MySQLç›¸å…³" class="headerlink" title="MySQLç›¸å…³"></a>MySQLç›¸å…³</h3><ul><li><p>MySQLè¿œç¨‹è¿æ¥:</p><ul><li>æˆæƒå‘½ä»¤: <code>grant all privileges on *.* &#39;ç”¨æˆ·å&#39;@&#39;%&#39; identified by &#39;å¯†ç &#39; with grant option</code><br>%: è¡¨ç¤ºå…è®¸æ‰€æœ‰ipè¿æ¥; æˆæƒæˆåŠŸä¹‹ååˆ·æ–°ä¸€ä¸‹æƒé™è¡¨: <code>flush privileges</code><br>é‡å¯: <code>service mysql restart</code></li></ul></li><li><p>MySQL ç”¨æˆ·/æƒé™ç›¸å…³:</p><ul><li><p>åˆ›å»ºç”¨æˆ·:<br>  <code>create user &#39;user_name&#39;@&#39;host&#39; identified by &#39;password&#39;;</code></p></li><li><p>æˆæƒç”¨æˆ·:<br>  <code>grant all privileges on database_name.tablename to &#39;user_name&#39;@&#39;host&#39;</code></p></li><li><p>æƒé™:<br>  <code>select, insert, update, delete, all privileges</code></p></li><li><p>åˆ é™¤ç”¨æˆ·:<br>  <code>drop user &#39;user_name&#39;@&#39;host&#39;</code></p></li><li><p>è®¾ç½®ä¸æ›´æ”¹å¯†ç :<br>  <code>set password for &#39;username&#39;@&#39;host&#39;=PASSWORD(&#39;newpassword&#39;)</code><br>  å¦‚æœæ˜¯è®¾ç½®å½“å‰ç”¨æˆ·çš„å¯†ç ï¼š<br>  SET  PASSWORD = PASSWORD(â€˜newpasswordâ€™)<br>  å¦‚ï¼š SET  PASSWORD = PASSWORD(â€˜123456â€™)</p></li><li><p>æ’¤é”€ç”¨æˆ·æƒé™:<br>  <code>revoke privileges on database.tablename from &#39;username&#39;@&#39;host&#39;;</code></p></li></ul></li></ul><h3 id="Linuxç›¸å…³"><a href="#Linuxç›¸å…³" class="headerlink" title="Linuxç›¸å…³"></a>Linuxç›¸å…³</h3><ul><li><p>yum åªä¸‹è½½å®‰è£…åŒ…åˆ°æŒ‡å®šä½ç½®ä¸å®‰è£…<br>  <code>yum install lrzsz.x86_64 --downloadonly --downloaddir=/root/package</code></p></li><li><p>æ‰“å¼€ç«¯å£:<br>  <code>iptables -A INPUT -p tcp --dport 8080 -j ACCEPT</code></p></li><li><p>æŸ¥çœ‹27017ç«¯å£æ˜¯å¦å¼€å¯<br>  <code>firewall-cmd --query-port=27017/tcp</code></p></li><li><p>å¼€å¯27017ç«¯å£<br>  <code>firewall-cmd --zone=public --add-port=27017/tcp --permanent</code></p></li><li><p>é‡å¯é˜²ç«å¢™<br>  <code>firewall-cmd --reload</code></p></li><li><p>MongoDBè¿œç¨‹è¿æ¥<br>  <code>mongo 192.168.199.129:27017</code></p></li><li><p>ps aux , ä»psä¸­è·å–è¿›ç¨‹id, å¹¶kill<br>  <code>kill $(ps aux | grep process_name | tr -s &#39; &#39;| cut -d &#39; &#39; -f 2)</code></p></li><li><p>æŸ¥çœ‹podä½¿ç”¨çš„yamlæ–‡ä»¶<br>  <code>kubectl get pod pod_name -o yaml</code></p></li><li><p>git ç›¸å…³</p><pre class="line-numbers language-sh"><code class="language-sh">  git tag 0.1    æ·»åŠ tag  git push origin [tag_name] æ¨é€tagåˆ°è¿œç¨‹ä»“åº“  git tag -d 0.1 åˆ é™¤æœ¬åœ°tagç‰ˆæœ¬  git push origin :refs/tags/0.1  åˆ é™¤è¿œç¨‹tagç‰ˆæœ¬  git reset --hard  ç‰ˆæœ¬å·  git push -f       å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹  git stash         æš‚å­˜æœ¬æ¬¡æ”¹åŠ¨  git stash pop     å°†æš‚å­˜çš„å–å‡º  // git sshé»˜è®¤ç«¯å£å˜æ›´ï¼Œå¯ä½¿ç”¨è¿™ç§æ–¹å¼  git remote add origin ssh://git@host:port/root/test_cicd.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>dockerå®¹å™¨è¢«killæ‰ï¼Œk8sä¸­è¯¥èŠ‚ç‚¹çš„podä¹Ÿè¢«é©±èµ¶ï¼Œå› è€Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è¢«killçš„æ‰€æœ‰è¿›ç¨‹<br>  <code>dmesg | grep -i -B100 &#39;killed process&#39;</code></p></li></ul><ul><li><p>ä¿®æ”¹githubä»£ç†<br>  1.è®¾ç½®ä»£ç†æ–¹æ³•å³å¯è§£å†³(è¯·è‡ªè¡ŒæŸ¥æ‰¾ä½ çš„httpä»£ç†ç«¯å£)<br>  <code>git config --global http.proxy &quot;localhost:port&quot;</code></p><p>  2.å®Œæˆåå–æ¶ˆè®¾ç½®<br>  <code>git config --global --unset http.proxy</code></p></li></ul><ul><li><p>dockerå¯¼å…¥å¯¼å‡ºå‘½ä»¤<br>  1.å¯¹é•œåƒ</p><pre class="line-numbers language-sh"><code class="language-sh">      // å¯¼å‡º      docker save -o file_name.tar      docker save > file_name.tar      // å¯¼å…¥      docker load -i file_name.tar      docker load < file_name.tar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  2.å¯¹å®¹å™¨</p><pre class="line-numbers language-sh"><code class="language-sh">      // å¯¼å‡º      docker export -o <file_name.tar> <container_name>      // å¯¼å…¥      docker import <file_name.tar> <container_name><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æˆæƒæŸä¸ªç”¨æˆ·rootæƒé™<br>  ç¼–è¾‘æ–‡ä»¶ï¼š<code>/etc/sudoers</code> ï¼ˆéœ€è¦æƒé™ï¼‰: <code>sudo vim /etc/sudoers</code><br>  æ‰¾åˆ°è¿™ä¸€è¡Œï¼š<code>root    ALL=(ALL)       ALL</code><br>  æ·»åŠ ä¸€è¡Œï¼š  <code>user    ALL=(ALL)       ALL</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> éšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> code </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker-compose å®‰è£…Gitlabå’ŒGitrunner</title>
      <link href="/2021/06/12/gitlab-he-gitrunner-an-zhuang/"/>
      <url>/2021/06/12/gitlab-he-gitrunner-an-zhuang/</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><blockquote><p>docker-compose.yaml</p></blockquote><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.5'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> gitlab/gitlab<span class="token punctuation">-</span>ce<span class="token punctuation">:</span>latest    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> gitlab host    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">GITLAB_OMNIBUS_CONFIG</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">        gitlab_rails['gitlab_shell_ssh_port'] = 22</span>    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"8000:80"</span> <span class="token comment" spellcheck="true"># ç½‘é¡µç«¯ç«¯å£</span>      <span class="token punctuation">-</span> <span class="token string">"8822:22"</span> <span class="token comment" spellcheck="true"># sshç«¯å£</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./config/gitlab<span class="token punctuation">:</span>/etc/gitlab      <span class="token punctuation">-</span> ./data/gitlab<span class="token punctuation">:</span>/var/opt/gitlab      <span class="token punctuation">-</span> ./logs<span class="token punctuation">:</span>/var/log/gitlab    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> gitlab  <span class="token key atrule">gitlab-runner</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> gitlab/gitlab<span class="token punctuation">-</span>runner<span class="token punctuation">:</span>alpine    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> gitlab    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true </span><span class="token comment" spellcheck="true"># ä½¿ç”¨rootæƒé™</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./config/gitlab<span class="token punctuation">-</span>runner<span class="token punctuation">:</span>/etc/gitlab<span class="token punctuation">-</span>runner      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock <span class="token comment" spellcheck="true"># windowsä¸Šå®¿ä¸»æœºdocker.sockè·¯å¾„://var/run/docker.sock      linuxä¸Šå®¿ä¸»æœºdocker.sockè·¯å¾„:/var/run/docker.sock </span>    <span class="token key atrule">networks</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> gitlab<span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token key atrule">gitlab</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p></blockquote><pre class="line-numbers language-sh"><code class="language-sh">.â”œâ”€â”€ configâ”‚   â””â”€â”€ gitlabâ”œâ”€â”€ dataâ”‚   â””â”€â”€ gitlab|   â””â”€â”€ gitlab-runnerâ”œâ”€â”€ docker-compose.yamlâ””â”€â”€ logs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è§£å†³ ERROR:Docker Got permission denied while trying to connect to the Docker daemon socket at unix://</strong></p><ol><li><p>ç»™æƒé™</p><pre class="line-numbers language-sh"><code class="language-sh">chmod 666 /var/run/docker.sock<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>æŠŠå½“å‰ç”¨æˆ·åŠ å…¥dockerç»„ </p><pre class="line-numbers language-sh"><code class="language-sh">sudo usermod -aG docker $USER<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ä¿®æ”¹dockeræœåŠ¡é…ç½®/usr/lib/systemd/system/docker.service</p><pre class="line-numbers language-python"><code class="language-python">å°†åŸæœ‰çš„æ³¨é‡ŠExecStart<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>dockerd <span class="token operator">-</span>H fd<span class="token punctuation">:</span><span class="token operator">//</span> <span class="token operator">-</span><span class="token operator">-</span>containerd<span class="token operator">=</span><span class="token operator">/</span>run<span class="token operator">/</span>containerd<span class="token operator">/</span>containerd<span class="token punctuation">.</span>sockæ–°åŠ ä»£ç ExecStart<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>dockerd <span class="token operator">-</span>H unix<span class="token punctuation">:</span><span class="token operator">//</span><span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>docker<span class="token punctuation">.</span>sock <span class="token operator">-</span>H tcp<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">0.0</span><span class="token punctuation">:</span><span class="token number">2375</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é‡å¯dockeræœåŠ¡</p><pre class="line-numbers language-sh"><code class="language-sh">systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h3 id="gitlab-runner-æ³¨å†Œåˆ°gitlab"><a href="#gitlab-runner-æ³¨å†Œåˆ°gitlab" class="headerlink" title="gitlab-runner æ³¨å†Œåˆ°gitlab"></a>gitlab-runner æ³¨å†Œåˆ°gitlab</h3><blockquote><p>æ³¨å†Œå‘½ä»¤</p></blockquote><pre class="line-numbers language-sh"><code class="language-sh">$ docker exec -it <gitlab-runner_container_name> gitlab-runner registerPlease enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):http://gitlab.example.com/Please enter the gitlab-ci token for this runner:gitlab-token # gitlabé¡¹ç›®é‡Œé¢çš„setting->CICDä¸­ runneré…ç½®ä¸­Please enter the gitlab-ci description for this runner:[Double-dong.local]: gitlab-ci # åå­—éšä¾¿å–Please enter the gitlab-ci tags for this runner (comma separated):python3.4 # æ ‡ç­¾åï¼Œ åç»­åœ¨.gitlab-ci.ymlä¸­ä½¿ç”¨Registering runner... succeeded                     runner=6-uZ1ndZPlease enter the executor: docker+machine, kubernetes, ssh, virtualbox, docker-ssh, parallels, shell, docker-ssh+machine, custom, docker:docker # è¿™é‡Œé€‰dockerï¼Œ å¯æ ¹æ®éœ€æ±‚ä»»é€‰ä¸€ä¸ªPlease enter the default Docker image (e.g. ruby:2.6):python:3.6 # é•œåƒåRunner registered successfully.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="/medias/files/getlab-token.png">getlab-token</a></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker-compose </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python Pypi Server</title>
      <link href="/2021/06/05/python-pypi-server/"/>
      <url>/2021/06/05/python-pypi-server/</url>
      
        <content type="html"><![CDATA[<h1 id="Python-Pypi-Server"><a href="#Python-Pypi-Server" class="headerlink" title="Python Pypi Server"></a>Python Pypi Server</h1><p><a href="https://www.jianshu.com/p/be91c70adb27" target="_blank" rel="noopener">è½¬è½½è‡ªã€ŠPyPIæ‰“åŒ…ä¸Šä¼ å®è·µã€‹</a></p><h2 id="1-ä»£ç æ‰“åŒ…"><a href="#1-ä»£ç æ‰“åŒ…" class="headerlink" title="1. ä»£ç æ‰“åŒ…"></a>1. ä»£ç æ‰“åŒ…</h2><p>è¦æ‰“åŒ…ä»£ç ï¼Œé¦–å…ˆéœ€è¦ç¼–å†™è‡ªå·±çš„ä»£ç åŒ…ã€‚æ¯”å¦‚ä½ å†™äº†ä¸€ä¸ª.pyæ–‡ä»¶ï¼Œé‡Œé¢æœ‰ä¸€äº›å‡½æ•°å•¥çš„ï¼Œä¸ºäº†æ–¹ä¾¿è°ƒç”¨ï¼Œä½ éœ€è¦å°†ä»£ç æ‰“åŒ…ï¼Œä¸‹æ¬¡ä½¿ç”¨æ—¶ç›´æ¥è°ƒç”¨å°±å¥½ï¼Œå› æ­¤ï¼Œç¬¬ä¸€æ­¥ï¼Œå°†ä½ å†™çš„ä»£ç æ‰“åŒ…ã€‚<br>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»º <code>__init__.py</code> æ–‡ä»¶ï¼Œç„¶åå°†ä½ å†™çš„.pyæ–‡ä»¶æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢å°±è¡Œã€‚</p><pre><code>packagename/    |    +-- __init__.py    |    +-- myfunction.py    |    +-- mymorefunction.py    |    +-- ...    |</code></pre><p><code>packagename</code>ä¸ºä½ åˆ›å»ºçš„åŒ…åç§°ï¼Œ<code>myxxx.py</code>æ˜¯ä½ å†™çš„pythonä»£ç ï¼Œè¿˜æœ‰æ·»åŠ ä¸ª<code>__init__.py</code>æ–‡ä»¶ï¼ˆæ–‡ä»¶å†…å®¹å¯ä»¥ä¸ºç©ºï¼‰.<br>ç°åœ¨ä½ å¯ä»¥è°ƒç”¨è¿™ä¸ªåŒ…äº†(å¼•å…¥åŒ…çš„è·¯å¾„)</p><pre><code>import packagename</code></pre><h2 id="2-ç¬¦åˆpypiçš„æ ¼å¼"><a href="#2-ç¬¦åˆpypiçš„æ ¼å¼" class="headerlink" title="2. ç¬¦åˆpypiçš„æ ¼å¼"></a>2. ç¬¦åˆpypiçš„æ ¼å¼</h2><p>å°†ä¸Šé¢çš„æ–‡ä»¶çš„ç›®å½•ç»“æ„æ”¹æˆå¦‚ä¸‹æ ¼å¼</p><pre><code>packagename    |    +-- COPYING.txt    |    +-- README.rst    |    +-- setup.py    |    +-- packagename    .       |    .       +-- __init__.py    .       |    .       +-- myscripts1.py    .       |    .       +-- mysscripts2.py    .       |    .       +-- mymorescripts.py    .       |    .    |    +-- docs/    |</code></pre><p>å°±æ˜¯å°†åŸæ¥çš„ç›®å½•æ·±ç§»ä¸€å±‚ï¼Œæ–‡ä»¶å¤¹çš„åç§°ä¸€æ ·å³å¯ã€‚åœ¨ç¬¬ä¸€å±‚ç›®å½•ä¸‹åˆ›å»ºäº›ç‰¹æ®Šæ–‡ä»¶ã€‚<br><strong><em>Tips</em></strong></p><blockquote><ul><li>COPYING.txt :<strong><em>å¯ä»¥ä¸è¦ï¼ˆèŠ‚çº¦æ—¶é—´ï¼Œé‡è¦çš„äº‹æƒ…å…ˆè¯´ã€ç®€å•è¯´ï¼‰ã€‚</em></strong><br>å°±æ˜¯æˆæƒæ–‡ä»¶ï¼Œé‡Œé¢æ˜¯ä½ å…³äºè¿™ä¸ªåŒ…çš„æˆæƒï¼Œæ¯”å¦‚ï¼šMIT licenseï¼Œé‚£ä¹ˆä½ é‡Œé¢æ”¾å…¥MIT Licenseå…¨æ–‡å³å¯ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ ä¸æ¸…æ¥šè¿™ä¸ªï¼Œä½ å®Œå…¨å¯ä»¥ä¸è¦è¿™ä¸ªæ–‡ä»¶ã€‚</li><li>README.rstï¼š<strong><em>å°±æ˜¯ä»‹ç»ï¼Œå¯ä»¥ä¸è¦å§ï¼ˆä¸æ¨èï¼Œè¦æ˜¯æƒ³è®©å¤§å®¶ç”¨çš„è¯è¿˜æ˜¯å¥½å¥½å†™ä¸€å†™ï¼‰</em></strong><br>è¿™ä¸ªæ–‡ä»¶æƒ³å¿…ç ”å‘éƒ½åº”è¯¥æ¸…æ¥šã€‚å¦‚æœæœ‰ï¼Œå°½é‡æ”¾äº›ä¸œè¥¿åœ¨è¿™é‡Œäº†ï¼Œåé¢å¦‚æœå¯èƒ½æˆ‘ä»¬ä¼šç”¨åˆ°å®ƒçš„ã€‚</li><li>setup.pyï¼š<strong><em>æ ¸å¿ƒæ–‡ä»¶</em></strong><br>è¿™é‡Œé¢çš„å†…å®¹åé¢è®²</li><li>docs/ï¼ˆè¿™æ˜¯ä¸ªæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾ä¸€äº›æ–‡æ¡£çš„ï¼‰<br>è¿™ä¸ªæ–‡ä»¶å¤¹ä½ æ”¾ä½ çš„documentså§ï¼Œä¸è¿‡è¦ç”¨å¿ƒå†™æ–‡æ¡£çœŸæ˜¯ä¸ªéš¾äº‹ï¼Œæ‰€ä»¥è¿™ä¸ªæ–‡ä»¶å¤¹åŸºæœ¬æ˜¯ä¸å­˜åœ¨çš„â€”â€”ä¸ºè‡ªå·±çš„æ‡’æƒ°å¯è€»ä¸€æŠŠã€‚</li></ul></blockquote><p><strong>setup.py</strong>çš„æ ·ä¾‹</p><pre><code># coding: utf-8import codecsimport osimport systry:    from setuptools import setupexcept:    from distutils.core import setup&quot;&quot;&quot;æ‰“åŒ…çš„ç”¨çš„setupå¿…é¡»å¼•å…¥ï¼Œ&quot;&quot;&quot;#!/usr/bin/env python# -*- coding: utf-8 -*-import sysif sys.version_info &lt; (2, 5):    sys.exit(&#39;Python 2.5 or greater is required.&#39;)try:    from setuptools import setupexcept ImportError:    from distutils.core import setupimport SendMoneywith open(&#39;README.rst&#39;, &#39;rb&#39;) as fp:    readme = fp.read()# ç‰ˆæœ¬å·ï¼Œè‡ªå·±éšä¾¿å†™VERSION = &quot;1.0.7&quot;LICENSE = &quot;MIT&quot;setup(    name=&#39;&lt;é¡¹ç›®çš„åç§°&gt;&#39;,    version=VERSION,    description=(        &#39;&lt;é¡¹ç›®çš„ç®€å•æè¿°&gt;&#39;    ),    long_description=readme,    author=&#39;&lt;ä½ çš„åå­—&gt;&#39;,    author_email=&#39;&lt;ä½ çš„é‚®ä»¶åœ°å€&gt;&#39;,    maintainer=&#39;&lt;ç»´æŠ¤äººå‘˜çš„åå­—&gt;&#39;,    maintainer_email=&#39;&lt;ç»´æŠ¤äººå‘˜çš„é‚®ä»¶åœ°å€&#39;,    license=LICENSE,    packages=find_packages(),    platforms=[&quot;all&quot;],    url=&#39;&lt;é¡¹ç›®çš„ç½‘å€ï¼Œæˆ‘ä¸€èˆ¬éƒ½æ˜¯githubçš„url&gt;&#39;,    install_requires=[        &quot;beautifulsoup4&quot;,        lxml_requirement        ],    classifiers=[        &#39;Development Status :: 4 - Beta&#39;,        &#39;Operating System :: OS Independent&#39;,        &#39;Intended Audience :: Developers&#39;,        &#39;License :: OSI Approved :: BSD License&#39;,        &#39;Programming Language :: Python&#39;,        &#39;Programming Language :: Python :: Implementation&#39;,        &#39;Programming Language :: Python :: 2&#39;,        &#39;Programming Language :: Python :: 2.7&#39;,        &#39;Programming Language :: Python :: 3&#39;,        &#39;Programming Language :: Python :: 3.4&#39;,        &#39;Programming Language :: Python :: 3.5&#39;,        &#39;Programming Language :: Python :: 3.6&#39;,        &#39;Topic :: Software Development :: Libraries&#39;    ],)# URL ä½ è¿™ä¸ªåŒ…çš„é¡¹ç›®åœ°å€ï¼Œå¦‚æœæœ‰ï¼Œç»™ä¸€ä¸ªå§ï¼Œæ²¡æœ‰ä½ ç›´æ¥å¡«å†™åœ¨PyPIä½ è¿™ä¸ªåŒ…çš„åœ°å€ä¹Ÿæ˜¯å¯ä»¥çš„# INSTALL_REQUIRES æ¨¡å—æ‰€ä¾èµ–çš„pythonæ¨¡å—# ä»¥ä¸Šå­—æ®µä¸éœ€è¦éƒ½åŒ…å«</code></pre><p>æ–‡ä¸­çš„classifiersçš„å†…å®¹å¹¶ä¸æ˜¯éšä¾¿å¡«å†™çš„ï¼Œä½ éœ€è¦å‚ç…§æœ¬æ–‡å‚è€ƒæ–‡æ¡£ä¸­çš„PyPI Classifiersæ¥å†™</p><h2 id="3ã€å¼€å§‹ä½¿ç”¨Distutilsè¿›è¡Œæ‰“åŒ…"><a href="#3ã€å¼€å§‹ä½¿ç”¨Distutilsè¿›è¡Œæ‰“åŒ…" class="headerlink" title="3ã€å¼€å§‹ä½¿ç”¨Distutilsè¿›è¡Œæ‰“åŒ…"></a>3ã€å¼€å§‹ä½¿ç”¨Distutilsè¿›è¡Œæ‰“åŒ…</h2><p>ä¸ºäº†ä¿è¯æ•ˆæœï¼Œåœ¨æ‰“åŒ…ä¹‹å‰æˆ‘ä»¬å¯ä»¥éªŒè¯setup.pyçš„æ­£ç¡®æ€§ï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç </p><blockquote><p>python setup.py check</p></blockquote><p>è¾“å‡ºä¸€èˆ¬æ˜¯running check<br>å¦‚æœæœ‰é”™è¯¯æˆ–è€…è­¦å‘Šï¼Œå°±ä¼šåœ¨æ­¤ä¹‹åæ˜¾ç¤º<br>æ²¡æœ‰ä»»ä½•æ˜¾ç¤ºè¡¨ç¤ºDistutilsè®¤å¯ä½ è¿™ä¸ªsetup.pyæ–‡ä»¶ã€‚</p><p>å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ­£å¼æ‰“åŒ…ï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼š</p><blockquote><p>python setup.py sdist</p></blockquote><p>æ‰§è¡Œå®Œæˆåï¼Œä¼šåœ¨é¡¶å±‚ç›®å½•ä¸‹ç”Ÿæˆdistç›®å½•å’Œeggç›®å½•</p><p>æ‰“åŒ…å®Œæˆåå°±å¯ä»¥å‡†å¤‡å°†æ‰“åŒ…å¥½çš„æ¨¡å—ä¸Šä¼ åˆ°pypiäº†ï¼Œé¦–å…ˆä½ éœ€è¦åœ¨<a href="https://link.jianshu.com?t=https%3A%2F%2Fpypi.org%2F" target="_blank" rel="noopener">pypi</a>ä¸Šè¿›è¡Œæ³¨å†Œ<br>æ³¨å†Œå®Œæˆåï¼Œä½ éœ€è¦åœ¨æœ¬åœ°åˆ›å»ºå¥½pypiçš„é…ç½®æ–‡ä»¶ï¼Œä¸ç„¶æœ‰å¯èƒ½ä¼šå‡ºç°ä½¿ç”¨httpæ— æ³•ä¸Šä¼ åˆ°pypiçš„é—®é¢˜<br>åœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»º.pypircæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹<br>windowç”¨æˆ·åˆ›å»º<code>.pypirc</code>å¯ä»¥å‘½åä¸º<code>.pypirc.</code>    ä½ç½®ç¤ºä¾‹ï¼š<code>C:\Users\admin\.pypirc.</code></p><pre><code>[distutils]index-servers=pypi[pypi]repository = https://upload.pypi.org/legacy/username = &lt;username&gt;password = &lt;password&gt;</code></pre><p>å®Œæˆåè¿è¡Œï¼š</p><blockquote><p>python setup.py register sdist upload</p></blockquote><p>æœ€åå‡ºç°<code>Server response (200): OK</code>å°±æ˜¯æˆåŠŸäº†ï¼Œå¯ä»¥å»pypiä¸ŠæŸ¥çœ‹è‡ªå·±å‘å¸ƒçš„åŒ…</p><p>åŒ…åˆ°è¿™é‡Œï¼Œå°±å®Œæˆäº†ä¸Šä¼ PyPIçš„å·¥ä½œäº†ã€‚ä½ å¦‚æœè¦ç”¨ï¼Œå®‰è£…ä¸‹å°±å¥½ï¼š</p><blockquote><p>pip install packagename</p></blockquote><p>è¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¾ˆé¡ºåˆ©çš„ï¼Œä»¥åå¤šå°è¯•ï¼Œå‡ºç°é—®é¢˜å†è¡¥å……ï¼</p><p>ä½œè€…ï¼šsnowy_sunny<br>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/be91c70adb27" target="_blank" rel="noopener">https://www.jianshu.com/p/be91c70adb27</a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pypi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Liunxå®‰è£…docker</title>
      <link href="/2021/05/26/liunx-an-zhuang-docker/"/>
      <url>/2021/05/26/liunx-an-zhuang-docker/</url>
      
        <content type="html"><![CDATA[<h2 id="ä½¿ç”¨è„šæœ¬è‡ªåŠ¨å®‰è£…-å¿«é€Ÿ"><a href="#ä½¿ç”¨è„šæœ¬è‡ªåŠ¨å®‰è£…-å¿«é€Ÿ" class="headerlink" title="ä½¿ç”¨è„šæœ¬è‡ªåŠ¨å®‰è£…(å¿«é€Ÿ)"></a>ä½¿ç”¨è„šæœ¬è‡ªåŠ¨å®‰è£…(å¿«é€Ÿ)</h2><p>Linux ç³»ç»Ÿä¸Šå¯ä»¥ä½¿ç”¨è¿™å¥—è„šæœ¬å®‰è£…ï¼Œå¦å¤–å¯ä»¥é€šè¿‡ â€“mirror é€‰é¡¹ä½¿ç”¨å›½å†…æºè¿›è¡Œå®‰è£…ï¼š<br><strong>è·å–è„šæœ¬</strong><br><a href="/medias/files/get-docker.sh">get-docker.sh</a></p><p><strong>å®‰è£…</strong></p><pre class="line-numbers language-sh"><code class="language-sh"># è®°å¾—ç»™å¯æ‰§è¡Œæƒé™chmod u+x get-docker.shsudo sh get-docker.sh --mirror Aliyun  # ä½¿ç”¨é˜¿é‡Œé•œåƒ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œè„šæœ¬å°±ä¼šè‡ªåŠ¨çš„å°†ä¸€åˆ‡å‡†å¤‡å·¥ä½œåšå¥½ï¼Œå¹¶å®‰è£…å¥½dockerã€‚</p><h2 id="å¯åŠ¨docker"><a href="#å¯åŠ¨docker" class="headerlink" title="å¯åŠ¨docker"></a>å¯åŠ¨docker</h2><pre class="line-numbers language-sh"><code class="language-sh">sudo systemctl enable dockersudo systemctl start docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å»ºç«‹-docker-ç”¨æˆ·ç»„"><a href="#å»ºç«‹-docker-ç”¨æˆ·ç»„" class="headerlink" title="å»ºç«‹ docker ç”¨æˆ·ç»„"></a>å»ºç«‹ docker ç”¨æˆ·ç»„</h2><p>é»˜è®¤æƒ…å†µä¸‹åªæœ‰ root ç”¨æˆ·å’Œ docker ç»„çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—® Docker å¼•æ“çš„ Unix socketã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸€èˆ¬ Linux ç³»ç»Ÿä¸Šä¸ä¼šç›´æ¥ä½¿ç”¨ root ç”¨æˆ·ã€‚å› æ­¤ï¼Œæ›´å¥½åœ°åšæ³•æ˜¯å°†éœ€è¦ä½¿ç”¨ docker çš„ç”¨æˆ·åŠ å…¥ docker ç”¨æˆ·ç»„ã€‚</p><p>å»ºç«‹ docker ç»„ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">sudo groupadd docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å°†å½“å‰ç”¨æˆ·åŠ å…¥ docker ç»„ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">sudo usermod -aG docker $USER<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€€å‡ºå½“å‰ç»ˆç«¯å¹¶é‡æ–°ç™»å½•å³å¯ã€‚</p><h2 id="ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ"><a href="#ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ" class="headerlink" title="ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ"></a>ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ</h2><p>åœ¨ <code>/etc/docker/daemon.json</code> ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨è¯·æ–°å»ºè¯¥æ–‡ä»¶ï¼‰ï¼š</p><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"https://hub-mirror.c.163.com"</span><span class="token punctuation">,</span>    <span class="token string">"https://mirror.baidubce.com"</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>æ³¨æ„ï¼Œä¸€å®šè¦ä¿è¯è¯¥æ–‡ä»¶ç¬¦åˆ json è§„èŒƒï¼Œå¦åˆ™ Docker å°†ä¸èƒ½å¯åŠ¨ã€‚</em></p><p>é‡æ–°å¯åŠ¨æœåŠ¡</p><pre class="line-numbers language-sh"><code class="language-sh">sudo systemctl daemon-reloadsudo systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker-compose å®‰è£…Redisã€Mysqlã€Kafkaã€RabbitMq</title>
      <link href="/2021/05/26/docker-compose-an-zhuang-redis-mysql-kafka-rabbitmq/"/>
      <url>/2021/05/26/docker-compose-an-zhuang-redis-mysql-kafka-rabbitmq/</url>
      
        <content type="html"><![CDATA[<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>docker-compose.yaml</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">redis</span><span class="token punctuation">:</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> redis    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true </span><span class="token comment" spellcheck="true"># å®¹å™¨å†…ä½¿ç”¨rootæƒé™</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./datadir<span class="token punctuation">:</span>/data      <span class="token punctuation">-</span> ./conf/redis.conf<span class="token punctuation">:</span>/usr/local/etc/redis/redis.conf      <span class="token punctuation">-</span> ./logs<span class="token punctuation">:</span>/logs    <span class="token key atrule">command</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#      ä¸¤ä¸ªå†™å…¥æ“ä½œ åªæ˜¯ä¸ºäº†è§£å†³å¯åŠ¨åè­¦å‘Š å¯ä»¥å»æ‰</span>      /bin/bash <span class="token punctuation">-</span>c "echo 511 <span class="token punctuation">></span> /proc/sys/net/core/somaxconn      &amp;&amp; echo never <span class="token punctuation">></span> /sys/kernel/mm/transparent_hugepage/enabled      &amp;&amp; redis<span class="token punctuation">-</span>server /usr/local/etc/redis/redis.conf"    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 6379<span class="token punctuation">:</span><span class="token number">6379</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>redis.conf</p><pre class="line-numbers language-sh"><code class="language-sh">daemonize nopidfile /var/run/redis.pidport 6379bind 0.0.0.0timeout 0loglevel verboselogfile /logs/redis.logdatabases 16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code>.â”œâ”€â”€ confâ”‚   â””â”€â”€ redis.confâ”œâ”€â”€ datadirâ”œâ”€â”€ docker-compose.yamlâ””â”€â”€ logs</code></pre><h3 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h3><p>docker-compose.yaml</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>5.7.16    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./datadir<span class="token punctuation">:</span>/var/lib/mysql      <span class="token punctuation">-</span> ./conf/my.cnf<span class="token punctuation">:</span>/etc/my.cnf    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">"root"</span>    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 3306<span class="token punctuation">:</span><span class="token number">3306</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>my.cnf</p><pre class="line-numbers language-sh"><code class="language-sh">[mysqld]user=mysqldefault-storage-engine=INNODBcharacter-set-client-handshake=FALSEcharacter-set-server=utf8mb4collation-server=utf8mb4_unicode_ciinit_connect='SET NAMES utf8mb4'[client]default-character-set=utf8mb4[mysql]default-character-set=utf8mb4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code>.â”œâ”€â”€ confâ”‚   â””â”€â”€ my.cnfâ”œâ”€â”€ datadirâ””â”€â”€ docker-compose.yaml</code></pre><h3 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h3><p>docker-compose.yaml</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">zookeeper</span><span class="token punctuation">:</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> zookeeper    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/zookeeper    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./zookeeper/data<span class="token punctuation">:</span>/data    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"2181:2181"</span>  <span class="token key atrule">kafka</span><span class="token punctuation">:</span>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kafka    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"9092:9092"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">KAFKA_ADVERTISED_HOST_NAME</span><span class="token punctuation">:</span> localhost      <span class="token key atrule">KAFKA_MESSAGE_MAX_BYTES</span><span class="token punctuation">:</span> <span class="token number">2000000</span>      <span class="token key atrule">KAFKA_CREATE_TOPICS</span><span class="token punctuation">:</span> <span class="token string">"test:1:1"</span>      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span><span class="token number">2181</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./kafka<span class="token punctuation">:</span>/kafka  <span class="token key atrule">kafka-manager</span><span class="token punctuation">:</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kafka<span class="token punctuation">-</span>manager    <span class="token key atrule">image</span><span class="token punctuation">:</span> sheepkiller/kafka<span class="token punctuation">-</span>manager    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> 9020<span class="token punctuation">:</span><span class="token number">9000</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">ZK_HOSTS</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span><span class="token number">2181</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š </p><pre><code>â”œâ”€â”€ docker-compose.yamlâ”œâ”€â”€ kafkaâ””â”€â”€ zookeeper    â””â”€â”€ data</code></pre><h3 id="RabbitMq"><a href="#RabbitMq" class="headerlink" title="RabbitMq"></a>RabbitMq</h3><p>docker-compose.yaml</p><pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.2"</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">:</span>3<span class="token punctuation">-</span>management<span class="token punctuation">-</span>alpine    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> <span class="token string">'rabbitmq'</span>    <span class="token key atrule">ports</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> 5672<span class="token punctuation">:</span><span class="token number">5672</span>        <span class="token punctuation">-</span> 15672<span class="token punctuation">:</span><span class="token number">15672</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> ./data/<span class="token punctuation">:</span>/var/lib/rabbitmq/        <span class="token punctuation">-</span> ./log/<span class="token punctuation">:</span>/var/log/rabbitmq    <span class="token key atrule">networks</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> rabbitmq_go_net    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> RABBITMQ_DEFAULT_VHOST=my_vhost      <span class="token punctuation">-</span> RABBITMQ_DEFAULT_USER=admin      <span class="token punctuation">-</span> RABBITMQ_DEFAULT_PASS=admin<span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token key atrule">rabbitmq_go_net</span><span class="token punctuation">:</span>  <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">â”œâ”€â”€ dataâ”œâ”€â”€ docker-compose.yamlâ””â”€â”€ log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker-compose </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gunicorn é…ç½®è¯¦è§£</title>
      <link href="/2021/05/16/gunicorn-pei-zhi-xiang-jie/"/>
      <url>/2021/05/16/gunicorn-pei-zhi-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p><code>-c CONFIG, --config CONFIG</code><br>Gunicorné…ç½®æ–‡ä»¶è·¯å¾„ï¼Œè·¯å¾„å½¢å¼çš„å­—ç¬¦ä¸²æ ¼å¼ï¼Œå¦‚ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">gunicorn -c gunicorn.conf main:app<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h3><p><code>-b ADDRESS, --bind ADDRESS</code><br>Gunicornç»‘å®šæœåŠ¡å™¨å¥—æ¥å­—ï¼ŒHostå½¢å¼çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚Gunicornå¯ç»‘å®šå¤šä¸ªå¥—æ¥å­—ï¼Œå¦‚ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">gunicorn -b 127.0.0.1:8000 -b [::1]:9000 manager:app<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="backlog"><a href="#backlog" class="headerlink" title="backlog"></a>backlog</h3><p><code>--backlog</code><br>æœªå†³è¿æ¥çš„æœ€å¤§æ•°é‡ï¼Œå³ç­‰å¾…æœåŠ¡çš„å®¢æˆ·çš„æ•°é‡ã€‚å¿…é¡»æ˜¯æ­£æ•´æ•°ï¼Œä¸€èˆ¬è®¾å®šåœ¨64~2048çš„èŒƒå›´å†…ï¼Œä¸€èˆ¬è®¾ç½®ä¸º2048ï¼Œè¶…è¿‡è¿™ä¸ªæ•°å­—å°†å¯¼è‡´å®¢æˆ·ç«¯åœ¨å°è¯•è¿æ¥æ—¶é”™è¯¯</p><h3 id="workers"><a href="#workers" class="headerlink" title="workers"></a>workers</h3><p><code>-w INT, --workers INT</code><br>ç”¨äºå¤„ç†å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œä¸ºæ­£æ•´æ•°ï¼Œé»˜è®¤ä¸º1ã€‚workeræ¨èçš„æ•°é‡ä¸ºå½“å‰çš„CPUä¸ªæ•°*2 + 1ã€‚è®¡ç®—å½“å‰çš„CPUä¸ªæ•°æ–¹æ³•ï¼š</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> multiprocessing<span class="token keyword">print</span> multiprocessing<span class="token punctuation">.</span>cpu_count<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="worker-class"><a href="#worker-class" class="headerlink" title="worker_class"></a>worker_class</h3><p><code>-k STRTING, --worker-class STRTING</code><br>ä½¿ç”¨å¯¿å‘½å·¥ä½œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºsyncã€‚å¯ä½¿ç”¨ä¸‹é¢çš„å¸¸ç”¨çš„å·¥ä½œæ¨¡å¼:</p><ul><li>sync</li><li>eventlet: éœ€è¦ä¸‹è½½eventlet &gt;= 0.9.7</li><li>gevent: éœ€è¦ä¸‹è½½gevent &gt;= 0.13</li><li>tornado: éœ€è¦ä¸‹è½½tornado &gt;= 0.2</li><li>gthread</li><li>gaiohttpï¼šéœ€è¦python 3.4å’Œaiohttp&gt;=0.21.5</li><li>uvicorn: éœ€è¦ä¸‹è½½uvicorn(éƒ¨ç½²fastAPIæ—¶ä½¿ç”¨, ä¸‹é¢ä¸¾ä¸ªä¾‹å­)</li></ul><pre class="line-numbers language-sh"><code class="language-sh"># ä¸¾ä¸ªä¾‹å­(fastAPI)gunicorn example:app -w 4 -k uvicorn.workers.UvicornWorker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="threads"><a href="#threads" class="headerlink" title="threads"></a>threads</h3><p><code>--threads INT</code><br>å¤„ç†è¯·æ±‚çš„å·¥ä½œçº¿ç¨‹æ•°ï¼Œä½¿ç”¨æŒ‡å®šæ•°é‡çš„çº¿ç¨‹è¿è¡Œæ¯ä¸ªworkerã€‚ä¸ºæ­£æ•´æ•°ï¼Œé»˜è®¤ä¸º1ã€‚</p><h3 id="worker-connections"><a href="#worker-connections" class="headerlink" title="worker_connections"></a>worker_connections</h3><p><code>--worker-connections INT</code><br>æœ€å¤§å®¢æˆ·ç«¯å¹¶å‘æ•°é‡ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå€¼ä¸º1000ã€‚æ­¤è®¾ç½®å°†å½±å“geventå’Œeventletå·¥ä½œæ¨¡å¼</p><h3 id="max-requests"><a href="#max-requests" class="headerlink" title="max_requests"></a>max_requests</h3><p><code>--max-requests INT</code><br>é‡æ–°å¯åŠ¨ä¹‹å‰ï¼Œå·¥ä½œå°†å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°ã€‚é»˜è®¤å€¼ä¸º0ã€‚</p><h3 id="timeout"><a href="#timeout" class="headerlink" title="timeout"></a>timeout</h3><p><code>-t INT, --timeout INT</code><br>è¶…è¿‡è¿™ä¹ˆå¤šç§’åå·¥ä½œå°†è¢«æ€æ‰ï¼Œå¹¶é‡æ–°å¯åŠ¨ã€‚ä¸€èˆ¬è®¾å®šä¸º30ç§’</p><h3 id="keepalive"><a href="#keepalive" class="headerlink" title="keepalive"></a>keepalive</h3><p><code>--keep-alive INT</code><br>åœ¨keep-aliveè¿æ¥ä¸Šç­‰å¾…è¯·æ±‚çš„ç§’æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹å€¼ä¸º2ã€‚ä¸€èˆ¬è®¾å®šåœ¨1~5ç§’ä¹‹é—´ã€‚</p><h3 id="limit-request-line"><a href="#limit-request-line" class="headerlink" title="limit_request_line"></a>limit_request_line</h3><p><code>--limit-request-line INT</code><br>HTTPè¯·æ±‚è¡Œçš„æœ€å¤§å¤§å°ï¼Œæ­¤å‚æ•°ç”¨äºé™åˆ¶HTTPè¯·æ±‚è¡Œçš„å…è®¸å¤§å°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼ä¸º4094ã€‚è¯¥å€¼çš„èŒƒå›´ä¸º0~8190ã€‚æ­¤å‚æ•°å¯ä»¥é˜²æ­¢ä»»ä½•DDOSæ”»å‡»</p><h3 id="limit-request-fields"><a href="#limit-request-fields" class="headerlink" title="limit_request_fields"></a>limit_request_fields</h3><p><code>--limit-request-fields INT</code><br>é™åˆ¶HTTPè¯·æ±‚ä¸­è¯·æ±‚å¤´å­—æ®µçš„æ•°é‡ã€‚æ­¤å­—æ®µç”¨äºé™åˆ¶è¯·æ±‚å¤´å­—æ®µçš„æ•°é‡ä»¥é˜²æ­¢DDOSæ”»å‡»ï¼Œä¸limit-request-field-sizeä¸€èµ·ä½¿ç”¨å¯ä»¥æé«˜å®‰å…¨æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼ä¸º100ï¼Œè¿™ä¸ªå€¼ä¸èƒ½è¶…è¿‡32768</p><h3 id="limit-request-field-size"><a href="#limit-request-field-size" class="headerlink" title="limit_request_field_size"></a>limit_request_field_size</h3><p><code>--limit-request-field-size INT</code><br>é™åˆ¶HTTPè¯·æ±‚ä¸­è¯·æ±‚å¤´çš„å¤§å°ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå€¼ä¸º8190ã€‚å€¼æ˜¯ä¸€ä¸ªæ•´æ•°æˆ–è€…0ï¼Œå½“è¯¥å€¼ä¸º0æ—¶ï¼Œè¡¨ç¤ºå°†å¯¹è¯·æ±‚å¤´å¤§å°ä¸åšé™åˆ¶</p><h3 id="reload"><a href="#reload" class="headerlink" title="reload"></a>reload</h3><p><code>--reload</code><br>ä»£ç æ›´æ–°æ—¶å°†é‡å¯å·¥ä½œï¼Œé»˜è®¤ä¸ºFalseã€‚æ­¤è®¾ç½®ä¸€èˆ¬ç”¨äºå¼€å‘ï¼Œæ¯å½“åº”ç”¨ç¨‹åºå‘ç”Ÿæ›´æ”¹æ—¶ï¼Œéƒ½ä¼šå¯¼è‡´å·¥ä½œé‡æ–°å¯åŠ¨ã€‚</p><h3 id="reload-engine"><a href="#reload-engine" class="headerlink" title="reload_engine"></a>reload_engine</h3><p><code>--reload-engine STRTING</code><br>é€‰æ‹©é‡è½½çš„å¼•æ“ï¼Œæ”¯æŒçš„æœ‰ä¸‰ç§ï¼š</p><ul><li>auto</li><li>pull</li><li>inotityï¼šéœ€è¦ä¸‹è½½</li></ul><h3 id="check-config"><a href="#check-config" class="headerlink" title="check_config"></a>check_config</h3><p><code>--check-config</code><br>æ˜¾ç¤ºç°åœ¨çš„é…ç½®ï¼Œé»˜è®¤å€¼ä¸ºFalseï¼Œå³æ˜¾ç¤ºã€‚</p><h3 id="preload-app"><a href="#preload-app" class="headerlink" title="preload_app"></a>preload_app</h3><p><code>--preload</code><br>åœ¨å·¥ä½œè¿›ç¨‹è¢«å¤åˆ¶(æ´¾ç”Ÿ)ä¹‹å‰åŠ è½½åº”ç”¨ç¨‹åºä»£ç ï¼Œé»˜è®¤ä¸ºFalseã€‚é€šè¿‡é¢„åŠ è½½åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥èŠ‚çœRAMèµ„æºï¼Œå¹¶ä¸”åŠ å¿«æœåŠ¡å™¨å¯åŠ¨æ—¶é—´ã€‚</p><h3 id="chdir"><a href="#chdir" class="headerlink" title="chdir"></a>chdir</h3><p><code>--chdir</code><br>åŠ è½½åº”ç”¨ç¨‹åºä¹‹å‰å°†chdirç›®å½•æŒ‡å®šåˆ°æŒ‡å®šç›®å½•</p><h3 id="daemon"><a href="#daemon" class="headerlink" title="daemon"></a>daemon</h3><p><code>--daemon</code><br>å®ˆæŠ¤Gunicornè¿›ç¨‹ï¼Œé»˜è®¤False</p><h3 id="raw-env"><a href="#raw-env" class="headerlink" title="raw_env"></a>raw_env</h3><p><code>-e ENV, --env ENV</code><br>è®¾ç½®ç¯å¢ƒå˜é‡(key=value)ï¼Œå°†å˜é‡ä¼ é€’ç»™æ‰§è¡Œç¯å¢ƒï¼Œå¦‚ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">gunicorin -b 127.0.0.1:8000 -e abc=123 manager:app<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å†™æ³•ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">raw_env=["abc=123"]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="pidfile"><a href="#pidfile" class="headerlink" title="pidfile"></a>pidfile</h3><p><code>-p FILE, --pid FILE</code><br>è®¾ç½®pidæ–‡ä»¶çš„æ–‡ä»¶åï¼Œå¦‚æœä¸è®¾ç½®å°†ä¸ä¼šåˆ›å»ºpidæ–‡ä»¶</p><h3 id="worker-tmp-dir"><a href="#worker-tmp-dir" class="headerlink" title="worker_tmp_dir"></a>worker_tmp_dir</h3><p><code>--worker-tmp-dir DIR</code><br>è®¾ç½®å·¥ä½œä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œå¦‚æœä¸è®¾ç½®ä¼šé‡‡ç”¨é»˜è®¤å€¼ã€‚</p><h3 id="accesslog"><a href="#accesslog" class="headerlink" title="accesslog"></a>accesslog</h3><p><code>--access-logfile FILE</code><br>è¦å†™å…¥çš„è®¿é—®æ—¥å¿—ç›®å½•</p><h3 id="access-log-format"><a href="#access-log-format" class="headerlink" title="access_log_format"></a>access_log_format</h3><p><code>--access-logformat STRING</code><br>è¦å†™å…¥çš„è®¿é—®æ—¥å¿—æ ¼å¼ã€‚å¦‚ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">access_log_format = '%(h)s %(l)s %(u)s %(t)s'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¸¸è§æ ¼å¼è¯´æ˜ï¼š<br>|  è¯†åˆ«ç    | è¯´æ˜                          |<br>|  â€”-     | â€”-                           |<br>|  h        |è¿œç¨‹åœ°å€                        |<br>|  l        |â€œ-â€œ                            |<br>|  u        |ç”¨æˆ·å                            |<br>|  t        |æ—¶é—´                            |<br>|  r        |çŠ¶æ€è¡Œï¼Œå¦‚ï¼šGET /test HTTP/1.1    |<br>|  m        |è¯·æ±‚æ–¹æ³•                        |<br>|  U        |æ²¡æœ‰æŸ¥è¯¢å­—ç¬¦ä¸²çš„URL            |<br>|  q        |æŸ¥è¯¢å­—ç¬¦ä¸²                        |<br>|  H        |åè®®                            |<br>|  s        |çŠ¶æ€ç                             |<br>|  B        |responseé•¿åº¦                    |<br>|  b        |responseé•¿åº¦(CLFæ ¼å¼)            |<br>|  f        |å‚è€ƒ                            |<br>|  a        |ç”¨æˆ·ä»£ç†                        |<br>|  T        |è¯·æ±‚æ—¶é—´ï¼Œå•ä½ä¸ºs                |<br>|  D        |è¯·æ±‚æ—¶é—´ï¼Œå•ä½ä¸ºms                 |<br>|  p        |è¿›ç¨‹id                            |<br>|  {Header}i    | è¯·æ±‚å¤´                    |<br>|  {Header}o    | ç›¸åº”å¤´                    |<br>|  {Variable}e    | ç¯å¢ƒå˜é‡                    |</p><h3 id="errorlog"><a href="#errorlog" class="headerlink" title="errorlog"></a>errorlog</h3><p><code>--error-logfile FILE, --log-file FILE</code><br>è¦å†™å…¥é”™è¯¯æ—¥å¿—çš„æ–‡ä»¶ç›®å½•ã€‚</p><h3 id="loglevel"><a href="#loglevel" class="headerlink" title="loglevel"></a>loglevel</h3><p><code>--log-level LEVEL</code><br>é”™è¯¯æ—¥å¿—è¾“å‡ºç­‰çº§ã€‚</p><p>æ”¯æŒçš„çº§åˆ«åç§°ä¸º:</p><ul><li>debug</li><li>info</li><li>warning</li><li>error</li><li>critical</li></ul><p>æ›´å¤šé…ç½®ï¼š<a href="http://docs.gunicorn.org/en/stable/settings.html#server-mechanics" target="_blank" rel="noopener">http://docs.gunicorn.org/en/stable/settings.html#server-mechanics</a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
