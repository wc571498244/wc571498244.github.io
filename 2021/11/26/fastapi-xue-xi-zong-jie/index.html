<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="FastApi学习总结, 博客 Python">
    <meta name="baidu-site-verification" content="code-9mfL0js8FS">
    <!-- <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48" /> -->
    <!-- <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7" /> -->
    <meta name="description" content=" 官网学习教程：https://fastapi.tiangolo.com/zh/
一、为什么要使用 FastAPI; FastAPI有哪些特点?1.快速：拥有非常高的性能，归功于 Starlette 和 Pydantic；Starlette">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>FastApi学习总结 | 进步缓慢的CYX</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?ce84511d3df71640a9378a69f6293044";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">进步缓慢的CYX</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-comments"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">进步缓慢的CYX</div>
        <div class="logo-desc">
            
            记录生活、记录工作
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-comments"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/wc571498244/wc571498244.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/wc571498244/wc571498244.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/5.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        FastApi学习总结
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/FastAPI/" target="_blank">
                            <span class="chip bg-color">FastAPI</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/Python/" class="post-category" target="_blank">
                            Python
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-11-26
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    OrangeQ
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    25 分
                </div>
                
                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p> <code>官网学习教程：</code><a href="https://fastapi.tiangolo.com/zh/" target="_blank" rel="noopener"><code>https://fastapi.tiangolo.com/zh/</code></a></p>
<h2 id="一、为什么要使用-FastAPI-FastAPI有哪些特点"><a href="#一、为什么要使用-FastAPI-FastAPI有哪些特点" class="headerlink" title="一、为什么要使用 FastAPI; FastAPI有哪些特点?"></a>一、为什么要使用 FastAPI; FastAPI有哪些特点?</h2><h3 id="1-快速："><a href="#1-快速：" class="headerlink" title="1.快速："></a>1.快速：</h3><p>拥有非常高的性能，归功于 Starlette 和 Pydantic；Starlette 用于路由匹配，Pydantic 用于数据验证</p>
<p> Starlette</p>
<pre><code>       1.官网使用介绍: https://www.starlette.io/

       2.什么是 Starlette?

        Starlette 是一种轻量级的 ASGI 框架/工具包，是构建高性能 asyncio 服务的理想选择。

       3.为什么使用 Starlette?

        Starlette 是目前测试最快的 Python 框架。只有 Uvicorn 超越了它，Uvicorn 不是框架，而是服务器。

       4.其他

        Starlette 提供了所有基本的 Web 微框架功能。但是它不提供自动数据验证，序列化或API 文档。

        自动数据验证由 Pydantic负责, API文档则是 OpenAPI  

        FastAPI 使用它来处理所有核心 Web 部件, 类 FastAPI 本身直接继承Starlette。</code></pre><p>因此，使用 Starlette 可以执行的任何操作，都可以直接使用 FastAPI 进行。</p>
<pre><code>        即路由匹配规则之内的 具体实现都要看 Starlette源码</code></pre><p>  Pydantic</p>
<pre><code>       1.官网使用介绍:</code></pre><p><a href="https://pydantic-docs.helpmanual.io/" target="_blank" rel="noopener">https://pydantic-docs.helpmanual.io/</a></p>
<pre><code>       2.什么是Pydantic?

            Pydantic 是一个库，基于Python类型提示来定义数据验证，序列化和文档（使用JSON模式）。

       3.为什么使用 Pydantic?

            FastAPI使用它来处理所有数据验证, 除了pydantic库之外，像是valideer库、marshmallow库、trafaret库以及cerberus库等都可以完成相似的功能，但是相较之下，pydantic库的执行效率会更加优秀一些。</code></pre><p>Uvicorn</p>
<p>   1.官网使用介绍</p>
<pre><code>    [https://www.uvicorn.org/](https://www.uvicorn.org/)</code></pre><p>   2.什么是 Uvicorn？</p>
<pre><code>Uvicorn 是基于 uvloop 和 httptools 构建的如闪电般快速的 ASGI 服务器。它不是Web框架，而是服务器</code></pre><h3 id="2-开发效率："><a href="#2-开发效率：" class="headerlink" title="2.开发效率："></a>2.开发效率：</h3><p>功能开发效率提升 200% 到 300%</p>
<pre><code>  2.1 路径参数/查询参数/Body参数 的提取与校验都被最大程度的支持

  2.2 依赖注入能较大程度的复用公共逻辑</code></pre><h3 id="3-减少-bug："><a href="#3-减少-bug：" class="headerlink" title="3.减少 bug："></a>3.减少 bug：</h3><p>减少 40% 的因为开发者粗心导致的错误</p>
<p>  Pydantic提供的 数据验证功能与 类型注释的结合能有效的减少BUG</p>
<h3 id="4-智能："><a href="#4-智能：" class="headerlink" title="4.智能："></a>4.智能：</h3><p>内部的类型注解非常完善，编辑器可处处自动补全</p>
<p>  支持Pydantic的IDE(编辑器)都能很好的支持补全等操作</p>
<h3 id="5-简单："><a href="#5-简单：" class="headerlink" title="5.简单："></a>5.简单：</h3><p>框架易于使用，文档易于阅读</p>
<h3 id="6-简短："><a href="#6-简短：" class="headerlink" title="6.简短："></a>6.简短：</h3><p>使代码重复最小化，通过不同的参数声明实现丰富的功能</p>
<pre><code>  依赖注入</code></pre><h3 id="7-健壮："><a href="#7-健壮：" class="headerlink" title="7.健壮："></a>7.健壮：</h3><p>可以编写出线上使用的代码，并且会自动生成交互式文档</p>
<h3 id="8-标准化："><a href="#8-标准化：" class="headerlink" title="8.标准化："></a>8.标准化：</h3><p>兼容 API 相关开放标准</p>
<h2 id="二、FastAPI开发的相关依赖"><a href="#二、FastAPI开发的相关依赖" class="headerlink" title="二、FastAPI开发的相关依赖"></a>二、FastAPI开发的相关依赖</h2><h3 id="1-Python"><a href="#1-Python" class="headerlink" title="1. Python"></a>1. Python</h3><p>  Python的版本要大于等于 3.6</p>
<h3 id="2-其他模块依赖"><a href="#2-其他模块依赖" class="headerlink" title="2. 其他模块依赖"></a>2. 其他模块依赖</h3><p>  pip install fastapi; 该操作会自动安装 Starlette 和 Pydantic</p>
<p>  pip install uvicorn;  uvicorn 是运行相关应用程序的服务器</p>
<p>  pip install fastapi[all]; 一步到位, 所有依赖全部安装</p>
<h2 id="三、交互式文档"><a href="#三、交互式文档" class="headerlink" title="三、交互式文档"></a>三、交互式文档</h2><p> FastAPI 会自动提供一个类似于 Swagger 的交互式文档，我们输入 “localhost:port/docs” 即可进入。</p>
<p> 交互式文档会显示 接口API的相关内容, 并且可以自定义接口信息, 具体如何操作, 后续再更新</p>
<h2 id="四、路由相关"><a href="#四、路由相关" class="headerlink" title="四、路由相关"></a>四、路由相关</h2><h3 id="1-路由匹配规则"><a href="#1-路由匹配规则" class="headerlink" title="1.路由匹配规则"></a>1.路由匹配规则</h3><p>1.1 普通路由匹配</p>
<p>  在一个 路由定义模块中, 若一个URL可以匹配上多个 自定义路由的情况下</p>
<p>  会优先匹配到 先定义的那一个。</p>
<p>举个例子:</p>
<pre><code># coding: utf-8
from fastapi import FastAPI
import uvicorn

app = FastAPI()

@app.get(&quot;/users/me&quot;)
async def read_user_me():
    return {&quot;user_id&quot;: &quot;the current user&quot;}

@app.get(&quot;/users/{user_id}&quot;)
async def read_user(user_id: int):
    return {&quot;user_id&quot;: user_id}

if __name__ == &quot;__main__&quot;:
    uvicorn.run(&quot;main:app&quot;, host=&quot;0.0.0.0&quot;, port=8080)</code></pre><p><strong>因为路径操作是按照顺序进行的，所以这里要保证</strong> <code>/users/me</code> <strong>在</strong> <code>/users/{user\_id}</code> <strong>的前面，否则的话只会匹配到</strong> <code>/users/{user\_id}</code><strong>，此时如果访问</strong> <code>/users/me</code><strong>，那么会返回一个解析错误，因为字符串 “me” 无法解析成整型。</strong></p>
<h3 id="2-APIRouter路由组"><a href="#2-APIRouter路由组" class="headerlink" title="2.APIRouter路由组"></a>2.APIRouter路由组</h3><p>APIRouter主要是给路由加前缀, 方便于在项目中 对于不同模块或者不同类别的接口 加一个统一的前缀进行绑定, 有点类似分组/文件夹的意思</p>
<p>APIRouter: 有点类似于GO中gin框架中的路由组的概念, 所以这里写的是路由组</p>
<p>使用方式如下:</p>
<p>1.在app具体的模块中</p>
<pre><code># app/user/user_login.py
from fastapi import APIRouter

user_router = APIRouter(prefix=&quot;/v1/users&quot;)

# 以后访问的时候要通过 /v1/users/login     来访问
@router.get(&quot;/login&quot;)
async def v1():
    return {&quot;message&quot;: &quot;hello world&quot;}</code></pre><p>2.在项目启动加载的 main.py中:</p>
<pre><code># main.py
from fastapi import FastAPI
from app.user.user_login import user_router
import uvicorn

app = FastAPI()

# 将 user_router 注册到 app 中，相当于 Flask 中的 register_blueprint
app.include_router(router)

if __name__ == &quot;__main__&quot;:
    uvicorn.run(&quot;main:app&quot;, host=&quot;0.0.0.0&quot;, port=8080)</code></pre><h3 id="3-禁用一个路由"><a href="#3-禁用一个路由" class="headerlink" title="3.禁用一个路由:"></a>3.禁用一个路由:</h3><p>参数 include_in_schema 设置为 False</p>
<p> @app.get(“/items/“, include_in_schema=False)</p>
<p>但是这个 禁用路由仅仅只是在 docs页面隐藏该 接口 不显示, 实际上并不影响其调用和真正使用。只是接口文档处对外界不可知~</p>
<h2 id="五、请求参数获取"><a href="#五、请求参数获取" class="headerlink" title="五、请求参数获取"></a>五、请求参数获取</h2><p>PS： 这里只介绍参数获取, 对于参数校验的写法， 详见第六章</p>
<h3 id="5-1-获取路径参数"><a href="#5-1-获取路径参数" class="headerlink" title="5.1 获取路径参数"></a>5.1 获取路径参数</h3><p>路径参数的声明:</p>
<p>路径参数声明在url中, 并且用一对花括号<code>{user\_id}</code>包裹； eg. <code>@app.get(&quot;/user/{user\_id}&quot;)</code></p>
<p>对于多个 路径参数来说, 用多个 <code>{}</code> 包裹即可；eg. <code>@app.get(&quot;/user/{part\_id}/{user\_name}&quot;)</code></p>
<p>路径参数的获取:</p>
<pre><code>@app.get(&quot;/user/{part_id}/{user_name}&quot;)
async def get_user(part_id: str, user_name: str):
    &quot;&quot;&quot;在路由函数中定义的两个路径参数 part_id/user_name
        只要路由函数中的 参数名能与之对应(一模一样), 
        那么在这里路由函数获取的 part_id/user_name就是路径参数上对应的 part_id/user_name
       在路由函数中 这两个参数的顺序没有要求
    &quot;&quot;&quot;
    return {&quot;part_id&quot;: part_id, &quot;user_name&quot;: user_name}</code></pre><p>对于特殊路径参数的获取, 详见 5.4 获取path类型参数</p>
<h3 id="5-2-获取params参数"><a href="#5-2-获取params参数" class="headerlink" title="5.2 获取params参数"></a>5.2 获取params参数</h3><p>查询参数不需要声明, 如果函数中定义了不属于路径参数的参数时，那么它们将会被自动解释会查询参数。</p>
<p><strong>方式一: 默认方式</strong></p>
<pre><code>@app.get(&quot;/user/{user_id}&quot;)
async def get_user(user_id: str, name: str, age: int):
    &quot;&quot;&quot;我们在函数中参数定义了 user_id、name、age 三个参数
       显然 user_id 和 路径参数中的 user_id 对应，然后 name 和 age 会被解释成查询参数
       这三个参数的顺序没有要求，但是一般都是路径参数在前，查询参数在后

       PS: 这里做了 类型注释, 因此传进来的 参数会经过 是否必要性检测即参数类型检测
               这里的声明表示, params参数 name/age 是必填参数, 没有传会抛错
            虽然params参数的数据框架在接收的时候, value都是 str类型的, 但是这里声明 age: int时, 
            age: &#39;10&#39; 会被强转为 age: 10; 但是对于 age: &#39;test&#39; 这类的参数 则会报类型错误~
    &quot;&quot;&quot;
    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name, &quot;age&quot;: age}</code></pre><p>方式二: 使用Query 类型注释</p>
<pre><code>@app.get(&quot;/user/{user_id}&quot;)
async def get_user(user_id: str, name: str=Query(...), age: int=Query(...)):
    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name, &quot;age&quot;: age}</code></pre><h3 id="5-3-获取body参数"><a href="#5-3-获取body参数" class="headerlink" title="5.3 获取body参数"></a>5.3 获取body参数</h3><h4 id="5-3-1-获取json类型-body参数-单个请求体"><a href="#5-3-1-获取json类型-body参数-单个请求体" class="headerlink" title="5.3.1 获取json类型 body参数(单个请求体)"></a>5.3.1 获取json类型 body参数(单个请求体)</h4><p><strong>方式一: 使用Body类型</strong></p>
<pre><code>from datetime import datetime, time, timedelta
from typing import Optional
from uuid import UUID

from fastapi import Body, FastAPI

app = FastAPI()</code></pre><p>​<br>    @app.put(“/items/{item_id}”)<br>    async def read_items(<br>        item_id: UUID,<br>        start_datetime: Optional[datetime] = Body(None),        # 这里的 Body类型注释 表明了获取的是一个 body参数<br>        end_datetime: Optional[datetime] = Body(None),<br>        repeat_at: Optional[time] = Body(None),<br>        process_after: Optional[timedelta] = Body(None),<br>    ):<br>        start_process = start_datetime + process_after<br>        duration = end_datetime - start_process<br>        return {<br>            “item_id”: item_id,<br>            “start_datetime”: start_datetime,<br>            “end_datetime”: end_datetime,<br>            “repeat_at”: repeat_at,<br>            “process_after”: process_after,<br>            “start_process”: start_process,<br>            “duration”: duration,<br>        }</p>
<p><strong>方式二: 继承BaseModel （Pydantic提供）</strong></p>
<p>如果参数的类型被声明为一个 Pydantic 模型，它将被解释为请求体。</p>
<pre><code>from typing import Optional, List
from fastapi import FastAPI, Request, Response
from pydantic import BaseModel
import uvicorn

app = FastAPI()</code></pre><p>​<br>    class Girl(BaseModel):<br>        “””数据验证是通过 pydantic 实现的，我们需要从中导入 BaseModel，然后继承它”””<br>        name: str<br>        age: Optional[str] = None<br>        length: float<br>        hobby: List[str]  # 对于 Model 中的 List[str] 我们不需要指定 Query（准确的说是 Field）</p>
<p>​<br>    @app.post(“/girl”)<br>    async def read_girl(girl: Girl):<br>        # girl 就是我们接收的请求体，它需要通过 json 来传递，并且这个 json 要有上面的四个字段（age 可以没有）<br>        # 通过 girl.xxx 的方式我们可以获取和修改内部的所有属性<br>        return dict(girl)  # 直接返回 Model 对象也是可以的</p>
<h4 id="5-3-2-获取json类型-body参数-多个请求体"><a href="#5-3-2-获取json类型-body参数-多个请求体" class="headerlink" title="5.3.2 获取json类型 body参数(多个请求体)"></a>5.3.2 获取json类型 body参数(多个请求体)</h4><p>上面只是接收一个请求体的情况, 如果是接收两个请求体呢？</p>
<pre><code>class Girl(BaseModel):
    name: str
    age: Optional[str] = None

class Boy(BaseModel):
    name: str
    age: int

@app.post(&quot;/boy_and_girl&quot;)
async def read_boy_and_girl(girl: Girl,
                            boy: Boy):
    return {&quot;girl&quot;: dict(girl), &quot;boy&quot;: dict(boy)}</code></pre><p>对于上述这种写法, 在传入body数据时, 在json串中 应该有两个子json串，且其key分别为 girl/boy</p>
<p>如何理解?</p>
<p>实际上对于 继承了 BaseModel或者 路由函数中 直接使用 Body类型进行声明的 参数, 框架都会接收为 body参数, 这些body参数可以看做是关键字参数, 但是当 只有一个 BaseModel类型时, 就可以不使用关键字进行识别</p>
<p>上述案例的请求体示例如下:</p>
<pre><code>{
    &quot;girl&quot;: {&quot;name&quot;: &quot;新垣结衣&quot;, &quot;age&quot;: 18},
    &quot;boy&quot;: {&quot;name&quot;: &quot;星野源&quot;, &quot;age&quot;: 18}
}</code></pre><p>PS: 其实上述写法, 也可以只是用一个 请求体来表示( 即这种 BaseModel的写法是可以多层嵌套的~)</p>
<pre><code>class Girl(BaseModel):
    name: str
    age: Optional[str] = None

class Boy(BaseModel):
    name: str
    age: int

class BoyGirl(BaseModel):
    girl: Girl
    boy: Boy

@app.post(&quot;/boy_and_girl&quot;)
async def read_boy_and_girl(boy_girl: BoyGirl):
    return dict(boy_girl)</code></pre><h4 id="5-3-3-获取from表单数据"><a href="#5-3-3-获取from表单数据" class="headerlink" title="5.3.3 获取from表单数据"></a>5.3.3 获取from表单数据</h4><p><strong>方式一: 使用 Form 类型</strong></p>
<pre><code>from fastapi import FastAPI, Form

app = FastAPI()
@app.post(&quot;/login&quot;)
async def user_login(username: str = Form(...),        # 这里的Form类型 表明接收的是 form表单的数据
                   password: str = Form(...)):
    return {&quot;username&quot;: username, &quot;password&quot;: password}</code></pre><p><strong>方式二：使用request</strong></p>
<pre><code>from fastapi import FastAPI, Request

app = FastAPI()
@app.post(&quot;/girl&quot;)
async def girl(request: Request):
    # 此时 await request.json() 报错，因为是通过 data 参数传递的，相当于 form 表单提交
    # 如果是通过 json 参数传递，那么 await request.form() 会得到一个空表单
    form = await request.form()
    return [form.get(&quot;name&quot;), form.getlist(&quot;age&quot;)]</code></pre><p>PS: python如何发送 form表单数据（使用 data参数）</p>
<pre><code>requests.post(url, data={&quot;name&quot;: &quot;test1&quot;, &quot;password&quot;: &quot;test2&quot;})</code></pre><h4 id="5-3-4-获取文件上传数据"><a href="#5-3-4-获取文件上传数据" class="headerlink" title="5.3.4 获取文件上传数据"></a>5.3.4 获取文件上传数据</h4><p><strong>1.获取单个文件(使用 File类型)</strong></p>
<pre><code>from fastapi import FastAPI, File, UploadFile

app = FastAPI()
@app.post(&quot;/file1&quot;)
async def file1(file: bytes = File(...)):        # 这里使用的是 File类型 接收的是一个 bytes 字节流
    return f&quot;文件长度: {len(file)}&quot;

@app.post(&quot;/file2&quot;)
async def file1(file: UploadFile = File(...)):        # 这里接收的是 一个文件句柄对象, 这两种方式都可以获取到上传的文件
    return f&quot;文件名: {file.filename}, 文件大小: {len(await file.read())}&quot;</code></pre><p><strong>2.获取多个文件</strong></p>
<pre><code>@app.post(&quot;/file&quot;)
async def file(files: List[UploadFile] = File(...)):
    &quot;&quot;&quot;指定类型为列表即可&quot;&quot;&quot;
    for idx, f in enumerate(files):
        files[idx] = f&quot;文件名: {f.filename}, 文件大小: {len(await f.read())}&quot;
    return f</code></pre><p>PS： Python如何上传文件?</p>
<p>首先如果想使用文件上传功能，那么你必须要安装一个包 python-multipart，直接 pip install python-multipart 即可。</p>
<pre><code># 上传单个文件
requests.post(url, files={&quot;file&quot;: open(r&quot;/file_path/file_name&quot;, &quot;rb&quot;)})

# 上传多个文件
requests.post(url, files={&quot;file&quot;: [
            (&quot;files&quot;, open(r&quot;/file_path1/file_name1&quot;),
               (&quot;files&quot;, open(r&quot;/file_path2/file_name2&quot;),
            (&quot;files&quot;, open(r&quot;/file_path3/file_name3&quot;)
]})</code></pre><h3 id="5-4-获取path类型参数"><a href="#5-4-获取path类型参数" class="headerlink" title="5.4 获取path类型参数"></a>5.4 获取path类型参数</h3><p>假设我们有这样一个路由：<code>/files/{file\_path}</code>，而用户传递的 file_path 中显然是可以带 / 的，假设 file_path 是 <code>/root/test.py</code>，那么路由就变成了 <code>/files//root/test.py</code>，显然这样子进行路由匹配就会出问题。</p>
<p>这是我们需要声明 file_path 的类型为 path, eg. @app.get(“/files/{file_path:path}”)</p>
<p><strong>方式一: 声明path类型</strong></p>
<pre><code>from fastapi import FastAPI

app = FastAPI()</code></pre><p>​<br>    # 声明 file_path 的类型为 path，这样它会被当成一个整体<br>    @app.get(“/files/{file_path:path}”)<br>    async def get_file(file_path: str):<br>        return {“file_path”: file_path}</p>
<p><strong>方式二: 使用Path 类型注释</strong></p>
<pre><code>from fastapi import FastAPI, Path
@app.get(&quot;/items/{item-id}&quot;)
# 这里用 Path类型来接收, 也会将后面的整体作为一个path.
# 这里的 alias表示 重命名, 也就是将 路由函数中的 变量 item_id 与 路由中的 item-id 对应上.
async def read_items(item_id: int = Path(..., alias=&quot;item-id&quot;)):
    return {&quot;item_id&quot;: item_id}</code></pre><p>PS: 也就是说, 当路径参数中 声明了 一个参数为 Path类型, 那么这个参数后面不能在接其他的路径参数。即 <code>@app.get(&quot;/files/{file\_path:path}/{user\_id}&quot;)</code> 这样的写法， user_id就获取不到~</p>
<h3 id="5-5-多种请求参数混合获取"><a href="#5-5-多种请求参数混合获取" class="headerlink" title="5.5 多种请求参数混合获取"></a>5.5 多种请求参数混合获取</h3><h4 id="5-5-1-路由函数中使用类型区别"><a href="#5-5-1-路由函数中使用类型区别" class="headerlink" title="5.5.1 路由函数中使用类型区别"></a>5.5.1 路由函数中使用类型区别</h4><p><strong>方式一: 直接使用内置方式获取</strong></p>
<p>1.如果在路径中也声明了该参数，它将被用作路径参数</p>
<p>2.如果参数属于单一类型（比如 int、float、str、bool 等）它将被解释为查询参数。</p>
<p>   3.如果参数的类型被声明为一个 Pydantic 模型，它将被解释为请求体。</p>
<pre><code>from fastapi import FastAPI
from pydantic.main import BaseModel

app = FastAPI()

class Girl(BaseModel):
    name: str
    age: int

@app.get(&quot;/user/{user_id}&quot;)
async def get_user(user_id: str, name: str, age: int, girl: Girl):
    # user_id 为路径参数
    # name/age 为params参数
    # girl 为body参数
    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name, &quot;age&quot;: age, &quot;girl&quot;: girl.dict()}</code></pre><p><strong>方式二: 使用 类型注释来获取</strong></p>
<p>Path(路径参数)/Query(params参数)/Body(json请求体)/Form(form表单请求体)/File(文件)</p>
<p>Cookie(cookie参数)/Header(请求头)</p>
<p>关于 Path(路径参数)/Query(params参数)/Body(json请求体)/Form(form表单请求体)/File(文件)的使用方式, 上面已经有过展示， 这里不再赘述</p>
<p>Cookie:</p>
<p>1.声明：ads_id: Optional[str] = Cookie(None)</p>
<p>Header：</p>
<p>1.声明： user_agent: Optional[str] = Header(None)</p>
<p>2.默认情况下, Header 将把参数名称的字符从下划线 (_) 转换为连字符 (-) 来提取并记录 headers.</p>
<p>3.设置Header的参数 convert_underscores 为 False, 可以取消上述的 下划线到连字符的自动转换</p>
<p>4.headers 是大小写不敏感的</p>
<p>5.声明多个header: x_token: Optional[List[str]] = Header(None) –&gt; 例: 使用header传输 cookie的情况</p>
<p>PS：</p>
<p>Cookie 、Header、Path 、Query是兄弟类，它们都继承自公共的 Param 类 –&gt; 很明显Body/File/Form不是</p>
<h4 id="5-5-2-使用request对象获取"><a href="#5-5-2-使用request对象获取" class="headerlink" title="5.5.2 使用request对象获取"></a>5.5.2 使用request对象获取</h4><p>任何一个请求都对应一个 Request 对象，请求的所有信息都在这个 Request 对象中</p>
<p>获取参数方式如下：</p>
<pre><code>@app.get(&quot;/girl/{user_id}&quot;)
async def read_girl(user_id: str,
                    request: Request):
    &quot;&quot;&quot;路径参数是必须要体现在参数中，但是查询参数可以不写了
       因为我们定义了 request: Request，那么请求相关的所有信息都会进入到这个 Request 对象中&quot;&quot;&quot;
    header = request.headers  # 请求头
    method = request.method  # 请求方法
    cookies = request.cookies  # cookies
    query_params = request.query_params  # 查询参数
    body_data = await request.json()  # 获取json请求体, 该函数本质上步骤为: body = await self.body() + self._json = json.loads(body)
    return {&quot;name&quot;: query_params.get(&quot;name&quot;), &quot;age&quot;: query_params.get(&quot;age&quot;), &quot;hobby&quot;: query_params.getlist(&quot;hobby&quot;)}</code></pre><h4 id="5-5-3-参数顺序"><a href="#5-5-3-参数顺序" class="headerlink" title="5.5.3 参数顺序"></a>5.5.3 参数顺序</h4><p>路径参数应该在查询参数的前面，尽管 FastAPI 没有这个要求，但是这样写明显更舒服一些。但是问题来了，如果路径参数需要指定别名，但是某一个查询参数不需要，这个时候就会出现问题</p>
<pre><code>@app.get(&quot;/items/{item-id}&quot;)
async def read_items(q: str,
                     item_id: int = Path(..., alias=&quot;item-id&quot;)):

    return {&quot;item_id&quot;: item_id, &quot;q&quot;: q}</code></pre><p>显然此时 Python 的语法就决定了 item_id 就必须放在 q 的后面，当然这么做是完全没有问题的，FastAPI 对参数的先后顺序没有任何要求，因为它是通过参数的名称、类型和默认值声明来检测参数，而不在乎参数的顺序。但此时我们就要让 item_id 在 q 的前面要怎么做呢？</p>
<pre><code>@app.get(&quot;/items/{item-id}&quot;)
async def read_items(*, item_id: int = Path(..., alias=&quot;item-id&quot;),
                     q: str):

    return {&quot;item_id&quot;: item_id, &quot;q&quot;: q}</code></pre><p>通过将第一个参数设置为 *，使得 item_id 和 q 都必须通过关键字传递，所以此时默认参数在非默认参数之前也是允许的。当然我们也不需要担心 FastAPI 传参的问题，你可以认为它所有的参数都是通过关键字参数的方式传递的。</p>
<h2 id="六、数据校验"><a href="#六、数据校验" class="headerlink" title="六、数据校验"></a>六、数据校验</h2><h3 id="6-1-类型注释的数据校验方式"><a href="#6-1-类型注释的数据校验方式" class="headerlink" title="6.1 类型注释的数据校验方式"></a>6.1 类型注释的数据校验方式</h3><p>Path(路径参数)/Query(params参数)/Body(json请求体)/Form(form表单请求体)/File(文件)/Cookie(cookie参数)/Header(请求头)</p>
<p>上述这些 类在用于 类型注释时, 使用方式基本都差不多, 只是在某些方面有一些细微的差别</p>
<p>6.1.1 公共校验部分</p>
<p>这里以Query为例</p>
<pre><code>Query(
            None,
            alias=&quot;item-query&quot;,
            title=&quot;Query string&quot;,
            description=&quot;Query string for the items to search in the database that have a good match&quot;,
            min_length=3,
            max_length=50,
            regex=&quot;^fixedquery$&quot;,
            deprecated=True,
        )

        1.修改额外的原数据:
            alias - 起别名
            title/description - 文档描述
            deprecated - 参数弃用标识

        2.用于校验的参数：    
            min_length/max_length    长度匹配
            regex        正则匹配

        3.数值校验:
            gt/ge/lt/le： 大于/大于等于/小于/小于等于 定义为float类型

        4.设置必填/非必填/默认值
        Query(...)    - 设置为必填
         Query(None) - 设置为非必填
      Query(&quot;test&quot;) - 设置默认值 test

     5.接收列表
         q: Optional[List[str]] = Query(None) 定义 query参数为必填的list, 即能匹配 xxx_url?q=foo&amp;q=bar ---&gt; q=[&#39;foo&#39;, &#39;bar&#39;]

     6.指定数据接收类型
         q:  Optional[str] = Query(...)
      q: str    

      这里支持的数据类型:
      int/float/str/bool/list/dict/set
      UUID/datetime.datetime(2008-09-15T15:53:00+05:00)/datetime.date(2008-09-15)
      datetime.time(14:23:55.003)/datetime.timedelta(时间戳秒数)/bytes/Decimal(框架内可当做float使用)

         支持指定多种数据类型：
          user_id: Union[int, str]</code></pre><p>举个例子:</p>
<pre><code>@app.get(&quot;/user&quot;)
async def check_length(
        password: str = Query(&quot;satori&quot;, min_length=6, max_length=15, regex=r&quot;^satori&quot;)
):
    &quot;&quot;&quot;此时的 password 默认值为 &#39;satori&#39;，并且传递的时候必须要以 &#39;satori&#39; 开头
       但是值得注意的是 password 后面的是 str，不再是 Optional[str]，因为默认值不是 None 了
       当然这里即使写成 Optional[str] 也是没有什么影响的
    &quot;&quot;&quot;
    return {&quot;password&quot;: password}</code></pre><p>​<br>    @app.get(“/items”)<br>    async def read_items(<br>            a1: str = Query(…),    # … 设置为必填参数<br>            a2: List[str] = Query(…), # 查询参数变成一个列表; 对应于 url后 a=1&amp;a=2的情况<br>            b: List[str] = Query(…)<br>    ):<br>        return {“a1”: a1, “a2”: a2, “b”: b}</p>
<pre><code>@app.get(&quot;/items&quot;)
async def read_items(
        # item1 必须大于 5
        item1: int = Query(..., gt=5),        # 数值检测
        # item2 必须小于等于 7
        item2: int = Query(..., le=7),
        # item3 必须必须等于 10
        item3: int = Query(..., ge=10, le=10)
):
    return {&quot;item1&quot;: item1, &quot;item2&quot;: item2, &quot;item3&quot;: item3}</code></pre><h4 id="6-1-2-各类型特殊部分"><a href="#6-1-2-各类型特殊部分" class="headerlink" title="6.1.2 各类型特殊部分"></a>6.1.2 各类型特殊部分</h4><p><strong>Path:</strong></p>
<p>1.路径参数总是必须的, 所以应表示为Path(…), 即使写为了 Path(None), 也还是一个必选参数</p>
<p><strong>Header：</strong></p>
<p>1.默认情况下, Header 将把参数名称的字符从下划线 (_) 转换为连字符 (-) 来提取并记录 headers.</p>
<p>2.设置Header的参数 convert_underscores 为 False, 可以取消上述的 下划线到连字符的自动转换</p>
<p>3.headers 是大小写不敏感的</p>
<h4 id="6-1-3-特殊检验类型-Filed"><a href="#6-1-3-特殊检验类型-Filed" class="headerlink" title="6.1.3 特殊检验类型 Filed"></a>6.1.3 特殊检验类型 Filed</h4><p>Filed与BaseModel一样, 由pydantic模块提供</p>
<p>Filed类型的用法与 Query一致, 唯一的区别就是Filed可以对所有类型的 参数进行参数校验，而不像Query/Body这类参数, 在校验时, 只能获取对应的参数。</p>
<p>如果有个 username参数即在 params参数中会出现， 在body参数中也会出现, 甚至于在 response 中也可能会出现， 此时使用 Filed进行参数验证就比较合适</p>
<p>Filed的使用 示例见 6.3</p>
<h3 id="6-2-变量类型声明的特殊情况"><a href="#6-2-变量类型声明的特殊情况" class="headerlink" title="6.2 变量类型声明的特殊情况"></a>6.2 变量类型声明的特殊情况</h3><h4 id="6-2-1-默认值与声明值可不同"><a href="#6-2-1-默认值与声明值可不同" class="headerlink" title="6.2.1 默认值与声明值可不同"></a>6.2.1 默认值与声明值可不同</h4><pre><code>@app.get(&quot;/user/{user_id}&quot;)
async def get_user(user_id: str, name: str = &quot;UNKNOWN&quot;, age: int = &quot;哈哈哈&quot;):    # 这里的 age 需要接收一个整型，但是默认值却是一个字符串
    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name, &quot;age&quot;: age}</code></pre><p>这种情况下传递的 age 依旧需要整型，只不过在不传的时候会使用字符串类型的默认值，所以类型和默认值类型不同的时候也是可以的</p>
<h4 id="6-2-2-同一个变量指定多个类型"><a href="#6-2-2-同一个变量指定多个类型" class="headerlink" title="6.2.2 同一个变量指定多个类型"></a>6.2.2 同一个变量指定多个类型</h4><pre><code>from typing import Union, Optional

@app.get(&quot;/user/{user_id}&quot;)
async def get_user(user_id: Union[int, str], name: Optional[str] = None):
    &quot;&quot;&quot;通过 Union 来声明一个混合类型，int 在前、str 在后。会先按照 int 解析，解析失败再变成 str
       然后是 name，它表示字符串类型、但默认值为 None（不是字符串），那么应该声明为 Optional[str]&quot;&quot;&quot;
    return {&quot;user_id&quot;: user_id, &quot;name&quot;: name}</code></pre><h4 id="6-2-3指定数据接收类型"><a href="#6-2-3指定数据接收类型" class="headerlink" title="6.2.3指定数据接收类型"></a>6.2.3指定数据接收类型</h4><p>q: Optional[str] = Query(…)</p>
<p>q: str</p>
<p>这里支持的数据类型:</p>
<p><code>int/float/str/bool/list/dict/set</code></p>
<p><code>UUID/datetime.datetime(2008-09-15T15:53:00+05:00)/datetime.date(2008-09-15)</code></p>
<p><code>datetime.time(14:23:55.003)/datetime.timedelta(时间戳秒数)/bytes/Decimal(框架内可当做float使用)</code></p>
<p>支持指定多种数据类型：</p>
<p>user_id: Union[int, str]</p>
<h3 id="6-3-BaseModel校验方式"><a href="#6-3-BaseModel校验方式" class="headerlink" title="6.3 BaseModel校验方式"></a>6.3 BaseModel校验方式</h3><p>这里是用了 Filed做示例, 如果是 Body参数, 使用Body也可，其他的类推~</p>
<p>示例如下:</p>
<pre><code>class UserIn(BaseModel):
    &quot;&quot;&quot;用户信息 请求格式&quot;&quot;&quot;
    name: str = Field(..., min_length=1, max_length=64)
    password: str = Field(..., min_length=1, max_length=32)
    nickname: str = Field(None, max_length=64)
    phone: str = Field(None, max_length=16, regex=r&#39;^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d{8}$&#39;)    # 正则匹配
    email: str = Field(None, max_length=32, regex=r&#39;^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$&#39;)

class UserOut(BaseModel):
    &quot;&quot;&quot;用户信息响应格式&quot;&quot;&quot;
    id: str = Field(..., max_length=32)
    name: str = Field(..., min_length=1, max_length=64)
    nickname: str = Field(None, max_length=64)
    last_login_address: str = Field(None, max_length=32)
    last_login_time: datetime.datetime = Field(None)    # 指定datetime类型
    login_counts: int = Field(0)        # 设置默认值 0
    phone: str = Field(None, max_length=16)        # 设置为非必须字段
    email: str = Field(None, max_length=32)
    enabled: int = Field(1)
    is_deleted: int = Field(0)</code></pre><h3 id="6-4-HTTP验证-security"><a href="#6-4-HTTP验证-security" class="headerlink" title="6.4 HTTP验证 security"></a>6.4 HTTP验证 security</h3><p>通过输入用户名和密码来确认身份</p>
<pre><code>from fastapi import FastAPI, Depends
from fastapi.security import HTTPBasic, HTTPBasicCredentials
import uvicorn

app = FastAPI()

security = HTTPBasic()

@app.get(&quot;/index&quot;)
async def index(credentials: HTTPBasicCredentials = Depends(security)):
    return {&quot;username&quot;: credentials.username, &quot;password&quot;: credentials.password}</code></pre><p>当用户访问 /index 的时候，会提示输入用户名和密码：</p>
<p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/a/dvlvakm1DFPw2BLV/3291b0841ffd47239b6543f1f0c3d3771684.png" alt="image"> </p>
<p>输入完毕之后，信息会保存在 credentials，我们可以获取出来进行验证。</p>
<h3 id="6-5-其他"><a href="#6-5-其他" class="headerlink" title="6.5 其他"></a>6.5 其他</h3><h4 id="6-5-1-使用枚举"><a href="#6-5-1-使用枚举" class="headerlink" title="6.5.1 使用枚举"></a>6.5.1 使用枚举</h4><p>如果我们希望有一个参数的取值范围只能是固定的 几个值, 可以使用枚举类型</p>
<p>示例如下:</p>
<pre><code>from enum import Enum

class Gander(str, Enum):
    type1 = &quot;boy&quot;        # 这里 type1 只是一个随意变量, 没有任何其他含义
    type2 = &quot;girl&quot;

@app.get(&quot;/users/{gander_type}&quot;)
async def get_user(gander_type: Gander):
    return {&quot;gander_type&quot;: gander_type}    # 这里的 gander_type 就只能是 boy/girl; 否则就会抛错</code></pre><h4 id="6-5-2-bool-类型自动转换"><a href="#6-5-2-bool-类型自动转换" class="headerlink" title="6.5.2 bool 类型自动转换"></a>6.5.2 bool 类型自动转换</h4><p>对于布尔类型，FastAPI 支持自动转换</p>
<pre><code>@app.get(&quot;/{flag}&quot;)
async def get_flag(flag: bool):
    return {&quot;flag&quot;: flag}        # 这里 flag 为 True/true/on/yes/1 均会转换为 True; 0/False/false/off/no 均会转为 False</code></pre>
            </div>
            <hr />

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">写作不易，客官能否打赏一杯奶茶？</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            


        </div>
    </div>

    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '25YwKhuYt2EHC4fvRiVds1mX-gzGzoHsz',
        appKey: 'eTkk1KXcVIR5HVVUHcj48aS4',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/07/14/chang-yong-huan-cun-tao-tai-suan-fa/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="缓存淘汰算法：LRU、TTL">
                        
                        <span class="card-title">缓存淘汰算法：LRU、TTL</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            LRU CacheLRU(Least recently used, 最近最少使用)，其核心思想是：如果一个数据最近一段时间被访问过，那么以后被访问的几率越高，如果一个数据最近一段时间没有被访问过，那么将来被访问的几率越小；当内存超过限制时，
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2022-07-14
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/算法/" class="post-category" target="_blank">
                                    算法
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/" target="_blank">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/10/18/supervisor/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="Supervisor进程管理工具">
                        
                        <span class="card-title">Supervisor进程管理工具</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            一、supervisor简介Supervisor是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。它是通过fork/exec的方式把这些被管理的进程当作supe
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-10-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python/" class="post-category" target="_blank">
                                    Python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/" target="_blank">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2021-2020 OrangeQ. 版权所有

            
            
            

            <br>
            <span id="sitetime"></span>

            
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/wc571498244" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:571498244@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>

<!-- 

    <a href="https://zhihu.com/people/wc571498244" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-inverse">知</i>
    </a>
 -->


    <a href="http://wpa.qq.com/msgrd?v=3&uin=571498244&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


<!-- 
    <a href="https://weibo.com/wc571498244" class="tooltipped" target="_blank" data-tooltip="关注我的微博" data-position="top" data-delay="50">
        <i class="fa fa-weibo"></i>
    </a>
 -->


    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>


<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2021, 05, 15, 00, 00, 00); 
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script> -->

    <!-- Global site tag (gtag.js) - Google Analytics -->



    
    <script src="/libs/others/clicklove.js"></script>
    

    

    <!-- 雪花特效 -->
    

</body>

</html>